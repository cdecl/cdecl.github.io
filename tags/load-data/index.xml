<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>Load Data on cdeclog</title><link>https://cdecl.github.io/tags/load-data/</link><description>Recent content in Load Data on cdeclog</description><generator>Hugo -- 0.155.3</generator><language>ko-kr</language><lastBuildDate>Wed, 13 Oct 2021 00:00:00 +0900</lastBuildDate><atom:link href="https://cdecl.github.io/tags/load-data/index.xml" rel="self" type="application/rss+xml"/><item><title>MySQL LOAD DATA</title><link>https://cdecl.github.io/devops/mysql-load-data/</link><pubDate>Wed, 13 Oct 2021 00:00:00 +0900</pubDate><guid>https://cdecl.github.io/devops/mysql-load-data/</guid><description>&lt;p&gt;MySQL 테이블에 Text 파일을 빠르게 Insert 하는 방벙&lt;/p&gt;
&lt;h2 id="mysql-load-data"&gt;MySQL LOAD DATA&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://dev.mysql.com/doc/refman/8.0/en/load-data.html"&gt;https://dev.mysql.com/doc/refman/8.0/en/load-data.html&lt;/a&gt;{:target=&amp;quot;_blank&amp;quot;}
&lt;ul&gt;
&lt;li&gt;The LOAD DATA statement reads rows from a text file into a table at a very high speed&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="load-data-statement"&gt;LOAD DATA statement&lt;/h3&gt;
&lt;h4 id="사전-준비--secure_file_priv"&gt;사전 준비 : secure_file_priv&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;secure_file_priv&lt;/code&gt; 의 설정값이 NULL 로 되어 있는데 빈문자열로 수정해야 함&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ff79c6"&gt;SHOW&lt;/span&gt; VARIABLES &lt;span style="color:#ff79c6"&gt;LIKE&lt;/span&gt; &lt;span style="color:#f1fa8c"&gt;&amp;#39;secure_file_priv&amp;#39;&lt;/span&gt; &lt;span style="color:#6272a4"&gt;-- NULL
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;my.cnf 에서 수정 및 재시작 필요&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-ini" data-lang="ini"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ff79c6"&gt;[mysqld]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#50fa7b"&gt;secure-file-priv&lt;/span&gt;&lt;span style="color:#ff79c6"&gt;=&lt;/span&gt;&lt;span style="color:#f1fa8c"&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="load-data-최소-설정"&gt;LOAD DATA 최소 설정&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ff79c6"&gt;LOAD&lt;/span&gt; &lt;span style="color:#ff79c6"&gt;DATA&lt;/span&gt; INFILE &lt;span style="color:#f1fa8c"&gt;&amp;#39;/path/data.txt&amp;#39;&lt;/span&gt; &lt;span style="color:#ff79c6"&gt;INTO&lt;/span&gt; &lt;span style="color:#ff79c6"&gt;TABLE&lt;/span&gt; data_table
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id="field-and-line-handling--default-설정"&gt;Field and Line Handling : Default 설정&lt;/h5&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ff79c6"&gt;LOAD&lt;/span&gt; &lt;span style="color:#ff79c6"&gt;DATA&lt;/span&gt; INFILE &lt;span style="color:#f1fa8c"&gt;&amp;#39;/path/data.txt&amp;#39;&lt;/span&gt; &lt;span style="color:#ff79c6"&gt;INTO&lt;/span&gt; &lt;span style="color:#ff79c6"&gt;TABLE&lt;/span&gt; data_table
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;FIELDS TERMINATED &lt;span style="color:#ff79c6"&gt;BY&lt;/span&gt; &lt;span style="color:#f1fa8c"&gt;&amp;#39;\t&amp;#39;&lt;/span&gt; ENCLOSED &lt;span style="color:#ff79c6"&gt;BY&lt;/span&gt; &lt;span style="color:#f1fa8c"&gt;&amp;#39;&amp;#39;&lt;/span&gt; ESCAPED &lt;span style="color:#ff79c6"&gt;BY&lt;/span&gt; &lt;span style="color:#f1fa8c"&gt;&amp;#39;\\&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;LINES TERMINATED &lt;span style="color:#ff79c6"&gt;BY&lt;/span&gt; &lt;span style="color:#f1fa8c"&gt;&amp;#39;\n&amp;#39;&lt;/span&gt; STARTING &lt;span style="color:#ff79c6"&gt;BY&lt;/span&gt; &lt;span style="color:#f1fa8c"&gt;&amp;#39;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id="헤더-라인-무시"&gt;헤더 라인 무시&lt;/h5&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ff79c6"&gt;LOAD&lt;/span&gt; &lt;span style="color:#ff79c6"&gt;DATA&lt;/span&gt; INFILE &lt;span style="color:#f1fa8c"&gt;&amp;#39;/path/data.txt&amp;#39;&lt;/span&gt; &lt;span style="color:#ff79c6"&gt;INTO&lt;/span&gt; &lt;span style="color:#ff79c6"&gt;TABLE&lt;/span&gt; data_table &lt;span style="color:#ff79c6"&gt;IGNORE&lt;/span&gt; &lt;span style="color:#bd93f9"&gt;1&lt;/span&gt; LINES
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="load-data-기본-설정-csv"&gt;LOAD DATA 기본 설정 (CSV)&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ff79c6"&gt;LOAD&lt;/span&gt; &lt;span style="color:#ff79c6"&gt;DATA&lt;/span&gt; INFILE &lt;span style="color:#f1fa8c"&gt;&amp;#39;/path/data.txt&amp;#39;&lt;/span&gt; &lt;span style="color:#ff79c6"&gt;IGNORE&lt;/span&gt; &lt;span style="color:#ff79c6"&gt;INTO&lt;/span&gt; &lt;span style="color:#ff79c6"&gt;TABLE&lt;/span&gt; data_table
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;FIELDS TERMINATED &lt;span style="color:#ff79c6"&gt;BY&lt;/span&gt; &lt;span style="color:#f1fa8c"&gt;&amp;#39;,&amp;#39;&lt;/span&gt; OPTIONALLY ENCLOSED &lt;span style="color:#ff79c6"&gt;BY&lt;/span&gt; &lt;span style="color:#f1fa8c"&gt;&amp;#39;&amp;#34;&amp;#39;&lt;/span&gt; ESCAPED &lt;span style="color:#ff79c6"&gt;BY&lt;/span&gt; &lt;span style="color:#f1fa8c"&gt;&amp;#39;&amp;#34;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;LINES TERMINATED &lt;span style="color:#ff79c6"&gt;BY&lt;/span&gt; &lt;span style="color:#f1fa8c"&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;(filed1, filed2, filed3 )
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id="duplicate-key-and-error-handling"&gt;Duplicate-Key and Error Handling&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;IGNORE&lt;/code&gt; : unique key 값이 있으면 새로운 행은 버려짐 &lt;code&gt;default&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;REPLACE&lt;/code&gt; : unique key 값 기준으로 새로운 행으로 변경&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id="필드-개수-순서"&gt;필드 개수, 순서&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;기본적으로 파일의 구분자 기준 순서와 필드와 1:1 매치됨&lt;/li&gt;
&lt;li&gt;필드 지정을 통해 순서 조정 가능
&lt;ul&gt;
&lt;li&gt;파일의 구분자 필드가 많으면 : 버려짐&lt;/li&gt;
&lt;li&gt;테이블의 필드가 많으면 : 나머지 필드는 Default 값이나 NULL 처리 (NULL 허용시)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id="input-preprocessing"&gt;Input Preprocessing&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;테이블의 중간 필드를 무시 (Default 값 or NULL 처리) 하려면 &lt;code&gt;@dummy&lt;/code&gt; 키워드로 필드 지정&lt;/li&gt;
&lt;li&gt;필드 가공은 &lt;code&gt;SET&lt;/code&gt; 명령으로 처리&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@변수&lt;/code&gt; 명으로 받아서 가공후 필드에 지정할 수 있음&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ff79c6"&gt;LOAD&lt;/span&gt; &lt;span style="color:#ff79c6"&gt;DATA&lt;/span&gt; INFILE &lt;span style="color:#f1fa8c"&gt;&amp;#39;/path/data.txt&amp;#39;&lt;/span&gt; &lt;span style="color:#ff79c6"&gt;IGNORE&lt;/span&gt; &lt;span style="color:#ff79c6"&gt;INTO&lt;/span&gt; &lt;span style="color:#ff79c6"&gt;TABLE&lt;/span&gt; data_table
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;FIELDS TERMINATED &lt;span style="color:#ff79c6"&gt;BY&lt;/span&gt; &lt;span style="color:#f1fa8c"&gt;&amp;#39;,&amp;#39;&lt;/span&gt; LINES TERMINATED &lt;span style="color:#ff79c6"&gt;BY&lt;/span&gt; &lt;span style="color:#f1fa8c"&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;(filed1, &lt;span style="color:#ff79c6"&gt;@&lt;/span&gt;dummy, filed3, &lt;span style="color:#ff79c6"&gt;@&lt;/span&gt;var1, filed5 )
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ff79c6"&gt;SET&lt;/span&gt; filed2 &lt;span style="color:#ff79c6"&gt;=&lt;/span&gt; &lt;span style="color:#ff79c6"&gt;CURRENT_TIMESTAMP&lt;/span&gt;, filed4 &lt;span style="color:#ff79c6"&gt;=&lt;/span&gt; &lt;span style="color:#ff79c6"&gt;@&lt;/span&gt;var1 &lt;span style="color:#ff79c6"&gt;*&lt;/span&gt; &lt;span style="color:#bd93f9"&gt;2&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id="index-handling--load-data-문의-성능향상을-위한-index-check-option"&gt;Index Handling : &lt;code&gt;LOAD DATA&lt;/code&gt; 문의 성능향상을 위한 Index check option&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;unique index checks option : &lt;code&gt;SET unique_checks = 0&lt;/code&gt; &lt;code&gt;SET unique_checks = 1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;foreign key check option : &lt;code&gt;SET foreign_key_checks = 0&lt;/code&gt; &lt;code&gt;SET foreign_key_checks = 1&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="로컬클라이언트-데이터-원격-insert"&gt;로컬(클라이언트) 데이터 원격 INSERT&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://dev.mysql.com/doc/refman/8.0/en/load-data-local-security.html"&gt;https://dev.mysql.com/doc/refman/8.0/en/load-data-local-security.html&lt;/a&gt;{:target=&amp;quot;_blank&amp;quot;}&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id="사전-준비--local_infile-설정-server-and-client"&gt;사전 준비 : local_infile 설정 (server and client)&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;server : &lt;code&gt;local_infile&lt;/code&gt; 의 설정값이 ON(1) 로 수정해야 함&lt;/li&gt;
&lt;li&gt;client : 접속시 &lt;code&gt;--local-infile&lt;/code&gt; 옵션 추가&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ff79c6"&gt;SHOW&lt;/span&gt; VARIABLES &lt;span style="color:#ff79c6"&gt;LIKE&lt;/span&gt; &lt;span style="color:#f1fa8c"&gt;&amp;#39;local_infile&amp;#39;&lt;/span&gt; ; &lt;span style="color:#6272a4"&gt;-- OFF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ff79c6"&gt;SET&lt;/span&gt; &lt;span style="color:#ff79c6"&gt;GLOBAL&lt;/span&gt; local_infile &lt;span style="color:#ff79c6"&gt;=&lt;/span&gt; &lt;span style="color:#bd93f9"&gt;1&lt;/span&gt; ;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ff79c6"&gt;SHOW&lt;/span&gt; VARIABLES &lt;span style="color:#ff79c6"&gt;LIKE&lt;/span&gt; &lt;span style="color:#f1fa8c"&gt;&amp;#39;local_infile&amp;#39;&lt;/span&gt; ; &lt;span style="color:#6272a4"&gt;-- ON
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id="local-path-지정"&gt;LOCAL PATH 지정&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;LOAD DATA LOCAL INFILE ...&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#ff79c6"&gt;LOAD&lt;/span&gt; &lt;span style="color:#ff79c6"&gt;DATA&lt;/span&gt; &lt;span style="color:#ff79c6"&gt;LOCAL&lt;/span&gt; INFILE &lt;span style="color:#f1fa8c"&gt;&amp;#39;/path/data.txt&amp;#39;&lt;/span&gt; &lt;span style="color:#ff79c6"&gt;INTO&lt;/span&gt; &lt;span style="color:#ff79c6"&gt;TABLE&lt;/span&gt; data_table
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description></item></channel></rss>