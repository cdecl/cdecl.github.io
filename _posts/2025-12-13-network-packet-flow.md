---
title: 네트워크 패킷의 이동

toc: true
toc_sticky: true
mermaid:
  theme: default

categories:
  - devops

tags:
  - network
  - routing
  - switching
  - arp
  - dfz
---

네트워크 상에서 데이터(패킷)가 출발지에서 목적지까지 어떻게 이동하는지, 그 과정을 단계별로 정리해 보았습니다. 우리가 인터넷을 통해 데이터를 보낼 때, 눈에 보이지 않는 수많은 장비들이 어떤 역할을 수행하는지 알아보겠습니다.

## 전체 흐름도 (Network Flow Diagram)

먼저 전체적인 흐름을 인포그래픽으로 살펴보겠습니다.

![Network Packet Flow Diagram](/assets/images/2025/12/network-flow.png)

## 단계별 이동 과정

패킷이 목적지 IP로 이동하는 과정은 크게 4단계로 나눌 수 있습니다.

### (1) 로컬 네트워크 확인 및 이동 (Routing Table & MAC)
컴퓨터나 네트워크 스위치는 패킷을 보낼 때 먼저 자신의 **라우팅 테이블(Routing Table)**을 확인합니다.
*   **동일 네트워크인 경우**: 라우팅 테이블을 통해 목적지가 같은 네트워크 대역임이 확인되면, **ARP(Address Resolution Protocol)**를 통해 목적지의 **MAC 주소**를 알아내어 바로 전달합니다.
*   **L2 스위치의 역할**: L2 스위치는 **MAC 주소 테이블**을 기반으로 연결된 포트로 프레임을 전달합니다.

### (2) 디폴트 게이트웨이로 이동 (Default Gateway)
라우팅 테이블에 목적지로 가는 특정 경로가 명시되어 있지 않다면, 패킷은 **디폴트 게이트웨이(Default Gateway)**로 보내집니다.
*   디폴트 게이트웨이는 보통 상위 라우터나 L3 스위치가 됩니다.
*   PC는 게이트웨이의 MAC 주소를 ARP로 찾아서 패킷을 전달합니다.

### (3) DFZ (Default Free Zone)까지의 여정
상위 라우터로 전달된 패킷은 또다시 (1)과 (2)의 과정을 반복하며 인터넷 백본망으로 이동합니다.
*   이 과정은 **DFZ (Default Free Zone)** 영역에 도달할 때까지 계속됩니다.
*   **DFZ 라우터**: 전 세계의 모든 네트워크 경로 정보를 가지고 있는 최상위 라우터들입니다. 이들은 "모르면 위로 보낸다(Default Gateway)"는 개념이 없으며, 자신이 가진 경로 정보에 목적지가 없으면 패킷을 **폐기(Drop)**합니다.

### (4) 목적지 네트워크 진입 및 최종 도착
DFZ를 통과하여 목적지 IP 대역이 있는 네트워크 근처에 도달하면, 다시 하위 라우터를 타고 내려갑니다.
*   최종 목적지 네트워크의 라우터(게이트웨이)에 도착하면, 라우터는 다시 **ARP**를 통해 최종 목적지 PC의 **MAC 주소**를 확인합니다.
*   확인된 MAC 주소를 이용해 L2 스위치를 거쳐 최종적으로 목적지 컴퓨터에 패킷이 도착합니다.

---

## 주요 용어 및 장비 설명

### L2 스위치 vs L3 스위치
*   **L2 스위치 (Layer 2)**: **MAC 주소**를 보고 통신합니다. 주로 같은 네트워크 안에서 기기들을 연결하는 역할을 합니다.
*   **L3 스위치 (Layer 3)**: **IP 주소**와 **라우팅 테이블**을 보고 통신합니다. 서로 다른 네트워크 간의 통신(라우팅)이 가능하며, 라우터의 역할을 겸합니다.

### DFZ (Default Free Zone)
*   일반적인 라우터들은 경로를 모르면 '디폴트 게이트웨이'로 패킷을 넘기지만, 인터넷의 최상위 계층인 DFZ에 있는 라우터들은 디폴트 게이트웨이가 없습니다.
*   **Full Routing Table**: 전 세계의 모든 BGP 경로 정보(약 90만 개 이상)를 가지고 있어, 목적지 IP만 보면 어디로 보내야 할지 알 수 있습니다. 만약 여기서도 경로를 찾을 수 없다면 그 IP는 인터넷에 존재하지 않는 것으로 간주되어 폐기됩니다.

### ARP (Address Resolution Protocol)
*   네트워크 통신은 결과적으로 물리 장비(랜카드)를 찾아가야 하므로 MAC 주소가 필요합니다.
*   우리는 IP 주소로 통신한다고 생각하지만, 실제 데이터 링크 계층에서는 **ARP** 프로토콜이 "이 IP 주소 쓰는 사람 누구니?"라고 방송(Broadcasting)하여 그에 맞는 **MAC 주소**를 받아와서 통신합니다.

