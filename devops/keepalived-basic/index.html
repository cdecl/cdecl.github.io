<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Keepalived Basic | cdeclog</title><meta name=keywords content="keepalived,vrrp,loadbalancing,ha"><meta name=description content='Loadbalancing & High-Availability 를 위한 Keepalived 설정 및 테스트
Keepalived

https://www.keepalived.org/{:target="_blank"}
VRRP 를 활용 가상IP (VIP) 기반 서버 다중화 도구


VRRP 는 여러 대의 라우터를 그룹으로 묶어 하나의 가상 IP 어드레스를 부여,
마스터로 지정된 라우터 장애시 VRRP 그룹 내의 백업 라우터가 마스터로 자동 전환되는 프로토콜입니다.

Install
# install
$ sudo yum install keepalived 

# service start
$ sudo systemctl start keepalived

$ sudo systemctl status keepalived
● keepalived.service - LVS and VRRP High Availability Monitor
   Loaded: loaded (/usr/lib/systemd/system/keepalived.service; disabled; vendor preset: disabled)
   Active: active (running) since 화 2021-10-26 11:37:04 KST; 4s ago
  Process: 18356 ExecStart=/usr/sbin/keepalived $KEEPALIVED_OPTIONS (code=exited, status=0/SUCCESS)
 Main PID: 18357 (keepalived)
    Tasks: 3
   Memory: 1.6M
   CGroup: /system.slice/keepalived.service
           ├─18357 /usr/sbin/keepalived -D
           ├─18358 /usr/sbin/keepalived -D
           └─18359 /usr/sbin/keepalived -D

10월 26 11:37:05 node1 Keepalived_vrrp[18359]: VRRP_Instance(VI_1) forcing a new MASTER ...on
10월 26 11:37:06 node1 Keepalived_vrrp[18359]: VRRP_Instance(VI_1) Transition to MASTER STATE
10월 26 11:37:07 node1 Keepalived_vrrp[18359]: VRRP_Instance(VI_1) Entering MASTER STATE
10월 26 11:37:07 node1 Keepalived_vrrp[18359]: VRRP_Instance(VI_1) setting pro
10월 26 11:37:07 node1 Keepalived_vrrp[18359]: Sending gratuitous ARP on eth0 for 192.16...00
10월 26 11:37:07 node1 Keepalived_vrrp[18359]: VRRP_Instance(VI_1) Sending/queueing grat...00
10월 26 11:37:07 node1 Keepalived_vrrp[18359]: Sending gratuitous ARP on eth0 for 192.16...00
10월 26 11:37:07 node1 Keepalived_vrrp[18359]: Sending gratuitous ARP on eth0 for 192.16...00
10월 26 11:37:07 node1 Keepalived_vrrp[18359]: Sending gratuitous ARP on eth0 for 192.16...00
10월 26 11:37:07 node1 Keepalived_vrrp[18359]: Sending gratuitous ARP on eth0 for 192.16...00
Hint: Some lines were ellipsized, use -l to show in full.

기본 설정

https://www.redhat.com/sysadmin/keepalived-basics{:target="_blank"}
https://www.redhat.com/sysadmin/advanced-keepalived{:target="_blank"}

테스트 환경

CentOS 7 (Hyper-v)

node1 (MASTER) : 192.168.137.201
node2 (BACKUP) : 192.168.137.202


VIP : 192.168.137.200

/etc/keepalived/keepalived.conf

vrrp_instance : 인터페이스에서 실행되는 프로토콜의 개별 인스턴스 정의
state : 인스턴스에서 시작해야 하는 초기 상태
interface : 네트워크 인터페이스
virtual_router_id : 네트워크 가상 ID
priority : 우선 순위
advert_int : VRRP 패킷 송신 간격 (sec)
authentication : 서로 서버간, 인증 계정 정보
virtual_ipaddress : 가상 IP vip

MASTER 설정 : 192.168.137.201
vrrp_instance VI_1 {
    state MASTER
    interface eth0
    virtual_router_id 51
    priority 210
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
        192.168.137.200
    }
}
BACKUP 설정 : 192.168.137.202
vrrp_instance VI_1 {
    state BACKUP
    interface eth0
    virtual_router_id 51
    priority 200
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
        192.168.137.200
    }
}

MASTER 노드에 우선순위 priority 210 를 높게 줌'><meta name=author content="Byung Kyu KIM"><link rel=canonical href=https://cdecl.github.io/devops/keepalived-basic/><link crossorigin=anonymous href=/assets/css/stylesheet.f939c4ffefb264e6fe85e04352266f79db6bb1303c8e16ae9b6064c1247b5e32.css integrity="sha256-+TnE/++yZOb+heBDUiZvedtrsTA8jhaum2BkwSR7XjI=" rel="preload stylesheet" as=style><link rel=icon href=https://cdecl.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://cdecl.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://cdecl.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://cdecl.github.io/apple-touch-icon.png><link rel=mask-icon href=https://cdecl.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://cdecl.github.io/devops/keepalived-basic/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-VQQHHYPN7K"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VQQHHYPN7K")}</script><meta property="og:url" content="https://cdecl.github.io/devops/keepalived-basic/"><meta property="og:site_name" content="cdeclog"><meta property="og:title" content="Keepalived Basic"><meta property="og:description" content='Loadbalancing & High-Availability 를 위한 Keepalived 설정 및 테스트
Keepalived https://www.keepalived.org/{:target="_blank"} VRRP 를 활용 가상IP (VIP) 기반 서버 다중화 도구 VRRP 는 여러 대의 라우터를 그룹으로 묶어 하나의 가상 IP 어드레스를 부여,
마스터로 지정된 라우터 장애시 VRRP 그룹 내의 백업 라우터가 마스터로 자동 전환되는 프로토콜입니다.
Install # install $ sudo yum install keepalived # service start $ sudo systemctl start keepalived $ sudo systemctl status keepalived ● keepalived.service - LVS and VRRP High Availability Monitor Loaded: loaded (/usr/lib/systemd/system/keepalived.service; disabled; vendor preset: disabled) Active: active (running) since 화 2021-10-26 11:37:04 KST; 4s ago Process: 18356 ExecStart=/usr/sbin/keepalived $KEEPALIVED_OPTIONS (code=exited, status=0/SUCCESS) Main PID: 18357 (keepalived) Tasks: 3 Memory: 1.6M CGroup: /system.slice/keepalived.service ├─18357 /usr/sbin/keepalived -D ├─18358 /usr/sbin/keepalived -D └─18359 /usr/sbin/keepalived -D 10월 26 11:37:05 node1 Keepalived_vrrp[18359]: VRRP_Instance(VI_1) forcing a new MASTER ...on 10월 26 11:37:06 node1 Keepalived_vrrp[18359]: VRRP_Instance(VI_1) Transition to MASTER STATE 10월 26 11:37:07 node1 Keepalived_vrrp[18359]: VRRP_Instance(VI_1) Entering MASTER STATE 10월 26 11:37:07 node1 Keepalived_vrrp[18359]: VRRP_Instance(VI_1) setting pro 10월 26 11:37:07 node1 Keepalived_vrrp[18359]: Sending gratuitous ARP on eth0 for 192.16...00 10월 26 11:37:07 node1 Keepalived_vrrp[18359]: VRRP_Instance(VI_1) Sending/queueing grat...00 10월 26 11:37:07 node1 Keepalived_vrrp[18359]: Sending gratuitous ARP on eth0 for 192.16...00 10월 26 11:37:07 node1 Keepalived_vrrp[18359]: Sending gratuitous ARP on eth0 for 192.16...00 10월 26 11:37:07 node1 Keepalived_vrrp[18359]: Sending gratuitous ARP on eth0 for 192.16...00 10월 26 11:37:07 node1 Keepalived_vrrp[18359]: Sending gratuitous ARP on eth0 for 192.16...00 Hint: Some lines were ellipsized, use -l to show in full. 기본 설정 https://www.redhat.com/sysadmin/keepalived-basics{:target="_blank"} https://www.redhat.com/sysadmin/advanced-keepalived{:target="_blank"} 테스트 환경 CentOS 7 (Hyper-v) node1 (MASTER) : 192.168.137.201 node2 (BACKUP) : 192.168.137.202 VIP : 192.168.137.200 /etc/keepalived/keepalived.conf vrrp_instance : 인터페이스에서 실행되는 프로토콜의 개별 인스턴스 정의 state : 인스턴스에서 시작해야 하는 초기 상태 interface : 네트워크 인터페이스 virtual_router_id : 네트워크 가상 ID priority : 우선 순위 advert_int : VRRP 패킷 송신 간격 (sec) authentication : 서로 서버간, 인증 계정 정보 virtual_ipaddress : 가상 IP vip MASTER 설정 : 192.168.137.201 vrrp_instance VI_1 { state MASTER interface eth0 virtual_router_id 51 priority 210 advert_int 1 authentication { auth_type PASS auth_pass 1111 } virtual_ipaddress { 192.168.137.200 } } BACKUP 설정 : 192.168.137.202 vrrp_instance VI_1 { state BACKUP interface eth0 virtual_router_id 51 priority 200 advert_int 1 authentication { auth_type PASS auth_pass 1111 } virtual_ipaddress { 192.168.137.200 } } MASTER 노드에 우선순위 priority 210 를 높게 줌'><meta property="og:locale" content="ko-kr"><meta property="og:type" content="article"><meta property="article:section" content="devops"><meta property="article:published_time" content="2021-10-25T00:00:00+09:00"><meta property="article:modified_time" content="2021-10-25T00:00:00+09:00"><meta property="article:tag" content="Keepalived"><meta property="article:tag" content="Vrrp"><meta property="article:tag" content="Loadbalancing"><meta property="article:tag" content="Ha"><meta name=twitter:card content="summary"><meta name=twitter:title content="Keepalived Basic"><meta name=twitter:description content='Loadbalancing & High-Availability 를 위한 Keepalived 설정 및 테스트
Keepalived

https://www.keepalived.org/{:target="_blank"}
VRRP 를 활용 가상IP (VIP) 기반 서버 다중화 도구


VRRP 는 여러 대의 라우터를 그룹으로 묶어 하나의 가상 IP 어드레스를 부여,
마스터로 지정된 라우터 장애시 VRRP 그룹 내의 백업 라우터가 마스터로 자동 전환되는 프로토콜입니다.

Install
# install
$ sudo yum install keepalived 

# service start
$ sudo systemctl start keepalived

$ sudo systemctl status keepalived
● keepalived.service - LVS and VRRP High Availability Monitor
   Loaded: loaded (/usr/lib/systemd/system/keepalived.service; disabled; vendor preset: disabled)
   Active: active (running) since 화 2021-10-26 11:37:04 KST; 4s ago
  Process: 18356 ExecStart=/usr/sbin/keepalived $KEEPALIVED_OPTIONS (code=exited, status=0/SUCCESS)
 Main PID: 18357 (keepalived)
    Tasks: 3
   Memory: 1.6M
   CGroup: /system.slice/keepalived.service
           ├─18357 /usr/sbin/keepalived -D
           ├─18358 /usr/sbin/keepalived -D
           └─18359 /usr/sbin/keepalived -D

10월 26 11:37:05 node1 Keepalived_vrrp[18359]: VRRP_Instance(VI_1) forcing a new MASTER ...on
10월 26 11:37:06 node1 Keepalived_vrrp[18359]: VRRP_Instance(VI_1) Transition to MASTER STATE
10월 26 11:37:07 node1 Keepalived_vrrp[18359]: VRRP_Instance(VI_1) Entering MASTER STATE
10월 26 11:37:07 node1 Keepalived_vrrp[18359]: VRRP_Instance(VI_1) setting pro
10월 26 11:37:07 node1 Keepalived_vrrp[18359]: Sending gratuitous ARP on eth0 for 192.16...00
10월 26 11:37:07 node1 Keepalived_vrrp[18359]: VRRP_Instance(VI_1) Sending/queueing grat...00
10월 26 11:37:07 node1 Keepalived_vrrp[18359]: Sending gratuitous ARP on eth0 for 192.16...00
10월 26 11:37:07 node1 Keepalived_vrrp[18359]: Sending gratuitous ARP on eth0 for 192.16...00
10월 26 11:37:07 node1 Keepalived_vrrp[18359]: Sending gratuitous ARP on eth0 for 192.16...00
10월 26 11:37:07 node1 Keepalived_vrrp[18359]: Sending gratuitous ARP on eth0 for 192.16...00
Hint: Some lines were ellipsized, use -l to show in full.

기본 설정

https://www.redhat.com/sysadmin/keepalived-basics{:target="_blank"}
https://www.redhat.com/sysadmin/advanced-keepalived{:target="_blank"}

테스트 환경

CentOS 7 (Hyper-v)

node1 (MASTER) : 192.168.137.201
node2 (BACKUP) : 192.168.137.202


VIP : 192.168.137.200

/etc/keepalived/keepalived.conf

vrrp_instance : 인터페이스에서 실행되는 프로토콜의 개별 인스턴스 정의
state : 인스턴스에서 시작해야 하는 초기 상태
interface : 네트워크 인터페이스
virtual_router_id : 네트워크 가상 ID
priority : 우선 순위
advert_int : VRRP 패킷 송신 간격 (sec)
authentication : 서로 서버간, 인증 계정 정보
virtual_ipaddress : 가상 IP vip

MASTER 설정 : 192.168.137.201
vrrp_instance VI_1 {
    state MASTER
    interface eth0
    virtual_router_id 51
    priority 210
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
        192.168.137.200
    }
}
BACKUP 설정 : 192.168.137.202
vrrp_instance VI_1 {
    state BACKUP
    interface eth0
    virtual_router_id 51
    priority 200
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
        192.168.137.200
    }
}

MASTER 노드에 우선순위 priority 210 를 높게 줌'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Devops","item":"https://cdecl.github.io/devops/"},{"@type":"ListItem","position":2,"name":"Keepalived Basic","item":"https://cdecl.github.io/devops/keepalived-basic/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Keepalived Basic","name":"Keepalived Basic","description":"Loadbalancing \u0026amp; High-Availability 를 위한 Keepalived 설정 및 테스트\nKeepalived https://www.keepalived.org/{:target=\u0026quot;_blank\u0026quot;} VRRP 를 활용 가상IP (VIP) 기반 서버 다중화 도구 VRRP 는 여러 대의 라우터를 그룹으로 묶어 하나의 가상 IP 어드레스를 부여,\n마스터로 지정된 라우터 장애시 VRRP 그룹 내의 백업 라우터가 마스터로 자동 전환되는 프로토콜입니다.\nInstall # install $ sudo yum install keepalived # service start $ sudo systemctl start keepalived $ sudo systemctl status keepalived ● keepalived.service - LVS and VRRP High Availability Monitor Loaded: loaded (/usr/lib/systemd/system/keepalived.service; disabled; vendor preset: disabled) Active: active (running) since 화 2021-10-26 11:37:04 KST; 4s ago Process: 18356 ExecStart=/usr/sbin/keepalived $KEEPALIVED_OPTIONS (code=exited, status=0/SUCCESS) Main PID: 18357 (keepalived) Tasks: 3 Memory: 1.6M CGroup: /system.slice/keepalived.service ├─18357 /usr/sbin/keepalived -D ├─18358 /usr/sbin/keepalived -D └─18359 /usr/sbin/keepalived -D 10월 26 11:37:05 node1 Keepalived_vrrp[18359]: VRRP_Instance(VI_1) forcing a new MASTER ...on 10월 26 11:37:06 node1 Keepalived_vrrp[18359]: VRRP_Instance(VI_1) Transition to MASTER STATE 10월 26 11:37:07 node1 Keepalived_vrrp[18359]: VRRP_Instance(VI_1) Entering MASTER STATE 10월 26 11:37:07 node1 Keepalived_vrrp[18359]: VRRP_Instance(VI_1) setting pro 10월 26 11:37:07 node1 Keepalived_vrrp[18359]: Sending gratuitous ARP on eth0 for 192.16...00 10월 26 11:37:07 node1 Keepalived_vrrp[18359]: VRRP_Instance(VI_1) Sending/queueing grat...00 10월 26 11:37:07 node1 Keepalived_vrrp[18359]: Sending gratuitous ARP on eth0 for 192.16...00 10월 26 11:37:07 node1 Keepalived_vrrp[18359]: Sending gratuitous ARP on eth0 for 192.16...00 10월 26 11:37:07 node1 Keepalived_vrrp[18359]: Sending gratuitous ARP on eth0 for 192.16...00 10월 26 11:37:07 node1 Keepalived_vrrp[18359]: Sending gratuitous ARP on eth0 for 192.16...00 Hint: Some lines were ellipsized, use -l to show in full. 기본 설정 https://www.redhat.com/sysadmin/keepalived-basics{:target=\u0026quot;_blank\u0026quot;} https://www.redhat.com/sysadmin/advanced-keepalived{:target=\u0026quot;_blank\u0026quot;} 테스트 환경 CentOS 7 (Hyper-v) node1 (MASTER) : 192.168.137.201 node2 (BACKUP) : 192.168.137.202 VIP : 192.168.137.200 /etc/keepalived/keepalived.conf vrrp_instance : 인터페이스에서 실행되는 프로토콜의 개별 인스턴스 정의 state : 인스턴스에서 시작해야 하는 초기 상태 interface : 네트워크 인터페이스 virtual_router_id : 네트워크 가상 ID priority : 우선 순위 advert_int : VRRP 패킷 송신 간격 (sec) authentication : 서로 서버간, 인증 계정 정보 virtual_ipaddress : 가상 IP vip MASTER 설정 : 192.168.137.201 vrrp_instance VI_1 { state MASTER interface eth0 virtual_router_id 51 priority 210 advert_int 1 authentication { auth_type PASS auth_pass 1111 } virtual_ipaddress { 192.168.137.200 } } BACKUP 설정 : 192.168.137.202 vrrp_instance VI_1 { state BACKUP interface eth0 virtual_router_id 51 priority 200 advert_int 1 authentication { auth_type PASS auth_pass 1111 } virtual_ipaddress { 192.168.137.200 } } MASTER 노드에 우선순위 priority 210 를 높게 줌\n","keywords":["keepalived","vrrp","loadbalancing","ha"],"articleBody":"Loadbalancing \u0026 High-Availability 를 위한 Keepalived 설정 및 테스트\nKeepalived https://www.keepalived.org/{:target=\"_blank\"} VRRP 를 활용 가상IP (VIP) 기반 서버 다중화 도구 VRRP 는 여러 대의 라우터를 그룹으로 묶어 하나의 가상 IP 어드레스를 부여,\n마스터로 지정된 라우터 장애시 VRRP 그룹 내의 백업 라우터가 마스터로 자동 전환되는 프로토콜입니다.\nInstall # install $ sudo yum install keepalived # service start $ sudo systemctl start keepalived $ sudo systemctl status keepalived ● keepalived.service - LVS and VRRP High Availability Monitor Loaded: loaded (/usr/lib/systemd/system/keepalived.service; disabled; vendor preset: disabled) Active: active (running) since 화 2021-10-26 11:37:04 KST; 4s ago Process: 18356 ExecStart=/usr/sbin/keepalived $KEEPALIVED_OPTIONS (code=exited, status=0/SUCCESS) Main PID: 18357 (keepalived) Tasks: 3 Memory: 1.6M CGroup: /system.slice/keepalived.service ├─18357 /usr/sbin/keepalived -D ├─18358 /usr/sbin/keepalived -D └─18359 /usr/sbin/keepalived -D 10월 26 11:37:05 node1 Keepalived_vrrp[18359]: VRRP_Instance(VI_1) forcing a new MASTER ...on 10월 26 11:37:06 node1 Keepalived_vrrp[18359]: VRRP_Instance(VI_1) Transition to MASTER STATE 10월 26 11:37:07 node1 Keepalived_vrrp[18359]: VRRP_Instance(VI_1) Entering MASTER STATE 10월 26 11:37:07 node1 Keepalived_vrrp[18359]: VRRP_Instance(VI_1) setting pro 10월 26 11:37:07 node1 Keepalived_vrrp[18359]: Sending gratuitous ARP on eth0 for 192.16...00 10월 26 11:37:07 node1 Keepalived_vrrp[18359]: VRRP_Instance(VI_1) Sending/queueing grat...00 10월 26 11:37:07 node1 Keepalived_vrrp[18359]: Sending gratuitous ARP on eth0 for 192.16...00 10월 26 11:37:07 node1 Keepalived_vrrp[18359]: Sending gratuitous ARP on eth0 for 192.16...00 10월 26 11:37:07 node1 Keepalived_vrrp[18359]: Sending gratuitous ARP on eth0 for 192.16...00 10월 26 11:37:07 node1 Keepalived_vrrp[18359]: Sending gratuitous ARP on eth0 for 192.16...00 Hint: Some lines were ellipsized, use -l to show in full. 기본 설정 https://www.redhat.com/sysadmin/keepalived-basics{:target=\"_blank\"} https://www.redhat.com/sysadmin/advanced-keepalived{:target=\"_blank\"} 테스트 환경 CentOS 7 (Hyper-v) node1 (MASTER) : 192.168.137.201 node2 (BACKUP) : 192.168.137.202 VIP : 192.168.137.200 /etc/keepalived/keepalived.conf vrrp_instance : 인터페이스에서 실행되는 프로토콜의 개별 인스턴스 정의 state : 인스턴스에서 시작해야 하는 초기 상태 interface : 네트워크 인터페이스 virtual_router_id : 네트워크 가상 ID priority : 우선 순위 advert_int : VRRP 패킷 송신 간격 (sec) authentication : 서로 서버간, 인증 계정 정보 virtual_ipaddress : 가상 IP vip MASTER 설정 : 192.168.137.201 vrrp_instance VI_1 { state MASTER interface eth0 virtual_router_id 51 priority 210 advert_int 1 authentication { auth_type PASS auth_pass 1111 } virtual_ipaddress { 192.168.137.200 } } BACKUP 설정 : 192.168.137.202 vrrp_instance VI_1 { state BACKUP interface eth0 virtual_router_id 51 priority 200 advert_int 1 authentication { auth_type PASS auth_pass 1111 } virtual_ipaddress { 192.168.137.200 } } MASTER 노드에 우선순위 priority 210 를 높게 줌\n(1) 서비스 확인 방법 : IP 할당 확인 eth0 인터페이스에 2개의 IP가 보임 Host : inet 192.168.137.201/24 VIP : inet 192.168.137.200/32 $ ip a ... 2: eth0: mtu 1500 qdisc mq state UP group default qlen 1000 link/ether 00:15:5d:3a:4a:02 brd ff:ff:ff:ff:ff:ff inet 192.168.137.201/24 brd 192.168.137.255 scope global noprefixroute eth0 valid_lft forever preferred_lft forever inet 192.168.137.200/32 scope global eth0 valid_lft forever preferred_lft forever inet6 fe80::a576:e68c:a11c:f43/64 scope link noprefixroute valid_lft forever preferred_lft forever (2) 서비스 확인 방법 : VRRP Packet Capture 192.168.137.201 서버에 virtual_router_id(vrid) 51 (192.168.137.200) 할당 $ sudo tcpdump -n vrrp tcpdump: verbose output suppressed, use -v or -vv for full pro listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes 12:08:02.810202 IP 192.168.137.201 \u003e 224.0.0.18: VRRPv2, Advertisement, vrid 51, prio 210, authtype simple, intvl 1s, length 20 12:08:03.811340 IP 192.168.137.201 \u003e 224.0.0.18: VRRPv2, Advertisement, vrid 51, prio 210, authtype simple, intvl 1s, length 20 ... Failover Test 192.168.137.201 서버에서 keepalived 서비스 중지 → 192.168.137.202 로 Failover # 192.168.137.201 MASTER 에서 keepalived 서비스 중지 $ sudo systemctl stop keepalived # 192.168.137.202 서버로 변경 $ sudo tcpdump -n vrrp tcpdump: verbose output suppressed, use -v or -vv for full pro listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes 12:08:49.068284 IP 192.168.137.202 \u003e 224.0.0.18: VRRPv2, Advertisement, vrid 51, prio 200, authtype simple, intvl 1s, length 20 12:08:50.068723 IP 192.168.137.202 \u003e 224.0.0.18: VRRPv2, Advertisement, vrid 51, prio 200, authtype simple, intvl 1s, length 20 # 192.168.137.201 MASTER 에서 keepalived 서비스 다시 시작 $ sudo systemctl start keepalived # 다시 MASTER priority 가 높으로 쪽으로 돌아옴 $ sudo tcpdump -n vrrp tcpdump: verbose output suppressed, use -v or -vv for full pro listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes 12:09:31.084794 IP 192.168.137.201 \u003e 224.0.0.18: VRRPv2, Advertisement, vrid 51, prio 210, authtype simple, intvl 1s, length 20 12:09:32.085300 IP 192.168.137.201 \u003e 224.0.0.18: VRRPv2, Advertisement, vrid 51, prio 210, authtype simple, intvl 1s, length 20 서비스 상태 (Failover 조건) 확인하기 위한 방법 Failover 조건으로서 호스트의 프로세스나 파일, 스크립트 등으로 판단 Tracking processes : 프로세스 명으로 추적 vrrp_track_process track_apache { process httpd weight 10 } vrrp_instance VI_1 { ... track_process { track_apache } } Tracking files : 파일 존재 여부로 추적 vrrp_track_file track_app_file { file /var/run/my_app/vrrp_track_file } vrrp_instance VI_1 { ... track_file { track_app_file weight 1 } } Track interface : 여러개의 Network I/F가 있는 경우 상태로 추적 vrrp_instance VI_1 { ... track_interface { ens9 weight 5 } } Track script : Script 실해 결과로 추적 interval : 스크립트 실행 간격 sec timeout : Timeout 시간 sec rise : 호스트가 “정상\"으로 간주되기 위해 스크립트가 성공적으로 반환되어야 하는 횟수 fall : 호스트가 “비정상\"으로 간주되기 위해 스크립트가 성공적으로 반환되지 않는 횟수 $ /etc/keepalived/check.sh $ echo $? 0 vrrp_script keepalived_check { script \"/etc/keepalived/check.sh\" interval 5 timeout 5 fall 3 } vrrp_instance VI_1 { ... track_script { keepalived_check } } VRRP 마스터가 실패하고 다시 자동으로 마스터가 되지 않도록 방지 https://serverfault.com/questions/44122/prevent-vrrp-master-from-becoming-master-once-it-has-failed{:target=\"_blank”} nopreempt 플래그 추가 vrrp_instance VI_1 { state MASTER interface eth0 virtual_router_id 51 priority 210 advert_int 1 nopreempt authentication { auth_type PASS auth_pass 1111 } virtual_ipaddress { 192.168.137.200 } } ","wordCount":"872","inLanguage":"en","datePublished":"2021-10-25T00:00:00+09:00","dateModified":"2021-10-25T00:00:00+09:00","author":{"@type":"Person","name":"Byung Kyu KIM"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://cdecl.github.io/devops/keepalived-basic/"},"publisher":{"@type":"Organization","name":"cdeclog","logo":{"@type":"ImageObject","url":"https://cdecl.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://cdecl.github.io/ accesskey=h title="cdeclog (Alt + H)">cdeclog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://cdecl.github.io/dev/ title=Dev><span>Dev</span></a></li><li><a href=https://cdecl.github.io/devops/ title=DevOps><span>DevOps</span></a></li><li><a href=https://cdecl.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://cdecl.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://cdecl.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://cdecl.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://cdecl.github.io/devops/>Devops</a></div><h1 class="post-title entry-hint-parent">Keepalived Basic</h1><div class=post-meta><span title='2021-10-25 00:00:00 +0900 KST'>October 25, 2021</span>&nbsp;·&nbsp;<span>Byung Kyu KIM</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#keepalived aria-label=Keepalived>Keepalived</a><ul><li><a href=#install aria-label=Install>Install</a></li><li><a href=#%ea%b8%b0%eb%b3%b8-%ec%84%a4%ec%a0%95 aria-label="기본 설정">기본 설정</a><ul><li><a href=#%ed%85%8c%ec%8a%a4%ed%8a%b8-%ed%99%98%ea%b2%bd aria-label="테스트 환경">테스트 환경</a></li><li><a href=#etckeepalivedkeepalivedconf aria-label=/etc/keepalived/keepalived.conf>/etc/keepalived/keepalived.conf</a><ul><li><a href=#master-%ec%84%a4%ec%a0%95--192168137201 aria-label="MASTER 설정 : 192.168.137.201">MASTER 설정 : 192.168.137.201</a></li><li><a href=#backup-%ec%84%a4%ec%a0%95--192168137202 aria-label="BACKUP 설정 : 192.168.137.202">BACKUP 설정 : 192.168.137.202</a></li></ul></li><li><a href=#1-%ec%84%9c%eb%b9%84%ec%8a%a4-%ed%99%95%ec%9d%b8-%eb%b0%a9%eb%b2%95--ip-%ed%95%a0%eb%8b%b9-%ed%99%95%ec%9d%b8 aria-label="(1) 서비스 확인 방법 : IP 할당 확인">(1) 서비스 확인 방법 : IP 할당 확인</a></li><li><a href=#2-%ec%84%9c%eb%b9%84%ec%8a%a4-%ed%99%95%ec%9d%b8-%eb%b0%a9%eb%b2%95--vrrp-packet-capture aria-label="(2) 서비스 확인 방법 : VRRP Packet Capture">(2) 서비스 확인 방법 : VRRP Packet Capture</a></li></ul></li><li><a href=#failover-test aria-label="Failover Test">Failover Test</a></li><li><a href=#%ec%84%9c%eb%b9%84%ec%8a%a4-%ec%83%81%ed%83%9c-failover-%ec%a1%b0%ea%b1%b4-%ed%99%95%ec%9d%b8%ed%95%98%ea%b8%b0-%ec%9c%84%ed%95%9c-%eb%b0%a9%eb%b2%95 aria-label="서비스 상태 (Failover 조건) 확인하기 위한 방법">서비스 상태 (Failover 조건) 확인하기 위한 방법</a><ul><ul><li><a href=#tracking-processes--%ed%94%84%eb%a1%9c%ec%84%b8%ec%8a%a4-%eb%aa%85%ec%9c%bc%eb%a1%9c-%ec%b6%94%ec%a0%81 aria-label="Tracking processes : 프로세스 명으로 추적">Tracking processes : 프로세스 명으로 추적</a></li><li><a href=#tracking-files--%ed%8c%8c%ec%9d%bc-%ec%a1%b4%ec%9e%ac-%ec%97%ac%eb%b6%80%eb%a1%9c-%ec%b6%94%ec%a0%81 aria-label="Tracking files : 파일 존재 여부로 추적">Tracking files : 파일 존재 여부로 추적</a></li><li><a href=#track-interface--%ec%97%ac%eb%9f%ac%ea%b0%9c%ec%9d%98-network-if%ea%b0%80-%ec%9e%88%eb%8a%94-%ea%b2%bd%ec%9a%b0-%ec%83%81%ed%83%9c%eb%a1%9c-%ec%b6%94%ec%a0%81 aria-label="Track interface : 여러개의 Network I/F가 있는 경우 상태로 추적">Track interface : 여러개의 Network I/F가 있는 경우 상태로 추적</a></li><li><a href=#track-script--script-%ec%8b%a4%ed%95%b4-%ea%b2%b0%ea%b3%bc%eb%a1%9c-%ec%b6%94%ec%a0%81 aria-label="Track script : Script 실해 결과로 추적">Track script : Script 실해 결과로 추적</a></li></ul></ul></li><li><a href=#vrrp-%eb%a7%88%ec%8a%a4%ed%84%b0%ea%b0%80-%ec%8b%a4%ed%8c%a8%ed%95%98%ea%b3%a0-%eb%8b%a4%ec%8b%9c-%ec%9e%90%eb%8f%99%ec%9c%bc%eb%a1%9c-%eb%a7%88%ec%8a%a4%ed%84%b0%ea%b0%80-%eb%90%98%ec%a7%80-%ec%95%8a%eb%8f%84%eb%a1%9d-%eb%b0%a9%ec%a7%80 aria-label="VRRP 마스터가 실패하고 다시 자동으로 마스터가 되지 않도록 방지">VRRP 마스터가 실패하고 다시 자동으로 마스터가 되지 않도록 방지</a></li></ul></li></ul></div></details></div><div class=post-content><p>Loadbalancing & High-Availability 를 위한 Keepalived 설정 및 테스트</p><h2 id=keepalived>Keepalived<a hidden class=anchor aria-hidden=true href=#keepalived>#</a></h2><ul><li><a href=https://www.keepalived.org/>https://www.keepalived.org/</a>{:target="_blank"}</li><li>VRRP 를 활용 가상IP (VIP) 기반 서버 다중화 도구</li></ul><blockquote><p>VRRP 는 여러 대의 라우터를 그룹으로 묶어 하나의 가상 IP 어드레스를 부여,<br>마스터로 지정된 라우터 장애시 VRRP 그룹 내의 백업 라우터가 마스터로 자동 전환되는 프로토콜입니다.</p></blockquote><h3 id=install>Install<a hidden class=anchor aria-hidden=true href=#install>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#6272a4># install</span>
</span></span><span style=display:flex><span>$ sudo yum install keepalived 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># service start</span>
</span></span><span style=display:flex><span>$ sudo systemctl start keepalived
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ sudo systemctl status keepalived
</span></span><span style=display:flex><span>● keepalived.service - LVS and VRRP High Availability Monitor
</span></span><span style=display:flex><span>   Loaded: loaded <span style=color:#ff79c6>(</span>/usr/lib/systemd/system/keepalived.service; disabled; vendor preset: disabled<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>   Active: active <span style=color:#ff79c6>(</span>running<span style=color:#ff79c6>)</span> since 화 2021-10-26 11:37:04 KST; 4s ago
</span></span><span style=display:flex><span>  Process: <span style=color:#bd93f9>18356</span> <span style=color:#8be9fd;font-style:italic>ExecStart</span><span style=color:#ff79c6>=</span>/usr/sbin/keepalived <span style=color:#8be9fd;font-style:italic>$KEEPALIVED_OPTIONS</span> <span style=color:#ff79c6>(</span><span style=color:#8be9fd;font-style:italic>code</span><span style=color:#ff79c6>=</span>exited, <span style=color:#8be9fd;font-style:italic>status</span><span style=color:#ff79c6>=</span>0/SUCCESS<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span> Main PID: <span style=color:#bd93f9>18357</span> <span style=color:#ff79c6>(</span>keepalived<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>    Tasks: <span style=color:#bd93f9>3</span>
</span></span><span style=display:flex><span>   Memory: 1.6M
</span></span><span style=display:flex><span>   CGroup: /system.slice/keepalived.service
</span></span><span style=display:flex><span>           ├─18357 /usr/sbin/keepalived -D
</span></span><span style=display:flex><span>           ├─18358 /usr/sbin/keepalived -D
</span></span><span style=display:flex><span>           └─18359 /usr/sbin/keepalived -D
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10월 <span style=color:#bd93f9>26</span> 11:37:05 node1 Keepalived_vrrp<span style=color:#ff79c6>[</span>18359<span style=color:#ff79c6>]</span>: VRRP_Instance<span style=color:#ff79c6>(</span>VI_1<span style=color:#ff79c6>)</span> forcing a new MASTER ...on
</span></span><span style=display:flex><span>10월 <span style=color:#bd93f9>26</span> 11:37:06 node1 Keepalived_vrrp<span style=color:#ff79c6>[</span>18359<span style=color:#ff79c6>]</span>: VRRP_Instance<span style=color:#ff79c6>(</span>VI_1<span style=color:#ff79c6>)</span> Transition to MASTER STATE
</span></span><span style=display:flex><span>10월 <span style=color:#bd93f9>26</span> 11:37:07 node1 Keepalived_vrrp<span style=color:#ff79c6>[</span>18359<span style=color:#ff79c6>]</span>: VRRP_Instance<span style=color:#ff79c6>(</span>VI_1<span style=color:#ff79c6>)</span> Entering MASTER STATE
</span></span><span style=display:flex><span>10월 <span style=color:#bd93f9>26</span> 11:37:07 node1 Keepalived_vrrp<span style=color:#ff79c6>[</span>18359<span style=color:#ff79c6>]</span>: VRRP_Instance<span style=color:#ff79c6>(</span>VI_1<span style=color:#ff79c6>)</span> setting pro
</span></span><span style=display:flex><span>10월 <span style=color:#bd93f9>26</span> 11:37:07 node1 Keepalived_vrrp<span style=color:#ff79c6>[</span>18359<span style=color:#ff79c6>]</span>: Sending gratuitous ARP on eth0 <span style=color:#ff79c6>for</span> 192.16...00
</span></span><span style=display:flex><span>10월 <span style=color:#bd93f9>26</span> 11:37:07 node1 Keepalived_vrrp<span style=color:#ff79c6>[</span>18359<span style=color:#ff79c6>]</span>: VRRP_Instance<span style=color:#ff79c6>(</span>VI_1<span style=color:#ff79c6>)</span> Sending/queueing grat...00
</span></span><span style=display:flex><span>10월 <span style=color:#bd93f9>26</span> 11:37:07 node1 Keepalived_vrrp<span style=color:#ff79c6>[</span>18359<span style=color:#ff79c6>]</span>: Sending gratuitous ARP on eth0 <span style=color:#ff79c6>for</span> 192.16...00
</span></span><span style=display:flex><span>10월 <span style=color:#bd93f9>26</span> 11:37:07 node1 Keepalived_vrrp<span style=color:#ff79c6>[</span>18359<span style=color:#ff79c6>]</span>: Sending gratuitous ARP on eth0 <span style=color:#ff79c6>for</span> 192.16...00
</span></span><span style=display:flex><span>10월 <span style=color:#bd93f9>26</span> 11:37:07 node1 Keepalived_vrrp<span style=color:#ff79c6>[</span>18359<span style=color:#ff79c6>]</span>: Sending gratuitous ARP on eth0 <span style=color:#ff79c6>for</span> 192.16...00
</span></span><span style=display:flex><span>10월 <span style=color:#bd93f9>26</span> 11:37:07 node1 Keepalived_vrrp<span style=color:#ff79c6>[</span>18359<span style=color:#ff79c6>]</span>: Sending gratuitous ARP on eth0 <span style=color:#ff79c6>for</span> 192.16...00
</span></span><span style=display:flex><span>Hint: Some lines were ellipsized, use -l to show in full.
</span></span></code></pre></div><hr><h3 id=기본-설정>기본 설정<a hidden class=anchor aria-hidden=true href=#기본-설정>#</a></h3><ul><li><a href=https://www.redhat.com/sysadmin/keepalived-basics>https://www.redhat.com/sysadmin/keepalived-basics</a>{:target="_blank"}</li><li><a href=https://www.redhat.com/sysadmin/advanced-keepalived>https://www.redhat.com/sysadmin/advanced-keepalived</a>{:target="_blank"}</li></ul><h4 id=테스트-환경>테스트 환경<a hidden class=anchor aria-hidden=true href=#테스트-환경>#</a></h4><ul><li>CentOS 7 (<code>Hyper-v</code>)<ul><li><code>node1</code> (<code>MASTER</code>) : <code>192.168.137.201</code></li><li><code>node2</code> (<code>BACKUP</code>) : <code>192.168.137.202</code></li></ul></li><li><code>VIP</code> : <code>192.168.137.200</code></li></ul><h4 id=etckeepalivedkeepalivedconf><code>/etc/keepalived/keepalived.conf</code><a hidden class=anchor aria-hidden=true href=#etckeepalivedkeepalivedconf>#</a></h4><ul><li><code>vrrp_instance</code> : 인터페이스에서 실행되는 프로토콜의 개별 인스턴스 정의</li><li><code>state</code> : 인스턴스에서 시작해야 하는 초기 상태</li><li><code>interface</code> : 네트워크 인터페이스</li><li><code>virtual_router_id</code> : 네트워크 가상 ID</li><li><code>priority</code> : 우선 순위</li><li><code>advert_int</code> : <code>VRRP</code> 패킷 송신 간격 (sec)</li><li><code>authentication</code> : 서로 서버간, 인증 계정 정보</li><li><code>virtual_ipaddress</code> : 가상 IP <code>vip</code></li></ul><h5 id=master-설정--192168137201>MASTER 설정 : <code>192.168.137.201</code><a hidden class=anchor aria-hidden=true href=#master-설정--192168137201>#</a></h5><pre tabindex=0><code class=language-conf data-lang=conf>vrrp_instance VI_1 {
    state MASTER
    interface eth0
    virtual_router_id 51
    priority 210
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
        192.168.137.200
    }
}
</code></pre><h5 id=backup-설정--192168137202>BACKUP 설정 : <code>192.168.137.202</code><a hidden class=anchor aria-hidden=true href=#backup-설정--192168137202>#</a></h5><pre tabindex=0><code class=language-conf data-lang=conf>vrrp_instance VI_1 {
    state BACKUP
    interface eth0
    virtual_router_id 51
    priority 200
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
        192.168.137.200
    }
}
</code></pre><blockquote><p><code>MASTER</code> 노드에 우선순위 <code>priority 210</code> 를 높게 줌</p></blockquote><hr><h4 id=1-서비스-확인-방법--ip-할당-확인>(1) 서비스 확인 방법 : IP 할당 확인<a hidden class=anchor aria-hidden=true href=#1-서비스-확인-방법--ip-할당-확인>#</a></h4><ul><li><code>eth0</code> 인터페이스에 2개의 IP가 보임<ul><li><code>Host</code> : <code>inet 192.168.137.201/24</code></li><li><code>VIP</code> : <code>inet 192.168.137.200/32</code></li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ ip a
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style=color:#bd93f9>1500</span> qdisc mq state UP group default qlen <span style=color:#bd93f9>1000</span>
</span></span><span style=display:flex><span>    link/ether 00:15:5d:3a:4a:02 brd ff:ff:ff:ff:ff:ff
</span></span><span style=display:flex><span>    inet 192.168.137.201/24 brd 192.168.137.255 scope global noprefixroute eth0
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>    inet 192.168.137.200/32 scope global eth0
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>    inet6 fe80::a576:e68c:a11c:f43/64 scope link noprefixroute
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span></code></pre></div><h4 id=2-서비스-확인-방법--vrrp-packet-capture>(2) 서비스 확인 방법 : VRRP Packet Capture<a hidden class=anchor aria-hidden=true href=#2-서비스-확인-방법--vrrp-packet-capture>#</a></h4><ul><li><code>192.168.137.201</code> 서버에 <code>virtual_router_id(vrid) 51</code> (<code>192.168.137.200</code>) 할당</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ sudo tcpdump -n vrrp
</span></span><span style=display:flex><span>tcpdump: verbose output suppressed, use -v or -vv <span style=color:#ff79c6>for</span> full pro
</span></span><span style=display:flex><span>listening on eth0, link-type EN10MB <span style=color:#ff79c6>(</span>Ethernet<span style=color:#ff79c6>)</span>, capture size <span style=color:#bd93f9>262144</span> bytes
</span></span><span style=display:flex><span>12:08:02.810202 IP 192.168.137.201 &gt; 224.0.0.18: VRRPv2, Advertisement, vrid 51, prio 210, authtype simple, intvl 1s, length <span style=color:#bd93f9>20</span>
</span></span><span style=display:flex><span>12:08:03.811340 IP 192.168.137.201 &gt; 224.0.0.18: VRRPv2, Advertisement, vrid 51, prio 210, authtype simple, intvl 1s, length <span style=color:#bd93f9>20</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><hr><h3 id=failover-test>Failover Test<a hidden class=anchor aria-hidden=true href=#failover-test>#</a></h3><ul><li><code>192.168.137.201</code> 서버에서 <code>keepalived</code> 서비스 중지 → <code>192.168.137.202</code> 로 <code>Failover</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#6272a4># 192.168.137.201 MASTER 에서 keepalived 서비스 중지 </span>
</span></span><span style=display:flex><span>$ sudo systemctl stop keepalived
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 192.168.137.202 서버로 변경 </span>
</span></span><span style=display:flex><span>$ sudo tcpdump -n vrrp
</span></span><span style=display:flex><span>tcpdump: verbose output suppressed, use -v or -vv <span style=color:#ff79c6>for</span> full pro
</span></span><span style=display:flex><span>listening on eth0, link-type EN10MB <span style=color:#ff79c6>(</span>Ethernet<span style=color:#ff79c6>)</span>, capture size <span style=color:#bd93f9>262144</span> bytes
</span></span><span style=display:flex><span>12:08:49.068284 IP 192.168.137.202 &gt; 224.0.0.18: VRRPv2, Advertisement, vrid 51, prio 200, authtype simple, intvl 1s, length <span style=color:#bd93f9>20</span>
</span></span><span style=display:flex><span>12:08:50.068723 IP 192.168.137.202 &gt; 224.0.0.18: VRRPv2, Advertisement, vrid 51, prio 200, authtype simple, intvl 1s, length <span style=color:#bd93f9>20</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 192.168.137.201 MASTER 에서 keepalived 서비스 다시 시작 </span>
</span></span><span style=display:flex><span>$ sudo systemctl start keepalived
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 다시 MASTER priority 가 높으로 쪽으로 돌아옴</span>
</span></span><span style=display:flex><span>$ sudo tcpdump -n vrrp
</span></span><span style=display:flex><span>tcpdump: verbose output suppressed, use -v or -vv <span style=color:#ff79c6>for</span> full pro
</span></span><span style=display:flex><span>listening on eth0, link-type EN10MB <span style=color:#ff79c6>(</span>Ethernet<span style=color:#ff79c6>)</span>, capture size <span style=color:#bd93f9>262144</span> bytes
</span></span><span style=display:flex><span>12:09:31.084794 IP 192.168.137.201 &gt; 224.0.0.18: VRRPv2, Advertisement, vrid 51, prio 210, authtype simple, intvl 1s, length <span style=color:#bd93f9>20</span>
</span></span><span style=display:flex><span>12:09:32.085300 IP 192.168.137.201 &gt; 224.0.0.18: VRRPv2, Advertisement, vrid 51, prio 210, authtype simple, intvl 1s, length <span style=color:#bd93f9>20</span>
</span></span></code></pre></div><hr><h3 id=서비스-상태-failover-조건-확인하기-위한-방법>서비스 상태 (Failover 조건) 확인하기 위한 방법<a hidden class=anchor aria-hidden=true href=#서비스-상태-failover-조건-확인하기-위한-방법>#</a></h3><ul><li><code>Failover</code> 조건으로서 호스트의 프로세스나 파일, 스크립트 등으로 판단</li></ul><h5 id=tracking-processes--프로세스-명으로-추적>Tracking processes : 프로세스 명으로 추적<a hidden class=anchor aria-hidden=true href=#tracking-processes--프로세스-명으로-추적>#</a></h5><pre tabindex=0><code class=language-conf data-lang=conf>vrrp_track_process track_apache {
      process httpd
      weight 10
}

vrrp_instance VI_1 {
      ...
      track_process {
         track_apache
      }
}
</code></pre><h5 id=tracking-files--파일-존재-여부로-추적>Tracking files : 파일 존재 여부로 추적<a hidden class=anchor aria-hidden=true href=#tracking-files--파일-존재-여부로-추적>#</a></h5><pre tabindex=0><code class=language-conf data-lang=conf>vrrp_track_file track_app_file {
      file /var/run/my_app/vrrp_track_file
}

vrrp_instance VI_1 {
    ...
    track_file {
         track_app_file weight 1
    }
}
</code></pre><h5 id=track-interface--여러개의-network-if가-있는-경우-상태로-추적>Track interface : 여러개의 Network I/F가 있는 경우 상태로 추적<a hidden class=anchor aria-hidden=true href=#track-interface--여러개의-network-if가-있는-경우-상태로-추적>#</a></h5><pre tabindex=0><code class=language-conf data-lang=conf>vrrp_instance VI_1 {
    ...
    track_interface {
        ens9 weight 5
    }
}
</code></pre><h5 id=track-script--script-실해-결과로-추적>Track script : Script 실해 결과로 추적<a hidden class=anchor aria-hidden=true href=#track-script--script-실해-결과로-추적>#</a></h5><ul><li><code>interval</code> : 스크립트 실행 간격 <code>sec</code></li><li><code>timeout</code> : Timeout 시간 <code>sec</code></li><li><code>rise</code> : 호스트가 &ldquo;정상"으로 간주되기 위해 스크립트가 성공적으로 반환되어야 하는 횟수</li><li><code>fall</code> : 호스트가 &ldquo;비정상"으로 간주되기 위해 스크립트가 성공적으로 반환되지 않는 횟수</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ /etc/keepalived/check.sh 
</span></span><span style=display:flex><span>$ <span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#8be9fd;font-style:italic>$?</span>
</span></span><span style=display:flex><span><span style=color:#bd93f9>0</span>
</span></span></code></pre></div><pre tabindex=0><code class=language-conf data-lang=conf>vrrp_script keepalived_check {
      script &#34;/etc/keepalived/check.sh&#34;
      interval 5
      timeout 5
      fall 3
}

vrrp_instance VI_1 {
    ...
    track_script {
        keepalived_check
    }
}
</code></pre><hr><h3 id=vrrp-마스터가-실패하고-다시-자동으로-마스터가-되지-않도록-방지>VRRP 마스터가 실패하고 다시 자동으로 마스터가 되지 않도록 방지<a hidden class=anchor aria-hidden=true href=#vrrp-마스터가-실패하고-다시-자동으로-마스터가-되지-않도록-방지>#</a></h3><ul><li><a href=https://serverfault.com/questions/44122/prevent-vrrp-master-from-becoming-master-once-it-has-failed>https://serverfault.com/questions/44122/prevent-vrrp-master-from-becoming-master-once-it-has-failed</a>{:target="_blank&rdquo;}</li><li><code>nopreempt</code> 플래그 추가</li></ul><pre tabindex=0><code class=language-conf data-lang=conf>vrrp_instance VI_1 {
    state MASTER
    interface eth0
    virtual_router_id 51
    priority 210
    advert_int 1
    nopreempt
    authentication {
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
        192.168.137.200
    }
}
</code></pre></div><footer class=post-footer><ul class=post-tags><li><a href=https://cdecl.github.io/tags/keepalived/>Keepalived</a></li><li><a href=https://cdecl.github.io/tags/vrrp/>Vrrp</a></li><li><a href=https://cdecl.github.io/tags/loadbalancing/>Loadbalancing</a></li><li><a href=https://cdecl.github.io/tags/ha/>Ha</a></li></ul></footer><script src=https://giscus.app/client.js data-repo=cdecl/cdecl.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkzNDk1ODUyNjg=" data-category=General data-category-id=DIC_kwDOFNY_dM4C1XMk data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=transparent_dark data-lang=ko crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2026 <a href=https://cdecl.github.io/>cdeclog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>