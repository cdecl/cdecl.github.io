<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>K3S Overview | cdeclog</title><meta name=keywords content="k3s,k8s,Kubernetes,rancher"><meta name=description content='Lightweight Kubernetes : The certified Kubernetes distribution built for IoT & Edge computing
특징

https://k3s.io/{:target="_blank"}
Kubernetes의 경량화 버전으로 아래와 같은 특징

기본 설치만으로 바로 배포 테스트 가능
Overlay Netowrk(Flannel), Load balancer, Ingress(Traefik), CoreDNS 등이 기본 설치 됨

https://rancher.com/docs/k3s/latest/en/networking/{:target="_blank"}


etcd 대신 sqlite 운영

High Availability with an External DB
High Availability with Embedded DB (Experimental)


Master node schedulable

uncordon 제외 가능
Worker node 필요 없음 (필요시 추가 가능)





사용 목적

Edge Computing
개발 테스트 및 스테이징 서버 구성
기타 어플리케이션 테스트 용

Master 설치

설치 curl -sfL https://get.k3s.io | sh - 실행으로 끝

systemd 관리 


kubectl 설치 및 심볼릭 링크 설정 해줌

이미 kubectl 가 설치 되어 있는 경우는 심볼릭 링크 실패



# alias 필요시 아래 참고 
$ alias kubectl=&#39;sudo k3s kubectl&#39; 
# Install
$ curl -sfL https://get.k3s.io | sh -

# master node
$ kubectl get node
NAME      STATUS   ROLES                  AGE   VERSION
centos1   Ready    control-plane,master   37s   v1.21.3+k3s1

$ kubectl get pod -A
NAMESPACE     NAME                                      READY   STATUS      RESTARTS   AGE
kube-system   local-path-provisioner-5ff76fc89d-wh9cg   1/1     Running     0          2m35s
kube-system   coredns-7448499f4d-2d7pb                  1/1     Running     0          2m35s
kube-system   metrics-server-86cbb8457f-x9l6n           1/1     Running     0          2m35s
kube-system   helm-install-traefik-crd-w27q7            0/1     Completed   0          2m35s
kube-system   helm-install-traefik-2zllj                0/1     Completed   1          2m35s
kube-system   svclb-traefik-55qfd                       2/2     Running     0          113s
kube-system   traefik-97b44b794-smzl9                   1/1     Running     0          114s
K8S 서비스 테스트

서비스 타입 : NodePort
https://kubernetes.github.io/ingress-nginx/deploy/baremetal/{:target="_blank"}

apiVersion: apps/v1
kind: Deployment
metadata:
  name: mvcapp
spec:
  selector:
    matchLabels:
      app: mvcapp
  replicas: 2 # --replicas=2 옵션과 동일 
  template: 
    metadata:
      labels:
        app: mvcapp
    spec:
      containers:
      - name: mvcapp
        image: cdecl/mvcapp:0.6
        ports:
        - containerPort: 80

---
apiVersion: v1
kind: Service
metadata:
  name: mvcapp
spec:
  type: NodePort
  selector:
    app: mvcapp
  ports:
  - port: 80
    targetPort: 80
$ kubectl apply -f mvcapp-deploy-service.yaml
deployment.apps/mvcapp created
service/mvcapp created

$ kubectl get pod -A
NAMESPACE     NAME                                      READY   STATUS      RESTARTS   AGE
kube-system   local-path-provisioner-5ff76fc89d-wh9cg   1/1     Running     0          9m29s
kube-system   coredns-7448499f4d-2d7pb                  1/1     Running     0          9m29s
kube-system   metrics-server-86cbb8457f-x9l6n           1/1     Running     0          9m29s
kube-system   helm-install-traefik-crd-w27q7            0/1     Completed   0          9m29s
kube-system   helm-install-traefik-2zllj                0/1     Completed   1          9m29s
kube-system   svclb-traefik-55qfd                       2/2     Running     0          8m47s
kube-system   traefik-97b44b794-smzl9                   1/1     Running     0          8m48s
default       mvcapp-79874d888c-6htvq                   1/1     Running     0          62s
default       mvcapp-79874d888c-clslc                   1/1     Running     0          62s

$ kubectl get svc
NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE
kubernetes   ClusterIP   10.43.0.1      <none>        443/TCP        10m
mvcapp       NodePort    10.43.36.139   <none>        80:32105/TCP   106s

# Nodeport IP
$ curl 10.43.36.139:80
    * Project           : Mvcapp
    * Version           : 0.5 / net5.0
    * Hostname          : mvcapp-79874d888c-6htvq
    * RemoteAddr        : 10.42.0.1
    * X-Forwarded-For   :
    * Request Count     : 1
    * User-Agent        : curl/7.29.0

$ curl localhost:32105
    * Project           : Mvcapp
    * Version           : 0.5 / net5.0
    * Hostname          : mvcapp-79874d888c-clslc
    * RemoteAddr        : 10.42.0.1
    * X-Forwarded-For   :
    * Request Count     : 1
    * User-Agent        : curl/7.29.0
Agent 추가

Master Node만으로도 테스트 가능하나 Scale 테스트시 Agent(Worker Node) 추가 가능
환경변수 세팅 : 필요시 참고

$ sudo cat /var/lib/rancher/k3s/server/node-token	 > ~/.node-token
$ K3S_TOKEN=$(< ~/.node-token)
$ HOST_IP=$(ip a | sed -rn &#39;s/.*inet ([0-9\.]+).*eth0/\1/p&#39;)
Agent 등록 : 원격실행 OR Agent 머신에서 실행

HostIP, Token 정보 필요 (위 환경변수 세팅 참고)

# Agent 머신에서 실행 
$ curl -sfL https://get.k3s.io | K3S_URL=https://$HOST_IP:6443 K3S_TOKEN=$K3S_TOKEN sh -

# Agent 추가 다른방법 
$ ansible node01 -m shell -a "curl -sfL https://get.k3s.io | sh -s - agent --server https://$HOST_IP:6443 --token $K3S_TOKEN" -v

K3S 삭제
ls /usr/local/bin/k3s-* | xargs -n1 sh -
'><meta name=author content="Byung Kyu KIM"><link rel=canonical href=https://cdecl.github.io/devops/k3s-overview/><link crossorigin=anonymous href=/assets/css/stylesheet.94cdd6e6bf254a927ddb1a5b8ae2c24a30232449c016f55d87efd0d9bed87c55.css integrity="sha256-lM3W5r8lSpJ92xpbiuLCSjAjJEnAFvVdh+/Q2b7YfFU=" rel="preload stylesheet" as=style><link rel=icon href=https://cdecl.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://cdecl.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://cdecl.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://cdecl.github.io/apple-touch-icon.png><link rel=mask-icon href=https://cdecl.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://cdecl.github.io/devops/k3s-overview/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-VQQHHYPN7K"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VQQHHYPN7K")}</script><meta property="og:url" content="https://cdecl.github.io/devops/k3s-overview/"><meta property="og:site_name" content="cdeclog"><meta property="og:title" content="K3S Overview"><meta property="og:description" content='Lightweight Kubernetes : The certified Kubernetes distribution built for IoT & Edge computing
특징 https://k3s.io/{:target="_blank"} Kubernetes의 경량화 버전으로 아래와 같은 특징 기본 설치만으로 바로 배포 테스트 가능 Overlay Netowrk(Flannel), Load balancer, Ingress(Traefik), CoreDNS 등이 기본 설치 됨 https://rancher.com/docs/k3s/latest/en/networking/{:target="_blank"} etcd 대신 sqlite 운영 High Availability with an External DB High Availability with Embedded DB (Experimental) Master node schedulable uncordon 제외 가능 Worker node 필요 없음 (필요시 추가 가능) 사용 목적 Edge Computing 개발 테스트 및 스테이징 서버 구성 기타 어플리케이션 테스트 용 Master 설치 설치 curl -sfL https://get.k3s.io | sh - 실행으로 끝 systemd 관리 kubectl 설치 및 심볼릭 링크 설정 해줌 이미 kubectl 가 설치 되어 있는 경우는 심볼릭 링크 실패 # alias 필요시 아래 참고 $ alias kubectl=&#39;sudo k3s kubectl&#39; # Install $ curl -sfL https://get.k3s.io | sh - # master node $ kubectl get node NAME STATUS ROLES AGE VERSION centos1 Ready control-plane,master 37s v1.21.3+k3s1 $ kubectl get pod -A NAMESPACE NAME READY STATUS RESTARTS AGE kube-system local-path-provisioner-5ff76fc89d-wh9cg 1/1 Running 0 2m35s kube-system coredns-7448499f4d-2d7pb 1/1 Running 0 2m35s kube-system metrics-server-86cbb8457f-x9l6n 1/1 Running 0 2m35s kube-system helm-install-traefik-crd-w27q7 0/1 Completed 0 2m35s kube-system helm-install-traefik-2zllj 0/1 Completed 1 2m35s kube-system svclb-traefik-55qfd 2/2 Running 0 113s kube-system traefik-97b44b794-smzl9 1/1 Running 0 114s K8S 서비스 테스트 서비스 타입 : NodePort https://kubernetes.github.io/ingress-nginx/deploy/baremetal/{:target="_blank"} apiVersion: apps/v1 kind: Deployment metadata: name: mvcapp spec: selector: matchLabels: app: mvcapp replicas: 2 # --replicas=2 옵션과 동일 template: metadata: labels: app: mvcapp spec: containers: - name: mvcapp image: cdecl/mvcapp:0.6 ports: - containerPort: 80 --- apiVersion: v1 kind: Service metadata: name: mvcapp spec: type: NodePort selector: app: mvcapp ports: - port: 80 targetPort: 80 $ kubectl apply -f mvcapp-deploy-service.yaml deployment.apps/mvcapp created service/mvcapp created $ kubectl get pod -A NAMESPACE NAME READY STATUS RESTARTS AGE kube-system local-path-provisioner-5ff76fc89d-wh9cg 1/1 Running 0 9m29s kube-system coredns-7448499f4d-2d7pb 1/1 Running 0 9m29s kube-system metrics-server-86cbb8457f-x9l6n 1/1 Running 0 9m29s kube-system helm-install-traefik-crd-w27q7 0/1 Completed 0 9m29s kube-system helm-install-traefik-2zllj 0/1 Completed 1 9m29s kube-system svclb-traefik-55qfd 2/2 Running 0 8m47s kube-system traefik-97b44b794-smzl9 1/1 Running 0 8m48s default mvcapp-79874d888c-6htvq 1/1 Running 0 62s default mvcapp-79874d888c-clslc 1/1 Running 0 62s $ kubectl get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kubernetes ClusterIP 10.43.0.1 <none> 443/TCP 10m mvcapp NodePort 10.43.36.139 <none> 80:32105/TCP 106s # Nodeport IP $ curl 10.43.36.139:80 * Project : Mvcapp * Version : 0.5 / net5.0 * Hostname : mvcapp-79874d888c-6htvq * RemoteAddr : 10.42.0.1 * X-Forwarded-For : * Request Count : 1 * User-Agent : curl/7.29.0 $ curl localhost:32105 * Project : Mvcapp * Version : 0.5 / net5.0 * Hostname : mvcapp-79874d888c-clslc * RemoteAddr : 10.42.0.1 * X-Forwarded-For : * Request Count : 1 * User-Agent : curl/7.29.0 Agent 추가 Master Node만으로도 테스트 가능하나 Scale 테스트시 Agent(Worker Node) 추가 가능 환경변수 세팅 : 필요시 참고 $ sudo cat /var/lib/rancher/k3s/server/node-token	> ~/.node-token $ K3S_TOKEN=$(< ~/.node-token) $ HOST_IP=$(ip a | sed -rn &#39;s/.*inet ([0-9\.]+).*eth0/\1/p&#39;) Agent 등록 : 원격실행 OR Agent 머신에서 실행 HostIP, Token 정보 필요 (위 환경변수 세팅 참고) # Agent 머신에서 실행 $ curl -sfL https://get.k3s.io | K3S_URL=https://$HOST_IP:6443 K3S_TOKEN=$K3S_TOKEN sh - # Agent 추가 다른방법 $ ansible node01 -m shell -a "curl -sfL https://get.k3s.io | sh -s - agent --server https://$HOST_IP:6443 --token $K3S_TOKEN" -v K3S 삭제 ls /usr/local/bin/k3s-* | xargs -n1 sh - '><meta property="og:locale" content="ko-kr"><meta property="og:type" content="article"><meta property="article:section" content="devops"><meta property="article:published_time" content="2021-08-17T00:00:00+09:00"><meta property="article:modified_time" content="2021-08-17T00:00:00+09:00"><meta property="article:tag" content="K3s"><meta property="article:tag" content="K8s"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="Rancher"><meta name=twitter:card content="summary"><meta name=twitter:title content="K3S Overview"><meta name=twitter:description content='Lightweight Kubernetes : The certified Kubernetes distribution built for IoT & Edge computing
특징

https://k3s.io/{:target="_blank"}
Kubernetes의 경량화 버전으로 아래와 같은 특징

기본 설치만으로 바로 배포 테스트 가능
Overlay Netowrk(Flannel), Load balancer, Ingress(Traefik), CoreDNS 등이 기본 설치 됨

https://rancher.com/docs/k3s/latest/en/networking/{:target="_blank"}


etcd 대신 sqlite 운영

High Availability with an External DB
High Availability with Embedded DB (Experimental)


Master node schedulable

uncordon 제외 가능
Worker node 필요 없음 (필요시 추가 가능)





사용 목적

Edge Computing
개발 테스트 및 스테이징 서버 구성
기타 어플리케이션 테스트 용

Master 설치

설치 curl -sfL https://get.k3s.io | sh - 실행으로 끝

systemd 관리 


kubectl 설치 및 심볼릭 링크 설정 해줌

이미 kubectl 가 설치 되어 있는 경우는 심볼릭 링크 실패



# alias 필요시 아래 참고 
$ alias kubectl=&#39;sudo k3s kubectl&#39; 
# Install
$ curl -sfL https://get.k3s.io | sh -

# master node
$ kubectl get node
NAME      STATUS   ROLES                  AGE   VERSION
centos1   Ready    control-plane,master   37s   v1.21.3+k3s1

$ kubectl get pod -A
NAMESPACE     NAME                                      READY   STATUS      RESTARTS   AGE
kube-system   local-path-provisioner-5ff76fc89d-wh9cg   1/1     Running     0          2m35s
kube-system   coredns-7448499f4d-2d7pb                  1/1     Running     0          2m35s
kube-system   metrics-server-86cbb8457f-x9l6n           1/1     Running     0          2m35s
kube-system   helm-install-traefik-crd-w27q7            0/1     Completed   0          2m35s
kube-system   helm-install-traefik-2zllj                0/1     Completed   1          2m35s
kube-system   svclb-traefik-55qfd                       2/2     Running     0          113s
kube-system   traefik-97b44b794-smzl9                   1/1     Running     0          114s
K8S 서비스 테스트

서비스 타입 : NodePort
https://kubernetes.github.io/ingress-nginx/deploy/baremetal/{:target="_blank"}

apiVersion: apps/v1
kind: Deployment
metadata:
  name: mvcapp
spec:
  selector:
    matchLabels:
      app: mvcapp
  replicas: 2 # --replicas=2 옵션과 동일 
  template: 
    metadata:
      labels:
        app: mvcapp
    spec:
      containers:
      - name: mvcapp
        image: cdecl/mvcapp:0.6
        ports:
        - containerPort: 80

---
apiVersion: v1
kind: Service
metadata:
  name: mvcapp
spec:
  type: NodePort
  selector:
    app: mvcapp
  ports:
  - port: 80
    targetPort: 80
$ kubectl apply -f mvcapp-deploy-service.yaml
deployment.apps/mvcapp created
service/mvcapp created

$ kubectl get pod -A
NAMESPACE     NAME                                      READY   STATUS      RESTARTS   AGE
kube-system   local-path-provisioner-5ff76fc89d-wh9cg   1/1     Running     0          9m29s
kube-system   coredns-7448499f4d-2d7pb                  1/1     Running     0          9m29s
kube-system   metrics-server-86cbb8457f-x9l6n           1/1     Running     0          9m29s
kube-system   helm-install-traefik-crd-w27q7            0/1     Completed   0          9m29s
kube-system   helm-install-traefik-2zllj                0/1     Completed   1          9m29s
kube-system   svclb-traefik-55qfd                       2/2     Running     0          8m47s
kube-system   traefik-97b44b794-smzl9                   1/1     Running     0          8m48s
default       mvcapp-79874d888c-6htvq                   1/1     Running     0          62s
default       mvcapp-79874d888c-clslc                   1/1     Running     0          62s

$ kubectl get svc
NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE
kubernetes   ClusterIP   10.43.0.1      <none>        443/TCP        10m
mvcapp       NodePort    10.43.36.139   <none>        80:32105/TCP   106s

# Nodeport IP
$ curl 10.43.36.139:80
    * Project           : Mvcapp
    * Version           : 0.5 / net5.0
    * Hostname          : mvcapp-79874d888c-6htvq
    * RemoteAddr        : 10.42.0.1
    * X-Forwarded-For   :
    * Request Count     : 1
    * User-Agent        : curl/7.29.0

$ curl localhost:32105
    * Project           : Mvcapp
    * Version           : 0.5 / net5.0
    * Hostname          : mvcapp-79874d888c-clslc
    * RemoteAddr        : 10.42.0.1
    * X-Forwarded-For   :
    * Request Count     : 1
    * User-Agent        : curl/7.29.0
Agent 추가

Master Node만으로도 테스트 가능하나 Scale 테스트시 Agent(Worker Node) 추가 가능
환경변수 세팅 : 필요시 참고

$ sudo cat /var/lib/rancher/k3s/server/node-token	 > ~/.node-token
$ K3S_TOKEN=$(< ~/.node-token)
$ HOST_IP=$(ip a | sed -rn &#39;s/.*inet ([0-9\.]+).*eth0/\1/p&#39;)
Agent 등록 : 원격실행 OR Agent 머신에서 실행

HostIP, Token 정보 필요 (위 환경변수 세팅 참고)

# Agent 머신에서 실행 
$ curl -sfL https://get.k3s.io | K3S_URL=https://$HOST_IP:6443 K3S_TOKEN=$K3S_TOKEN sh -

# Agent 추가 다른방법 
$ ansible node01 -m shell -a "curl -sfL https://get.k3s.io | sh -s - agent --server https://$HOST_IP:6443 --token $K3S_TOKEN" -v

K3S 삭제
ls /usr/local/bin/k3s-* | xargs -n1 sh -
'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Devops","item":"https://cdecl.github.io/devops/"},{"@type":"ListItem","position":2,"name":"K3S Overview","item":"https://cdecl.github.io/devops/k3s-overview/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"K3S Overview","name":"K3S Overview","description":"Lightweight Kubernetes : The certified Kubernetes distribution built for IoT \u0026amp; Edge computing\n특징 https://k3s.io/{:target=\u0026quot;_blank\u0026quot;} Kubernetes의 경량화 버전으로 아래와 같은 특징 기본 설치만으로 바로 배포 테스트 가능 Overlay Netowrk(Flannel), Load balancer, Ingress(Traefik), CoreDNS 등이 기본 설치 됨 https://rancher.com/docs/k3s/latest/en/networking/{:target=\u0026quot;_blank\u0026quot;} etcd 대신 sqlite 운영 High Availability with an External DB High Availability with Embedded DB (Experimental) Master node schedulable uncordon 제외 가능 Worker node 필요 없음 (필요시 추가 가능) 사용 목적 Edge Computing 개발 테스트 및 스테이징 서버 구성 기타 어플리케이션 테스트 용 Master 설치 설치 curl -sfL https://get.k3s.io | sh - 실행으로 끝 systemd 관리 kubectl 설치 및 심볼릭 링크 설정 해줌 이미 kubectl 가 설치 되어 있는 경우는 심볼릭 링크 실패 # alias 필요시 아래 참고 $ alias kubectl=\u0026#39;sudo k3s kubectl\u0026#39; # Install $ curl -sfL https://get.k3s.io | sh - # master node $ kubectl get node NAME STATUS ROLES AGE VERSION centos1 Ready control-plane,master 37s v1.21.3+k3s1 $ kubectl get pod -A NAMESPACE NAME READY STATUS RESTARTS AGE kube-system local-path-provisioner-5ff76fc89d-wh9cg 1/1 Running 0 2m35s kube-system coredns-7448499f4d-2d7pb 1/1 Running 0 2m35s kube-system metrics-server-86cbb8457f-x9l6n 1/1 Running 0 2m35s kube-system helm-install-traefik-crd-w27q7 0/1 Completed 0 2m35s kube-system helm-install-traefik-2zllj 0/1 Completed 1 2m35s kube-system svclb-traefik-55qfd 2/2 Running 0 113s kube-system traefik-97b44b794-smzl9 1/1 Running 0 114s K8S 서비스 테스트 서비스 타입 : NodePort https://kubernetes.github.io/ingress-nginx/deploy/baremetal/{:target=\u0026quot;_blank\u0026quot;} apiVersion: apps/v1 kind: Deployment metadata: name: mvcapp spec: selector: matchLabels: app: mvcapp replicas: 2 # --replicas=2 옵션과 동일 template: metadata: labels: app: mvcapp spec: containers: - name: mvcapp image: cdecl/mvcapp:0.6 ports: - containerPort: 80 --- apiVersion: v1 kind: Service metadata: name: mvcapp spec: type: NodePort selector: app: mvcapp ports: - port: 80 targetPort: 80 $ kubectl apply -f mvcapp-deploy-service.yaml deployment.apps/mvcapp created service/mvcapp created $ kubectl get pod -A NAMESPACE NAME READY STATUS RESTARTS AGE kube-system local-path-provisioner-5ff76fc89d-wh9cg 1/1 Running 0 9m29s kube-system coredns-7448499f4d-2d7pb 1/1 Running 0 9m29s kube-system metrics-server-86cbb8457f-x9l6n 1/1 Running 0 9m29s kube-system helm-install-traefik-crd-w27q7 0/1 Completed 0 9m29s kube-system helm-install-traefik-2zllj 0/1 Completed 1 9m29s kube-system svclb-traefik-55qfd 2/2 Running 0 8m47s kube-system traefik-97b44b794-smzl9 1/1 Running 0 8m48s default mvcapp-79874d888c-6htvq 1/1 Running 0 62s default mvcapp-79874d888c-clslc 1/1 Running 0 62s $ kubectl get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kubernetes ClusterIP 10.43.0.1 \u0026lt;none\u0026gt; 443/TCP 10m mvcapp NodePort 10.43.36.139 \u0026lt;none\u0026gt; 80:32105/TCP 106s # Nodeport IP $ curl 10.43.36.139:80 * Project : Mvcapp * Version : 0.5 / net5.0 * Hostname : mvcapp-79874d888c-6htvq * RemoteAddr : 10.42.0.1 * X-Forwarded-For : * Request Count : 1 * User-Agent : curl/7.29.0 $ curl localhost:32105 * Project : Mvcapp * Version : 0.5 / net5.0 * Hostname : mvcapp-79874d888c-clslc * RemoteAddr : 10.42.0.1 * X-Forwarded-For : * Request Count : 1 * User-Agent : curl/7.29.0 Agent 추가 Master Node만으로도 테스트 가능하나 Scale 테스트시 Agent(Worker Node) 추가 가능 환경변수 세팅 : 필요시 참고 $ sudo cat /var/lib/rancher/k3s/server/node-token\t\u0026gt; ~/.node-token $ K3S_TOKEN=$(\u0026lt; ~/.node-token) $ HOST_IP=$(ip a | sed -rn \u0026#39;s/.*inet ([0-9\\.]+).*eth0/\\1/p\u0026#39;) Agent 등록 : 원격실행 OR Agent 머신에서 실행 HostIP, Token 정보 필요 (위 환경변수 세팅 참고) # Agent 머신에서 실행 $ curl -sfL https://get.k3s.io | K3S_URL=https://$HOST_IP:6443 K3S_TOKEN=$K3S_TOKEN sh - # Agent 추가 다른방법 $ ansible node01 -m shell -a \u0026#34;curl -sfL https://get.k3s.io | sh -s - agent --server https://$HOST_IP:6443 --token $K3S_TOKEN\u0026#34; -v K3S 삭제 ls /usr/local/bin/k3s-* | xargs -n1 sh - ","keywords":["k3s","k8s","Kubernetes","rancher"],"articleBody":"Lightweight Kubernetes : The certified Kubernetes distribution built for IoT \u0026 Edge computing\n특징 https://k3s.io/{:target=\"_blank\"} Kubernetes의 경량화 버전으로 아래와 같은 특징 기본 설치만으로 바로 배포 테스트 가능 Overlay Netowrk(Flannel), Load balancer, Ingress(Traefik), CoreDNS 등이 기본 설치 됨 https://rancher.com/docs/k3s/latest/en/networking/{:target=\"_blank\"} etcd 대신 sqlite 운영 High Availability with an External DB High Availability with Embedded DB (Experimental) Master node schedulable uncordon 제외 가능 Worker node 필요 없음 (필요시 추가 가능) 사용 목적 Edge Computing 개발 테스트 및 스테이징 서버 구성 기타 어플리케이션 테스트 용 Master 설치 설치 curl -sfL https://get.k3s.io | sh - 실행으로 끝 systemd 관리 kubectl 설치 및 심볼릭 링크 설정 해줌 이미 kubectl 가 설치 되어 있는 경우는 심볼릭 링크 실패 # alias 필요시 아래 참고 $ alias kubectl='sudo k3s kubectl' # Install $ curl -sfL https://get.k3s.io | sh - # master node $ kubectl get node NAME STATUS ROLES AGE VERSION centos1 Ready control-plane,master 37s v1.21.3+k3s1 $ kubectl get pod -A NAMESPACE NAME READY STATUS RESTARTS AGE kube-system local-path-provisioner-5ff76fc89d-wh9cg 1/1 Running 0 2m35s kube-system coredns-7448499f4d-2d7pb 1/1 Running 0 2m35s kube-system metrics-server-86cbb8457f-x9l6n 1/1 Running 0 2m35s kube-system helm-install-traefik-crd-w27q7 0/1 Completed 0 2m35s kube-system helm-install-traefik-2zllj 0/1 Completed 1 2m35s kube-system svclb-traefik-55qfd 2/2 Running 0 113s kube-system traefik-97b44b794-smzl9 1/1 Running 0 114s K8S 서비스 테스트 서비스 타입 : NodePort https://kubernetes.github.io/ingress-nginx/deploy/baremetal/{:target=\"_blank\"} apiVersion: apps/v1 kind: Deployment metadata: name: mvcapp spec: selector: matchLabels: app: mvcapp replicas: 2 # --replicas=2 옵션과 동일 template: metadata: labels: app: mvcapp spec: containers: - name: mvcapp image: cdecl/mvcapp:0.6 ports: - containerPort: 80 --- apiVersion: v1 kind: Service metadata: name: mvcapp spec: type: NodePort selector: app: mvcapp ports: - port: 80 targetPort: 80 $ kubectl apply -f mvcapp-deploy-service.yaml deployment.apps/mvcapp created service/mvcapp created $ kubectl get pod -A NAMESPACE NAME READY STATUS RESTARTS AGE kube-system local-path-provisioner-5ff76fc89d-wh9cg 1/1 Running 0 9m29s kube-system coredns-7448499f4d-2d7pb 1/1 Running 0 9m29s kube-system metrics-server-86cbb8457f-x9l6n 1/1 Running 0 9m29s kube-system helm-install-traefik-crd-w27q7 0/1 Completed 0 9m29s kube-system helm-install-traefik-2zllj 0/1 Completed 1 9m29s kube-system svclb-traefik-55qfd 2/2 Running 0 8m47s kube-system traefik-97b44b794-smzl9 1/1 Running 0 8m48s default mvcapp-79874d888c-6htvq 1/1 Running 0 62s default mvcapp-79874d888c-clslc 1/1 Running 0 62s $ kubectl get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kubernetes ClusterIP 10.43.0.1 443/TCP 10m mvcapp NodePort 10.43.36.139 80:32105/TCP 106s # Nodeport IP $ curl 10.43.36.139:80 * Project : Mvcapp * Version : 0.5 / net5.0 * Hostname : mvcapp-79874d888c-6htvq * RemoteAddr : 10.42.0.1 * X-Forwarded-For : * Request Count : 1 * User-Agent : curl/7.29.0 $ curl localhost:32105 * Project : Mvcapp * Version : 0.5 / net5.0 * Hostname : mvcapp-79874d888c-clslc * RemoteAddr : 10.42.0.1 * X-Forwarded-For : * Request Count : 1 * User-Agent : curl/7.29.0 Agent 추가 Master Node만으로도 테스트 가능하나 Scale 테스트시 Agent(Worker Node) 추가 가능 환경변수 세팅 : 필요시 참고 $ sudo cat /var/lib/rancher/k3s/server/node-token\t\u003e ~/.node-token $ K3S_TOKEN=$(\u003c ~/.node-token) $ HOST_IP=$(ip a | sed -rn 's/.*inet ([0-9\\.]+).*eth0/\\1/p') Agent 등록 : 원격실행 OR Agent 머신에서 실행 HostIP, Token 정보 필요 (위 환경변수 세팅 참고) # Agent 머신에서 실행 $ curl -sfL https://get.k3s.io | K3S_URL=https://$HOST_IP:6443 K3S_TOKEN=$K3S_TOKEN sh - # Agent 추가 다른방법 $ ansible node01 -m shell -a \"curl -sfL https://get.k3s.io | sh -s - agent --server https://$HOST_IP:6443 --token $K3S_TOKEN\" -v K3S 삭제 ls /usr/local/bin/k3s-* | xargs -n1 sh - ","wordCount":"522","inLanguage":"en","datePublished":"2021-08-17T00:00:00+09:00","dateModified":"2021-08-17T00:00:00+09:00","author":{"@type":"Person","name":"Byung Kyu KIM"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://cdecl.github.io/devops/k3s-overview/"},"publisher":{"@type":"Organization","name":"cdeclog","logo":{"@type":"ImageObject","url":"https://cdecl.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://cdecl.github.io/ accesskey=h title="cdeclog (Alt + H)">cdeclog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://cdecl.github.io/dev/ title=Dev><span>Dev</span></a></li><li><a href=https://cdecl.github.io/devops/ title=DevOps><span>DevOps</span></a></li><li><a href=https://cdecl.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://cdecl.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://cdecl.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">K3S Overview</h1><div class=post-meta><span title='2021-08-17 00:00:00 +0900 KST'>August 17, 2021</span>&nbsp;·&nbsp;<span>Byung Kyu KIM</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%ed%8a%b9%ec%a7%95 aria-label=특징>특징</a><ul><li><a href=#%ec%82%ac%ec%9a%a9-%eb%aa%a9%ec%a0%81 aria-label="사용 목적">사용 목적</a></li></ul></li><li><a href=#master-%ec%84%a4%ec%b9%98 aria-label="Master 설치">Master 설치</a></li><li><a href=#k8s-%ec%84%9c%eb%b9%84%ec%8a%a4-%ed%85%8c%ec%8a%a4%ed%8a%b8 aria-label="K8S 서비스 테스트">K8S 서비스 테스트</a></li><li><a href=#agent-%ec%b6%94%ea%b0%80 aria-label="Agent 추가">Agent 추가</a><ul><li><a href=#agent-%eb%93%b1%eb%a1%9d--%ec%9b%90%ea%b2%a9%ec%8b%a4%ed%96%89-or-agent-%eb%a8%b8%ec%8b%a0%ec%97%90%ec%84%9c-%ec%8b%a4%ed%96%89 aria-label="Agent 등록 : 원격실행 OR Agent 머신에서 실행">Agent 등록 : 원격실행 OR Agent 머신에서 실행</a></li></ul></li><li><a href=#k3s-%ec%82%ad%ec%a0%9c aria-label="K3S 삭제">K3S 삭제</a></li></ul></div></details></div><div class=post-content><p>Lightweight Kubernetes : The certified Kubernetes distribution built for IoT & Edge computing</p><h3 id=특징>특징<a hidden class=anchor aria-hidden=true href=#특징>#</a></h3><ul><li><a href=https://k3s.io/>https://k3s.io/</a>{:target="_blank"}</li><li>Kubernetes의 경량화 버전으로 아래와 같은 특징<ul><li>기본 설치만으로 바로 배포 테스트 가능</li><li>Overlay Netowrk(Flannel), Load balancer, Ingress(Traefik), CoreDNS 등이 기본 설치 됨<ul><li><a href=https://rancher.com/docs/k3s/latest/en/networking/>https://rancher.com/docs/k3s/latest/en/networking/</a>{:target="_blank"}</li></ul></li><li>etcd 대신 sqlite 운영<ul><li><a href=https://rancher.com/docs/k3s/latest/en/installation/ha/>High Availability with an External DB</a></li><li><a href=https://rancher.com/docs/k3s/latest/en/installation/ha-embedded/>High Availability with Embedded DB (Experimental)</a></li></ul></li><li>Master node schedulable<ul><li>uncordon 제외 가능</li><li>Worker node 필요 없음 (필요시 추가 가능)</li></ul></li></ul></li></ul><h4 id=사용-목적>사용 목적<a hidden class=anchor aria-hidden=true href=#사용-목적>#</a></h4><ul><li>Edge Computing</li><li>개발 테스트 및 스테이징 서버 구성</li><li>기타 어플리케이션 테스트 용</li></ul><h3 id=master-설치>Master 설치<a hidden class=anchor aria-hidden=true href=#master-설치>#</a></h3><ul><li>설치 <code>curl -sfL https://get.k3s.io | sh -</code> 실행으로 끝<ul><li><code>systemd 관리</code></li></ul></li><li>kubectl 설치 및 심볼릭 링크 설정 해줌<ul><li>이미 kubectl 가 설치 되어 있는 경우는 심볼릭 링크 실패</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># alias 필요시 아래 참고 </span>
</span></span><span style=display:flex><span>$ alias kubectl<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;sudo k3s kubectl&#39;</span> 
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># Install</span>
</span></span><span style=display:flex><span>$ curl -sfL https://get.k3s.io | sh -
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># master node</span>
</span></span><span style=display:flex><span>$ kubectl get node
</span></span><span style=display:flex><span>NAME      STATUS   ROLES                  AGE   VERSION
</span></span><span style=display:flex><span>centos1   Ready    control-plane,master   37s   v1.21.3+k3s1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ kubectl get pod -A
</span></span><span style=display:flex><span>NAMESPACE     NAME                                      READY   STATUS      RESTARTS   AGE
</span></span><span style=display:flex><span>kube-system   local-path-provisioner-5ff76fc89d-wh9cg   1/1     Running     <span style=color:#ae81ff>0</span>          2m35s
</span></span><span style=display:flex><span>kube-system   coredns-7448499f4d-2d7pb                  1/1     Running     <span style=color:#ae81ff>0</span>          2m35s
</span></span><span style=display:flex><span>kube-system   metrics-server-86cbb8457f-x9l6n           1/1     Running     <span style=color:#ae81ff>0</span>          2m35s
</span></span><span style=display:flex><span>kube-system   helm-install-traefik-crd-w27q7            0/1     Completed   <span style=color:#ae81ff>0</span>          2m35s
</span></span><span style=display:flex><span>kube-system   helm-install-traefik-2zllj                0/1     Completed   <span style=color:#ae81ff>1</span>          2m35s
</span></span><span style=display:flex><span>kube-system   svclb-traefik-55qfd                       2/2     Running     <span style=color:#ae81ff>0</span>          113s
</span></span><span style=display:flex><span>kube-system   traefik-97b44b794-smzl9                   1/1     Running     <span style=color:#ae81ff>0</span>          114s
</span></span></code></pre></div><h3 id=k8s-서비스-테스트>K8S 서비스 테스트<a hidden class=anchor aria-hidden=true href=#k8s-서비스-테스트>#</a></h3><ul><li>서비스 타입 : <code>NodePort</code></li><li><a href=https://kubernetes.github.io/ingress-nginx/deploy/baremetal/>https://kubernetes.github.io/ingress-nginx/deploy/baremetal/</a>{:target="_blank"}</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>mvcapp</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>mvcapp</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>2</span> <span style=color:#75715e># --replicas=2 옵션과 동일 </span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>: 
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>mvcapp</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>mvcapp</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>cdecl/mvcapp:0.6</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>mvcapp</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>mvcapp</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>80</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ kubectl apply -f mvcapp-deploy-service.yaml
</span></span><span style=display:flex><span>deployment.apps/mvcapp created
</span></span><span style=display:flex><span>service/mvcapp created
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ kubectl get pod -A
</span></span><span style=display:flex><span>NAMESPACE     NAME                                      READY   STATUS      RESTARTS   AGE
</span></span><span style=display:flex><span>kube-system   local-path-provisioner-5ff76fc89d-wh9cg   1/1     Running     <span style=color:#ae81ff>0</span>          9m29s
</span></span><span style=display:flex><span>kube-system   coredns-7448499f4d-2d7pb                  1/1     Running     <span style=color:#ae81ff>0</span>          9m29s
</span></span><span style=display:flex><span>kube-system   metrics-server-86cbb8457f-x9l6n           1/1     Running     <span style=color:#ae81ff>0</span>          9m29s
</span></span><span style=display:flex><span>kube-system   helm-install-traefik-crd-w27q7            0/1     Completed   <span style=color:#ae81ff>0</span>          9m29s
</span></span><span style=display:flex><span>kube-system   helm-install-traefik-2zllj                0/1     Completed   <span style=color:#ae81ff>1</span>          9m29s
</span></span><span style=display:flex><span>kube-system   svclb-traefik-55qfd                       2/2     Running     <span style=color:#ae81ff>0</span>          8m47s
</span></span><span style=display:flex><span>kube-system   traefik-97b44b794-smzl9                   1/1     Running     <span style=color:#ae81ff>0</span>          8m48s
</span></span><span style=display:flex><span>default       mvcapp-79874d888c-6htvq                   1/1     Running     <span style=color:#ae81ff>0</span>          62s
</span></span><span style=display:flex><span>default       mvcapp-79874d888c-clslc                   1/1     Running     <span style=color:#ae81ff>0</span>          62s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ kubectl get svc
</span></span><span style=display:flex><span>NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span style=color:#f92672>(</span>S<span style=color:#f92672>)</span>        AGE
</span></span><span style=display:flex><span>kubernetes   ClusterIP   10.43.0.1      &lt;none&gt;        443/TCP        10m
</span></span><span style=display:flex><span>mvcapp       NodePort    10.43.36.139   &lt;none&gt;        80:32105/TCP   106s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Nodeport IP</span>
</span></span><span style=display:flex><span>$ curl 10.43.36.139:80
</span></span><span style=display:flex><span>    * Project           : Mvcapp
</span></span><span style=display:flex><span>    * Version           : 0.5 / net5.0
</span></span><span style=display:flex><span>    * Hostname          : mvcapp-79874d888c-6htvq
</span></span><span style=display:flex><span>    * RemoteAddr        : 10.42.0.1
</span></span><span style=display:flex><span>    * X-Forwarded-For   :
</span></span><span style=display:flex><span>    * Request Count     : <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    * User-Agent        : curl/7.29.0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ curl localhost:32105
</span></span><span style=display:flex><span>    * Project           : Mvcapp
</span></span><span style=display:flex><span>    * Version           : 0.5 / net5.0
</span></span><span style=display:flex><span>    * Hostname          : mvcapp-79874d888c-clslc
</span></span><span style=display:flex><span>    * RemoteAddr        : 10.42.0.1
</span></span><span style=display:flex><span>    * X-Forwarded-For   :
</span></span><span style=display:flex><span>    * Request Count     : <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    * User-Agent        : curl/7.29.0
</span></span></code></pre></div><h3 id=agent-추가>Agent 추가<a hidden class=anchor aria-hidden=true href=#agent-추가>#</a></h3><ul><li>Master Node만으로도 테스트 가능하나 Scale 테스트시 Agent(Worker Node) 추가 가능</li><li>환경변수 세팅 : 필요시 참고</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ sudo cat /var/lib/rancher/k3s/server/node-token	 &gt; ~/.node-token
</span></span><span style=display:flex><span>$ K3S_TOKEN<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>&lt; ~/.node-token<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>$ HOST_IP<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>ip a | sed -rn <span style=color:#e6db74>&#39;s/.*inet ([0-9\.]+).*eth0/\1/p&#39;</span><span style=color:#66d9ef>)</span>
</span></span></code></pre></div><h4 id=agent-등록--원격실행-or-agent-머신에서-실행>Agent 등록 : 원격실행 OR Agent 머신에서 실행<a hidden class=anchor aria-hidden=true href=#agent-등록--원격실행-or-agent-머신에서-실행>#</a></h4><ul><li>HostIP, Token 정보 필요 (위 환경변수 세팅 참고)</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># Agent 머신에서 실행 </span>
</span></span><span style=display:flex><span>$ curl -sfL https://get.k3s.io | K3S_URL<span style=color:#f92672>=</span>https://$HOST_IP:6443 K3S_TOKEN<span style=color:#f92672>=</span>$K3S_TOKEN sh -
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Agent 추가 다른방법 </span>
</span></span><span style=display:flex><span>$ ansible node01 -m shell -a <span style=color:#e6db74>&#34;curl -sfL https://get.k3s.io | sh -s - agent --server https://</span>$HOST_IP<span style=color:#e6db74>:6443 --token </span>$K3S_TOKEN<span style=color:#e6db74>&#34;</span> -v
</span></span></code></pre></div><hr><h3 id=k3s-삭제>K3S 삭제<a hidden class=anchor aria-hidden=true href=#k3s-삭제>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>ls /usr/local/bin/k3s-* | xargs -n1 sh -
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://cdecl.github.io/tags/k3s/>K3s</a></li><li><a href=https://cdecl.github.io/tags/k8s/>K8s</a></li><li><a href=https://cdecl.github.io/tags/kubernetes/>Kubernetes</a></li><li><a href=https://cdecl.github.io/tags/rancher/>Rancher</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://cdecl.github.io/>cdeclog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>