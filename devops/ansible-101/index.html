<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Ansible-101 | cdeclog</title><meta name=keywords content="ansible"><meta name=description content='Ansible-101
Ansible Install

Centos 7

기본적으로 Python 2.7 기반으로 설치 됨
추후 pywinrm 패키지가 필요할때, python2-pip 패키지 추가 설치 필요



sudo yum install ansible

대안으로 pip 으로 설치 하는 방법 (user)

pip install ansible # --user 
용어 정의

Inventory : 관리하는 원격 서버 목록

지정하지 않으면 Default Path 의 hosts 파일을 참조

/etc/ansible/hosts




Module : Task 를 실행하는 방법 (모듈)

https://docs.ansible.com/ansible/latest/modules/modules_by_category.html{:target="_blank"}
e.g. - command, shell, copy, service


Playbook : Task 실행 프로세스 정의서

Yaml 파일로 작성


멱등성(idempotence) : 연산을 여러 번 적용하더라도 결과가 달라지지 않는 성질을 의미한다.

Ansbile Config

Path : /etc/ansible/ansible.cfg
Ignore ansible ssh authenticity : ssh 최초 접속시 인증을 host key 체크 생략

https://stackoverflow.com/questions/32297456/how-to-ignore-ansible-ssh-authenticity-checking{:target="_blank"}



[defaults]
host_key_checking = False

Callback plugins

minimal stdout



[defaults]
stdout_callback = minimal

참고 : How to disable strict host key checking in ssh?

https://askubuntu.com/questions/87449/how-to-disable-strict-host-key-checking-in-ssh{:target="_blank"}



Inventory 구성

Public key 등록 사용 방법 : 키를 생성하고 public 키를 관리되는 서버에 등록 후 사용

# Key 생성 
ssh-keygen

# Public key 등록
ssh-copy-id [server-ip] 

Inventory 서버 등록 : /etc/ansible/hosts

기본디렉토리의 Host 파일을 사용하지 않는다면 -i 옵션으로 Inventory 파일 지정
https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html#list-of-behavioral-inventory-parameters{:target="_blank"}



# ansible host 파일 예제

192.168.1.5

[db]
192.168.1.10

[webservers]
192.168.1.100
192.168.1.110

# hosts 파일에 등록된 경우 
[apiserver]
apiserver1
apiserver2

# host명으로 등록
server1		ansible_host=192.168.1.50
server2		ansible_host=192.168.1.51

Host 지정 방법

all : 해당 Inventory의 모든 서버
webservers : webservers 라고 정의된 서버 목록
192.168.1.100 : 192.168.1.100 서버



Ad-hook Execute

ansible 명령을 통한 inline 실행
주요 인수

Usage: ansible <host-pattern> [options]
  -a MODULE_ARGS, --args=MODULE_ARGS   module arguments                                                                   
  -e EXTRA_VARS, --extra-vars=EXTRA_VARS
    set additional variables as key=value or YAML/JSON, if filename prepend with @  
  -f FORKS, --forks=FORKS 
      specify number of parallel processes to use (default=5)                                                                        
  -h, --help            show this help message and exit                                                     
  -i INVENTORY, --inventory=INVENTORY, --inventory-file=INVENTORY                                           
      specify inventory host path or comma separated host                                
      list. --inventory-file is deprecated                                               
  -m MODULE_NAME, --module-name=MODULE_NAME                                                                 
      module name to execute (default=command)                                           
  -v, --verbose         verbose mode (-vvv for more, -vvvv to enable connection debugging)                                                              
  --version             show program&#39;s version number, config file location,                                
      configured module search path, module location,                                    
      executable location and exit                                                       
  -b, --become        run operations with become (does not imply password prompting)                                                                         
- Example

hostname 확인

# webservers 목록 실행 
# command 모듈, "hostname" 인수
ansible webservers -m command -a "hostname" 

# default module (생략가능) : -m command   
ansible webservers -a "hostname" 

# 모든 서버
ansible all -a "hostname" 

기타 모듈 사용

# ping 모듈 
ansible webservers -m ping

# copy 모듈 : local → host 
ansible webservers -m copy -a "src=file.txt dest=/home/cdecl/web/"

# service 모듈 : kubelet 서비스를 시작 
ansible webservers -m service -a "name=kubelet state=started"
Playbook 사용
일련의 Task(작업)를 기술하여, 프로세스를 실행하는 방법'><meta name=author content="Byung Kyu KIM"><link rel=canonical href=https://cdecl.github.io/devops/ansible-101/><link crossorigin=anonymous href=/assets/css/stylesheet.f939c4ffefb264e6fe85e04352266f79db6bb1303c8e16ae9b6064c1247b5e32.css integrity="sha256-+TnE/++yZOb+heBDUiZvedtrsTA8jhaum2BkwSR7XjI=" rel="preload stylesheet" as=style><link rel=icon href=https://cdecl.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://cdecl.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://cdecl.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://cdecl.github.io/apple-touch-icon.png><link rel=mask-icon href=https://cdecl.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://cdecl.github.io/devops/ansible-101/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-VQQHHYPN7K"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VQQHHYPN7K")}</script><meta property="og:url" content="https://cdecl.github.io/devops/ansible-101/"><meta property="og:site_name" content="cdeclog"><meta property="og:title" content="Ansible-101"><meta property="og:description" content='Ansible-101
Ansible Install Centos 7 기본적으로 Python 2.7 기반으로 설치 됨 추후 pywinrm 패키지가 필요할때, python2-pip 패키지 추가 설치 필요 sudo yum install ansible 대안으로 pip 으로 설치 하는 방법 (user) pip install ansible # --user 용어 정의 Inventory : 관리하는 원격 서버 목록 지정하지 않으면 Default Path 의 hosts 파일을 참조 /etc/ansible/hosts Module : Task 를 실행하는 방법 (모듈) https://docs.ansible.com/ansible/latest/modules/modules_by_category.html{:target="_blank"} e.g. - command, shell, copy, service Playbook : Task 실행 프로세스 정의서 Yaml 파일로 작성 멱등성(idempotence) : 연산을 여러 번 적용하더라도 결과가 달라지지 않는 성질을 의미한다. Ansbile Config Path : /etc/ansible/ansible.cfg Ignore ansible ssh authenticity : ssh 최초 접속시 인증을 host key 체크 생략 https://stackoverflow.com/questions/32297456/how-to-ignore-ansible-ssh-authenticity-checking{:target="_blank"} [defaults] host_key_checking = False Callback plugins minimal stdout [defaults] stdout_callback = minimal 참고 : How to disable strict host key checking in ssh? https://askubuntu.com/questions/87449/how-to-disable-strict-host-key-checking-in-ssh{:target="_blank"} Inventory 구성 Public key 등록 사용 방법 : 키를 생성하고 public 키를 관리되는 서버에 등록 후 사용 # Key 생성 ssh-keygen # Public key 등록 ssh-copy-id [server-ip] Inventory 서버 등록 : /etc/ansible/hosts 기본디렉토리의 Host 파일을 사용하지 않는다면 -i 옵션으로 Inventory 파일 지정 https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html#list-of-behavioral-inventory-parameters{:target="_blank"} # ansible host 파일 예제 192.168.1.5 [db] 192.168.1.10 [webservers] 192.168.1.100 192.168.1.110 # hosts 파일에 등록된 경우 [apiserver] apiserver1 apiserver2 # host명으로 등록 server1	ansible_host=192.168.1.50 server2	ansible_host=192.168.1.51 Host 지정 방법 all : 해당 Inventory의 모든 서버 webservers : webservers 라고 정의된 서버 목록 192.168.1.100 : 192.168.1.100 서버 Ad-hook Execute ansible 명령을 통한 inline 실행 주요 인수 Usage: ansible <host-pattern> [options] -a MODULE_ARGS, --args=MODULE_ARGS module arguments -e EXTRA_VARS, --extra-vars=EXTRA_VARS set additional variables as key=value or YAML/JSON, if filename prepend with @ -f FORKS, --forks=FORKS specify number of parallel processes to use (default=5) -h, --help show this help message and exit -i INVENTORY, --inventory=INVENTORY, --inventory-file=INVENTORY specify inventory host path or comma separated host list. --inventory-file is deprecated -m MODULE_NAME, --module-name=MODULE_NAME module name to execute (default=command) -v, --verbose verbose mode (-vvv for more, -vvvv to enable connection debugging) --version show program&#39;s version number, config file location, configured module search path, module location, executable location and exit -b, --become run operations with become (does not imply password prompting) - Example hostname 확인 # webservers 목록 실행 # command 모듈, "hostname" 인수 ansible webservers -m command -a "hostname" # default module (생략가능) : -m command ansible webservers -a "hostname" # 모든 서버 ansible all -a "hostname" 기타 모듈 사용 # ping 모듈 ansible webservers -m ping # copy 모듈 : local → host ansible webservers -m copy -a "src=file.txt dest=/home/cdecl/web/" # service 모듈 : kubelet 서비스를 시작 ansible webservers -m service -a "name=kubelet state=started" Playbook 사용 일련의 Task(작업)를 기술하여, 프로세스를 실행하는 방법'><meta property="og:locale" content="ko-kr"><meta property="og:type" content="article"><meta property="article:section" content="devops"><meta property="article:published_time" content="2021-08-11T00:00:00+09:00"><meta property="article:modified_time" content="2021-08-11T00:00:00+09:00"><meta property="article:tag" content="Ansible"><meta name=twitter:card content="summary"><meta name=twitter:title content="Ansible-101"><meta name=twitter:description content='Ansible-101
Ansible Install

Centos 7

기본적으로 Python 2.7 기반으로 설치 됨
추후 pywinrm 패키지가 필요할때, python2-pip 패키지 추가 설치 필요



sudo yum install ansible

대안으로 pip 으로 설치 하는 방법 (user)

pip install ansible # --user 
용어 정의

Inventory : 관리하는 원격 서버 목록

지정하지 않으면 Default Path 의 hosts 파일을 참조

/etc/ansible/hosts




Module : Task 를 실행하는 방법 (모듈)

https://docs.ansible.com/ansible/latest/modules/modules_by_category.html{:target="_blank"}
e.g. - command, shell, copy, service


Playbook : Task 실행 프로세스 정의서

Yaml 파일로 작성


멱등성(idempotence) : 연산을 여러 번 적용하더라도 결과가 달라지지 않는 성질을 의미한다.

Ansbile Config

Path : /etc/ansible/ansible.cfg
Ignore ansible ssh authenticity : ssh 최초 접속시 인증을 host key 체크 생략

https://stackoverflow.com/questions/32297456/how-to-ignore-ansible-ssh-authenticity-checking{:target="_blank"}



[defaults]
host_key_checking = False

Callback plugins

minimal stdout



[defaults]
stdout_callback = minimal

참고 : How to disable strict host key checking in ssh?

https://askubuntu.com/questions/87449/how-to-disable-strict-host-key-checking-in-ssh{:target="_blank"}



Inventory 구성

Public key 등록 사용 방법 : 키를 생성하고 public 키를 관리되는 서버에 등록 후 사용

# Key 생성 
ssh-keygen

# Public key 등록
ssh-copy-id [server-ip] 

Inventory 서버 등록 : /etc/ansible/hosts

기본디렉토리의 Host 파일을 사용하지 않는다면 -i 옵션으로 Inventory 파일 지정
https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html#list-of-behavioral-inventory-parameters{:target="_blank"}



# ansible host 파일 예제

192.168.1.5

[db]
192.168.1.10

[webservers]
192.168.1.100
192.168.1.110

# hosts 파일에 등록된 경우 
[apiserver]
apiserver1
apiserver2

# host명으로 등록
server1		ansible_host=192.168.1.50
server2		ansible_host=192.168.1.51

Host 지정 방법

all : 해당 Inventory의 모든 서버
webservers : webservers 라고 정의된 서버 목록
192.168.1.100 : 192.168.1.100 서버



Ad-hook Execute

ansible 명령을 통한 inline 실행
주요 인수

Usage: ansible <host-pattern> [options]
  -a MODULE_ARGS, --args=MODULE_ARGS   module arguments                                                                   
  -e EXTRA_VARS, --extra-vars=EXTRA_VARS
    set additional variables as key=value or YAML/JSON, if filename prepend with @  
  -f FORKS, --forks=FORKS 
      specify number of parallel processes to use (default=5)                                                                        
  -h, --help            show this help message and exit                                                     
  -i INVENTORY, --inventory=INVENTORY, --inventory-file=INVENTORY                                           
      specify inventory host path or comma separated host                                
      list. --inventory-file is deprecated                                               
  -m MODULE_NAME, --module-name=MODULE_NAME                                                                 
      module name to execute (default=command)                                           
  -v, --verbose         verbose mode (-vvv for more, -vvvv to enable connection debugging)                                                              
  --version             show program&#39;s version number, config file location,                                
      configured module search path, module location,                                    
      executable location and exit                                                       
  -b, --become        run operations with become (does not imply password prompting)                                                                         
- Example

hostname 확인

# webservers 목록 실행 
# command 모듈, "hostname" 인수
ansible webservers -m command -a "hostname" 

# default module (생략가능) : -m command   
ansible webservers -a "hostname" 

# 모든 서버
ansible all -a "hostname" 

기타 모듈 사용

# ping 모듈 
ansible webservers -m ping

# copy 모듈 : local → host 
ansible webservers -m copy -a "src=file.txt dest=/home/cdecl/web/"

# service 모듈 : kubelet 서비스를 시작 
ansible webservers -m service -a "name=kubelet state=started"
Playbook 사용
일련의 Task(작업)를 기술하여, 프로세스를 실행하는 방법'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Devops","item":"https://cdecl.github.io/devops/"},{"@type":"ListItem","position":2,"name":"Ansible-101","item":"https://cdecl.github.io/devops/ansible-101/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Ansible-101","name":"Ansible-101","description":"Ansible-101\nAnsible Install Centos 7 기본적으로 Python 2.7 기반으로 설치 됨 추후 pywinrm 패키지가 필요할때, python2-pip 패키지 추가 설치 필요 sudo yum install ansible 대안으로 pip 으로 설치 하는 방법 (user) pip install ansible # --user 용어 정의 Inventory : 관리하는 원격 서버 목록 지정하지 않으면 Default Path 의 hosts 파일을 참조 /etc/ansible/hosts Module : Task 를 실행하는 방법 (모듈) https://docs.ansible.com/ansible/latest/modules/modules_by_category.html{:target=\u0026quot;_blank\u0026quot;} e.g. - command, shell, copy, service Playbook : Task 실행 프로세스 정의서 Yaml 파일로 작성 멱등성(idempotence) : 연산을 여러 번 적용하더라도 결과가 달라지지 않는 성질을 의미한다. Ansbile Config Path : /etc/ansible/ansible.cfg Ignore ansible ssh authenticity : ssh 최초 접속시 인증을 host key 체크 생략 https://stackoverflow.com/questions/32297456/how-to-ignore-ansible-ssh-authenticity-checking{:target=\u0026quot;_blank\u0026quot;} [defaults] host_key_checking = False Callback plugins minimal stdout [defaults] stdout_callback = minimal 참고 : How to disable strict host key checking in ssh? https://askubuntu.com/questions/87449/how-to-disable-strict-host-key-checking-in-ssh{:target=\u0026quot;_blank\u0026quot;} Inventory 구성 Public key 등록 사용 방법 : 키를 생성하고 public 키를 관리되는 서버에 등록 후 사용 # Key 생성 ssh-keygen # Public key 등록 ssh-copy-id [server-ip] Inventory 서버 등록 : /etc/ansible/hosts 기본디렉토리의 Host 파일을 사용하지 않는다면 -i 옵션으로 Inventory 파일 지정 https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html#list-of-behavioral-inventory-parameters{:target=\u0026quot;_blank\u0026quot;} # ansible host 파일 예제 192.168.1.5 [db] 192.168.1.10 [webservers] 192.168.1.100 192.168.1.110 # hosts 파일에 등록된 경우 [apiserver] apiserver1 apiserver2 # host명으로 등록 server1\tansible_host=192.168.1.50 server2\tansible_host=192.168.1.51 Host 지정 방법 all : 해당 Inventory의 모든 서버 webservers : webservers 라고 정의된 서버 목록 192.168.1.100 : 192.168.1.100 서버 Ad-hook Execute ansible 명령을 통한 inline 실행 주요 인수 Usage: ansible \u0026lt;host-pattern\u0026gt; [options] -a MODULE_ARGS, --args=MODULE_ARGS module arguments -e EXTRA_VARS, --extra-vars=EXTRA_VARS set additional variables as key=value or YAML/JSON, if filename prepend with @ -f FORKS, --forks=FORKS specify number of parallel processes to use (default=5) -h, --help show this help message and exit -i INVENTORY, --inventory=INVENTORY, --inventory-file=INVENTORY specify inventory host path or comma separated host list. --inventory-file is deprecated -m MODULE_NAME, --module-name=MODULE_NAME module name to execute (default=command) -v, --verbose verbose mode (-vvv for more, -vvvv to enable connection debugging) --version show program\u0026#39;s version number, config file location, configured module search path, module location, executable location and exit -b, --become run operations with become (does not imply password prompting) - Example hostname 확인 # webservers 목록 실행 # command 모듈, \u0026#34;hostname\u0026#34; 인수 ansible webservers -m command -a \u0026#34;hostname\u0026#34; # default module (생략가능) : -m command ansible webservers -a \u0026#34;hostname\u0026#34; # 모든 서버 ansible all -a \u0026#34;hostname\u0026#34; 기타 모듈 사용 # ping 모듈 ansible webservers -m ping # copy 모듈 : local → host ansible webservers -m copy -a \u0026#34;src=file.txt dest=/home/cdecl/web/\u0026#34; # service 모듈 : kubelet 서비스를 시작 ansible webservers -m service -a \u0026#34;name=kubelet state=started\u0026#34; Playbook 사용 일련의 Task(작업)를 기술하여, 프로세스를 실행하는 방법\n","keywords":["ansible"],"articleBody":"Ansible-101\nAnsible Install Centos 7 기본적으로 Python 2.7 기반으로 설치 됨 추후 pywinrm 패키지가 필요할때, python2-pip 패키지 추가 설치 필요 sudo yum install ansible 대안으로 pip 으로 설치 하는 방법 (user) pip install ansible # --user 용어 정의 Inventory : 관리하는 원격 서버 목록 지정하지 않으면 Default Path 의 hosts 파일을 참조 /etc/ansible/hosts Module : Task 를 실행하는 방법 (모듈) https://docs.ansible.com/ansible/latest/modules/modules_by_category.html{:target=\"_blank\"} e.g. - command, shell, copy, service Playbook : Task 실행 프로세스 정의서 Yaml 파일로 작성 멱등성(idempotence) : 연산을 여러 번 적용하더라도 결과가 달라지지 않는 성질을 의미한다. Ansbile Config Path : /etc/ansible/ansible.cfg Ignore ansible ssh authenticity : ssh 최초 접속시 인증을 host key 체크 생략 https://stackoverflow.com/questions/32297456/how-to-ignore-ansible-ssh-authenticity-checking{:target=\"_blank\"} [defaults] host_key_checking = False Callback plugins minimal stdout [defaults] stdout_callback = minimal 참고 : How to disable strict host key checking in ssh? https://askubuntu.com/questions/87449/how-to-disable-strict-host-key-checking-in-ssh{:target=\"_blank\"} Inventory 구성 Public key 등록 사용 방법 : 키를 생성하고 public 키를 관리되는 서버에 등록 후 사용 # Key 생성 ssh-keygen # Public key 등록 ssh-copy-id [server-ip] Inventory 서버 등록 : /etc/ansible/hosts 기본디렉토리의 Host 파일을 사용하지 않는다면 -i 옵션으로 Inventory 파일 지정 https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html#list-of-behavioral-inventory-parameters{:target=\"_blank\"} # ansible host 파일 예제 192.168.1.5 [db] 192.168.1.10 [webservers] 192.168.1.100 192.168.1.110 # hosts 파일에 등록된 경우 [apiserver] apiserver1 apiserver2 # host명으로 등록 server1\tansible_host=192.168.1.50 server2\tansible_host=192.168.1.51 Host 지정 방법 all : 해당 Inventory의 모든 서버 webservers : webservers 라고 정의된 서버 목록 192.168.1.100 : 192.168.1.100 서버 Ad-hook Execute ansible 명령을 통한 inline 실행 주요 인수 Usage: ansible [options] -a MODULE_ARGS, --args=MODULE_ARGS module arguments -e EXTRA_VARS, --extra-vars=EXTRA_VARS set additional variables as key=value or YAML/JSON, if filename prepend with @ -f FORKS, --forks=FORKS specify number of parallel processes to use (default=5) -h, --help show this help message and exit -i INVENTORY, --inventory=INVENTORY, --inventory-file=INVENTORY specify inventory host path or comma separated host list. --inventory-file is deprecated -m MODULE_NAME, --module-name=MODULE_NAME module name to execute (default=command) -v, --verbose verbose mode (-vvv for more, -vvvv to enable connection debugging) --version show program's version number, config file location, configured module search path, module location, executable location and exit -b, --become run operations with become (does not imply password prompting) - Example hostname 확인 # webservers 목록 실행 # command 모듈, \"hostname\" 인수 ansible webservers -m command -a \"hostname\" # default module (생략가능) : -m command ansible webservers -a \"hostname\" # 모든 서버 ansible all -a \"hostname\" 기타 모듈 사용 # ping 모듈 ansible webservers -m ping # copy 모듈 : local → host ansible webservers -m copy -a \"src=file.txt dest=/home/cdecl/web/\" # service 모듈 : kubelet 서비스를 시작 ansible webservers -m service -a \"name=kubelet state=started\" Playbook 사용 일련의 Task(작업)를 기술하여, 프로세스를 실행하는 방법\n간략한 설명 name : 작업을 설명하는 식별자 (주석, 생략가능) 모듈 내에서의 name 은 다른 의미 gather_facts : (yes | no ) Gathering Facts 작업 실행 및 생략 Facts : 작업 시작전 Host 의 Name, CPU, Memory 등을 수집하는 Setup 모듈 hosts : Inventory 내의 hosts 지정 tasks : 작업 목록들 (배열) register : 작업을 해당 이름으로 등록, debug 항목에서 표준 출력을 받아오기 위해 사용 debug : debug 용 작업들 (msg, stdout 출력) become : root 권한으로 실행 become_user : sudo 를 통해 실행할 계정 변수값 평가 : \" {{ 변수 }} \" -e 파라미터를 통해 전달 가능 - Example Ping 모듈 테스트 - name: ping test hosts: webservers gather_facts: no tasks: - ping: ansible-playbook ping.yml Shell 모듈 : out 이란 이름으로 작업을 등록 - name: get hostname hosts: localhost tasks: - shell: \"hostname\" register: out # out 이란 이름으로 작업을 등록 - debug: \"var=out.stdout_lines\" # out 의 stdout 을 모두 출력 \u003e ansible-playbook hostname.yml localhost | CHANGED | rc=0 \u003e\u003e centos24 localhost | SUCCESS =\u003e { \"out.stdout_lines\": [ \"centos24\" ] } Service 모듈 - name: nginx service start hosts: localhost # gather_facts: no tasks: - service: # nginx 서비스를 시작 name: nginx state: started # - service: \"name=nginx state=started\" # inline 으로 표현 가능 become: yes # root 권한 실행 \u003e # changed=1 : 상태 변화 있음 \u003e ansible-playbook nginx.yml PLAY [nginx service start] TASK [service] ************changed: [localhost] PLAY RECAP ****************localhost : ok=1 changed=1 unreachable=0 failed=0 \u003e # changed=0 : 상태 변화 없음 → 이미 started 상태 \u003e ansible-playbook nginx.yml PLAY [nginx service start] TASK [service] ************changed: [localhost] PLAY RECAP ****************localhost : ok=1 changed=0 unreachable=0 failed=0 Loop (with_items) 및 변수 (vars) 활용 - name: test hosts: localhost gather_facts: no vars: SERVER_IP: 10.20.10.20 tasks: - name: test shell: | echo docker run -d --name={{item.name}} -p {{item.port}}:80 \\ -e SERVER_IP={{SERVER_IP}} with_items: - { name: \"tomcat01\", port: \"8001\" } - { name: \"tomcat02\", port: \"8002\" } - { name: \"tomcat03\", port: \"8003\" } - { name: \"tomcat04\", port: \"8004\" } register: out - debug: msg: \"{{ item.stdout_lines }}\" with_items: \"{{ out.results }}\" Tags 활용 - name: tags test hosts: localhost tasks: - shell : echo step 1 register: out tags: - step1 - debug : var=out.stdout_lines tags: - step1 - shell : echo step 2 register: out tags: - step2 - debug : var=out.stdout_lines tags: - step2 - shell : echo step 3 register: out tags: - step3 - debug : var=out.stdout_lines tags: - step3 # Setp2 tags 만 실행 \u003e ansible-playbook test.yml --tags \"step2\" ok: [localhost] =\u003e { \"out.stdout_lines\": [ \"step 2\" ] } Windows Host 사용 Windows Host로 사용하는 방법 ssh winrm : https://github.com/cdecl/winrm-101{:target=\"_blank\"} # host 설정 : Service Enable winrm qc # 인증 및 AllowUnencrypted 설정 winrm set winrm/config/service/Auth '@{Basic=\"true\"}' winrm set winrm/config/service '@{AllowUnencrypted=\"true\"}' winrm set winrm/config/winrs '@{MaxMemoryPerShellMB=\"1024\"}' # winrm 을 사용하기 위한 python 모듈 설치 pip install pywinrm # --user Inventory 구성 [win] 192.168.28.25 [win:vars] ansible_user=rundeck ansible_password= ansible_connection=winrm ansible_port=5985 # ansible_winrm_server_cert_validation=ignore Windows 모듈 https://docs.ansible.com/ansible/latest/modules/list_of_windows_modules.html{:target=\"_blank\"} win_command – Executes a command on a remote Windows node win_copy – Copies files to remote locations on windows hosts win_shell – Execute shell commands on target hosts (powershell) win_chocolatey – Manage packages using chocolatey - name: ping test hosts: win gather_facts: no tasks: - win_ping: - name: Install git from a pre configured source (win_chocolatey_source) hosts: win tasks: - win_chocolatey: name: git Ansible Facts Facts : 원격서버(Node)로 부터 수집한 정보를 담고 있는 변수 # 원격서버 Facts 확인 \u003e ansible hostname -m setup kubem | SUCCESS =\u003e { \"ansible_facts\": { \"ansible_all_ipv4_addresses\": [ \"10.244.0.0\", \"10.244.0.1\", \"192.168.137.108\", \"172.17.0.1\" ], \"ansible_all_ipv6_addresses\": [ \"fe80::e04c:baff:fe78:2e93\", \"fe80::b8f6:d7ff:fecc:4c91\", \"fe80::f8e5:7ff:fe0f:6b60\", \"fe80::48b8:90ff:fede:71cf\", \"fe80::8aa8:d266:54e5:1608\", \"fe80::2918:237b:3860:3272\" ], \"ansible_apparmor\": { \"status\": \"disabled\" }, \"ansible_architecture\": \"x86_64\", \"ansible_bios_date\": \"11/26/2012\", \"ansible_bios_version\": \"Hyper-V UEFI Release v1.0\", \"ansible_cmdline\": { \"BOOT_IMAGE\": \"/vmlinuz-3.10.0-957.1.3.el7.x86_64\", \"LANG\": \"ko_KR.UTF-8\", \"crashkernel\": \"auto\", \"quiet\": true, \"rd.lvm.lv\": \"centos/swap\", \"rhgb\": true, \"ro\": true, \"root\": \"/dev/mapper/centos-root\" }, ... ansible_distribution 필터링 OS 구분시 유효 \u003e ansible win -m setup -a \"filter=ansible_distribution*\" kube02 | SUCCESS =\u003e { \"ansible_facts\": { \"ansible_distribution\": \"CentOS\", \"ansible_distribution_file_parsed\": true, \"ansible_distribution_file_path\": \"/etc/redhat-release\", \"ansible_distribution_file_variety\": \"RedHat\", \"ansible_distribution_major_version\": \"7\", \"ansible_distribution_release\": \"Core\", \"ansible_distribution_version\": \"7.6.1810\" }, \"changed\": false } kube01 | SUCCESS =\u003e { \"ansible_facts\": { \"ansible_distribution\": \"CentOS\", \"ansible_distribution_file_parsed\": true, \"ansible_distribution_file_path\": \"/etc/redhat-release\", \"ansible_distribution_file_variety\": \"RedHat\", \"ansible_distribution_major_version\": \"7\", \"ansible_distribution_release\": \"Core\", \"ansible_distribution_version\": \"7.6.1810\" }, \"changed\": false } kubem | SUCCESS =\u003e { \"ansible_facts\": { \"ansible_distribution\": \"CentOS\", \"ansible_distribution_file_parsed\": true, \"ansible_distribution_file_path\": \"/etc/redhat-release\", \"ansible_distribution_file_variety\": \"RedHat\", \"ansible_distribution_major_version\": \"7\", \"ansible_distribution_release\": \"Core\", \"ansible_distribution_version\": \"7.6.1810\" }, \"changed\": false } 192.168.28.25 | SUCCESS =\u003e { \"ansible_facts\": { \"ansible_architecture\": \"64비트\", \"ansible_bios_date\": \"11-10-2015\", \"ansible_bios_version\": \"P89\", \"ansible_date_time\": { .... }, \"ansible_distribution\": \"Microsoft Windows Server 2016 Standard\", \"ansible_distribution_major_version\": \"10\", \"ansible_distribution_version\": \"10.0.14393.0\", ... Ansible Facts OS 구분에 따른 필터링 when 구문 사용 - name: nginx hosts: localhost tasks: - service: name: nginx state: started become: yes when: ansible_distribution == 'CentOS' and ansible_distribution_major_version == '6' - systemd: name: nginx enabled: yes state: started become: yes when: ansible_distribution == 'CentOS' and ansible_distribution_major_version == '7' 참고 Awesome Ansible : https://github.com/jdauphant/awesome-ansible{:target=\"_blank\"} Ansible tutorial : https://github.com/leucos/ansible-tuto{:target=\"_blank\"} Ansible examples : https://github.com/ansible/ansible-examples{:target=\"_blank\"} ","wordCount":"1221","inLanguage":"en","datePublished":"2021-08-11T00:00:00+09:00","dateModified":"2021-08-11T00:00:00+09:00","author":{"@type":"Person","name":"Byung Kyu KIM"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://cdecl.github.io/devops/ansible-101/"},"publisher":{"@type":"Organization","name":"cdeclog","logo":{"@type":"ImageObject","url":"https://cdecl.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://cdecl.github.io/ accesskey=h title="cdeclog (Alt + H)">cdeclog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://cdecl.github.io/dev/ title=Dev><span>Dev</span></a></li><li><a href=https://cdecl.github.io/devops/ title=DevOps><span>DevOps</span></a></li><li><a href=https://cdecl.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://cdecl.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://cdecl.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://cdecl.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://cdecl.github.io/devops/>Devops</a></div><h1 class="post-title entry-hint-parent">Ansible-101</h1><div class=post-meta><span title='2021-08-11 00:00:00 +0900 KST'>August 11, 2021</span>&nbsp;·&nbsp;<span>Byung Kyu KIM</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#ansible-install aria-label="Ansible Install">Ansible Install</a></li><li><a href=#%ec%9a%a9%ec%96%b4-%ec%a0%95%ec%9d%98 aria-label="용어 정의">용어 정의</a></li><li><a href=#ansbile-config aria-label="Ansbile Config">Ansbile Config</a></li><li><a href=#inventory-%ea%b5%ac%ec%84%b1 aria-label="Inventory 구성">Inventory 구성</a></li><li><a href=#ad-hook-execute aria-label="Ad-hook Execute">Ad-hook Execute</a><ul><li><a href=#--example aria-label="- Example">- Example</a></li></ul></li><li><a href=#playbook-%ec%82%ac%ec%9a%a9 aria-label="Playbook 사용">Playbook 사용</a><ul><li><a href=#--example-1 aria-label="- Example">- Example</a></li></ul></li><li><a href=#tags-%ed%99%9c%ec%9a%a9 aria-label="Tags 활용">Tags 활용</a></li><li><a href=#windows-host-%ec%82%ac%ec%9a%a9 aria-label="Windows Host 사용">Windows Host 사용</a></li><li><a href=#ansible-facts aria-label="Ansible Facts">Ansible Facts</a><ul><li><a href=#ansible-facts-1 aria-label="Ansible Facts">Ansible Facts</a></li></ul></li><li><a href=#%ec%b0%b8%ea%b3%a0 aria-label=참고>참고</a></li></ul></div></details></div><div class=post-content><p>Ansible-101</p><h3 id=ansible-install>Ansible Install<a hidden class=anchor aria-hidden=true href=#ansible-install>#</a></h3><ul><li>Centos 7<ul><li>기본적으로 Python 2.7 기반으로 설치 됨</li><li>추후 pywinrm 패키지가 필요할때, python2-pip 패키지 추가 설치 필요</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo yum install ansible
</span></span></code></pre></div><ul><li>대안으로 pip 으로 설치 하는 방법 (user)</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install ansible <span style=color:#6272a4># --user </span>
</span></span></code></pre></div><h3 id=용어-정의>용어 정의<a hidden class=anchor aria-hidden=true href=#용어-정의>#</a></h3><ul><li>Inventory : 관리하는 원격 서버 목록<ul><li>지정하지 않으면 Default Path 의 hosts 파일을 참조<ul><li>/etc/ansible/hosts</li></ul></li></ul></li><li>Module : Task 를 실행하는 방법 (모듈)<ul><li><a href=https://docs.ansible.com/ansible/latest/modules/modules_by_category.html>https://docs.ansible.com/ansible/latest/modules/modules_by_category.html</a>{:target="_blank"}</li><li>e.g. - command, shell, copy, service</li></ul></li><li>Playbook : Task 실행 프로세스 정의서<ul><li>Yaml 파일로 작성</li></ul></li><li>멱등성(idempotence) : 연산을 여러 번 적용하더라도 결과가 달라지지 않는 성질을 의미한다.</li></ul><h3 id=ansbile-config>Ansbile Config<a hidden class=anchor aria-hidden=true href=#ansbile-config>#</a></h3><ul><li>Path : /etc/ansible/ansible.cfg</li><li>Ignore ansible ssh authenticity : ssh 최초 접속시 인증을 host key 체크 생략<ul><li><a href=https://stackoverflow.com/questions/32297456/how-to-ignore-ansible-ssh-authenticity-checking>https://stackoverflow.com/questions/32297456/how-to-ignore-ansible-ssh-authenticity-checking</a>{:target="_blank"}</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ff79c6>[</span>defaults<span style=color:#ff79c6>]</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>host_key_checking</span> <span style=color:#ff79c6>=</span> False
</span></span></code></pre></div><ul><li>Callback plugins<ul><li>minimal stdout</li></ul></li></ul><pre tabindex=0><code>[defaults]
stdout_callback = minimal
</code></pre><ul><li>참고 : How to disable strict host key checking in ssh?<ul><li><a href=https://askubuntu.com/questions/87449/how-to-disable-strict-host-key-checking-in-ssh>https://askubuntu.com/questions/87449/how-to-disable-strict-host-key-checking-in-ssh</a>{:target="_blank"}</li></ul></li></ul><h3 id=inventory-구성>Inventory 구성<a hidden class=anchor aria-hidden=true href=#inventory-구성>#</a></h3><ul><li>Public key 등록 사용 방법 : 키를 생성하고 public 키를 관리되는 서버에 등록 후 사용</li></ul><pre tabindex=0><code># Key 생성 
ssh-keygen

# Public key 등록
ssh-copy-id [server-ip] 
</code></pre><ul><li>Inventory 서버 등록 : /etc/ansible/hosts<ul><li>기본디렉토리의 Host 파일을 사용하지 않는다면 -i 옵션으로 Inventory 파일 지정</li><li><a href=https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html#list-of-behavioral-inventory-parameters>https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html#list-of-behavioral-inventory-parameters</a>{:target="_blank"}</li></ul></li></ul><pre tabindex=0><code># ansible host 파일 예제

192.168.1.5

[db]
192.168.1.10

[webservers]
192.168.1.100
192.168.1.110

# hosts 파일에 등록된 경우 
[apiserver]
apiserver1
apiserver2

# host명으로 등록
server1		ansible_host=192.168.1.50
server2		ansible_host=192.168.1.51
</code></pre><ul><li>Host 지정 방법<ul><li><code>all</code> : 해당 Inventory의 모든 서버</li><li><code>webservers</code> : webservers 라고 정의된 서버 목록</li><li><code>192.168.1.100</code> : 192.168.1.100 서버</li></ul></li></ul><h3 id=ad-hook-execute>Ad-hook Execute<a hidden class=anchor aria-hidden=true href=#ad-hook-execute>#</a></h3><ul><li>ansible 명령을 통한 inline 실행</li><li>주요 인수</li></ul><pre tabindex=0><code>Usage: ansible &lt;host-pattern&gt; [options]
  -a MODULE_ARGS, --args=MODULE_ARGS   module arguments                                                                   
  -e EXTRA_VARS, --extra-vars=EXTRA_VARS
    set additional variables as key=value or YAML/JSON, if filename prepend with @  
  -f FORKS, --forks=FORKS 
      specify number of parallel processes to use (default=5)                                                                        
  -h, --help            show this help message and exit                                                     
  -i INVENTORY, --inventory=INVENTORY, --inventory-file=INVENTORY                                           
      specify inventory host path or comma separated host                                
      list. --inventory-file is deprecated                                               
  -m MODULE_NAME, --module-name=MODULE_NAME                                                                 
      module name to execute (default=command)                                           
  -v, --verbose         verbose mode (-vvv for more, -vvvv to enable connection debugging)                                                              
  --version             show program&#39;s version number, config file location,                                
      configured module search path, module location,                                    
      executable location and exit                                                       
  -b, --become        run operations with become (does not imply password prompting)                                                                         
</code></pre><h4 id=--example>- Example<a hidden class=anchor aria-hidden=true href=#--example>#</a></h4><ul><li>hostname 확인</li></ul><pre tabindex=0><code># webservers 목록 실행 
# command 모듈, &#34;hostname&#34; 인수
ansible webservers -m command -a &#34;hostname&#34; 

# default module (생략가능) : -m command   
ansible webservers -a &#34;hostname&#34; 

# 모든 서버
ansible all -a &#34;hostname&#34; 
</code></pre><ul><li>기타 모듈 사용</li></ul><pre tabindex=0><code># ping 모듈 
ansible webservers -m ping

# copy 모듈 : local → host 
ansible webservers -m copy -a &#34;src=file.txt dest=/home/cdecl/web/&#34;

# service 모듈 : kubelet 서비스를 시작 
ansible webservers -m service -a &#34;name=kubelet state=started&#34;
</code></pre><h3 id=playbook-사용>Playbook 사용<a hidden class=anchor aria-hidden=true href=#playbook-사용>#</a></h3><p>일련의 Task(작업)를 기술하여, 프로세스를 실행하는 방법</p><ul><li>간략한 설명<ul><li>name : 작업을 설명하는 식별자 (주석, 생략가능)<ul><li>모듈 내에서의 name 은 다른 의미</li></ul></li><li>gather_facts : (yes | no ) Gathering Facts 작업 실행 및 생략<ul><li>Facts : 작업 시작전 Host 의 Name, CPU, Memory 등을 수집하는 Setup 모듈</li></ul></li><li>hosts : Inventory 내의 hosts 지정</li><li>tasks : 작업 목록들 (배열)</li><li>register : 작업을 해당 이름으로 등록, debug 항목에서 표준 출력을 받아오기 위해 사용</li><li>debug : debug 용 작업들 (msg, stdout 출력)</li><li>become : root 권한으로 실행</li><li>become_user : sudo 를 통해 실행할 계정</li><li>변수값 평가 : " {{ 변수 }} "<ul><li>-e 파라미터를 통해 전달 가능</li></ul></li></ul></li></ul><h4 id=--example-1>- Example<a hidden class=anchor aria-hidden=true href=#--example-1>#</a></h4><ul><li>Ping 모듈 테스트</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#ff79c6>name</span>: ping test 
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>hosts</span>: webservers
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>gather_facts</span>: <span style=color:#ff79c6>no</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>tasks</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>ping</span>:
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ansible-playbook ping.yml
</span></span></code></pre></div><ul><li>Shell 모듈 : out 이란 이름으로 작업을 등록</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#ff79c6>name</span>: get hostname
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>hosts</span>: localhost
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>tasks</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>shell</span>: <span style=color:#f1fa8c>&#34;hostname&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>register</span>: out  <span style=color:#6272a4># out 이란 이름으로 작업을 등록 </span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>debug</span>: <span style=color:#f1fa8c>&#34;var=out.stdout_lines&#34;</span>  <span style=color:#6272a4># out 의 stdout 을 모두 출력 </span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>&gt; ansible-playbook hostname.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>localhost | CHANGED | <span style=color:#8be9fd;font-style:italic>rc</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>0</span> &gt;&gt;
</span></span><span style=display:flex><span>centos24
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>localhost | <span style=color:#8be9fd;font-style:italic>SUCCESS</span> <span style=color:#ff79c6>=</span>&gt; <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;out.stdout_lines&#34;</span>: <span style=color:#ff79c6>[</span>
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;centos24&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>]</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>}</span>
</span></span></code></pre></div><ul><li>Service 모듈</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#ff79c6>name</span>: nginx service start
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>hosts</span>: localhost
</span></span><span style=display:flex><span>  <span style=color:#6272a4># gather_facts: no</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>tasks</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>service</span>: <span style=color:#6272a4># nginx 서비스를 시작</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>name</span>: nginx
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>state</span>: started
</span></span><span style=display:flex><span><span style=color:#6272a4>#       - service: &#34;name=nginx state=started&#34;  #  inline 으로 표현 가능</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>become</span>: <span style=color:#ff79c6>yes</span>  <span style=color:#6272a4># root 권한 실행</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>&gt; <span style=color:#6272a4># changed=1 : 상태 변화 있음 </span>
</span></span><span style=display:flex><span>&gt; ansible-playbook nginx.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PLAY <span style=color:#ff79c6>[</span>nginx service start<span style=color:#ff79c6>]</span> 
</span></span><span style=display:flex><span>TASK <span style=color:#ff79c6>[</span>service<span style=color:#ff79c6>]</span> ************changed: <span style=color:#ff79c6>[</span>localhost<span style=color:#ff79c6>]</span>
</span></span><span style=display:flex><span>PLAY RECAP ****************localhost                  : <span style=color:#8be9fd;font-style:italic>ok</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>1</span>    <span style=color:#8be9fd;font-style:italic>changed</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>1</span>    <span style=color:#8be9fd;font-style:italic>unreachable</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>0</span>    <span style=color:#8be9fd;font-style:italic>failed</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&gt; <span style=color:#6272a4># changed=0 : 상태 변화 없음 → 이미 started 상태 </span>
</span></span><span style=display:flex><span>&gt; ansible-playbook nginx.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PLAY <span style=color:#ff79c6>[</span>nginx service start<span style=color:#ff79c6>]</span> 
</span></span><span style=display:flex><span>TASK <span style=color:#ff79c6>[</span>service<span style=color:#ff79c6>]</span> ************changed: <span style=color:#ff79c6>[</span>localhost<span style=color:#ff79c6>]</span>
</span></span><span style=display:flex><span>PLAY RECAP ****************localhost                  : <span style=color:#8be9fd;font-style:italic>ok</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>1</span>    <span style=color:#8be9fd;font-style:italic>changed</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>0</span>    <span style=color:#8be9fd;font-style:italic>unreachable</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>0</span>    <span style=color:#8be9fd;font-style:italic>failed</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>0</span>
</span></span></code></pre></div><ul><li>Loop (with_items) 및 변수 (vars) 활용</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#ff79c6>name</span>: test 
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>hosts</span>: localhost
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>gather_facts</span>: <span style=color:#ff79c6>no</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>vars</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>SERVER_IP</span>: <span style=color:#bd93f9>10.20.10.20</span> 
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>tasks</span>:
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>name</span>: test
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>shell</span>: |<span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        echo docker run -d --name={{item.name}} -p {{item.port}}:80 \
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>          -e SERVER_IP={{SERVER_IP}}  </span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>with_items</span>:
</span></span><span style=display:flex><span>        - { <span style=color:#ff79c6>name</span>: <span style=color:#f1fa8c>&#34;tomcat01&#34;</span><span style=color:#ff79c6>, port</span>: <span style=color:#f1fa8c>&#34;8001&#34;</span> }
</span></span><span style=display:flex><span>        - { <span style=color:#ff79c6>name</span>: <span style=color:#f1fa8c>&#34;tomcat02&#34;</span><span style=color:#ff79c6>, port</span>: <span style=color:#f1fa8c>&#34;8002&#34;</span> }
</span></span><span style=display:flex><span>        - { <span style=color:#ff79c6>name</span>: <span style=color:#f1fa8c>&#34;tomcat03&#34;</span><span style=color:#ff79c6>, port</span>: <span style=color:#f1fa8c>&#34;8003&#34;</span> }
</span></span><span style=display:flex><span>        - { <span style=color:#ff79c6>name</span>: <span style=color:#f1fa8c>&#34;tomcat04&#34;</span><span style=color:#ff79c6>, port</span>: <span style=color:#f1fa8c>&#34;8004&#34;</span> }
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>register</span>: out
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>debug</span>: 
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>msg</span>: <span style=color:#f1fa8c>&#34;{{ item.stdout_lines }}&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>with_items</span>: <span style=color:#f1fa8c>&#34;{{ out.results }}&#34;</span>
</span></span></code></pre></div><p><img loading=lazy src=/images/2020-11-03-10-36-11.png></p><hr><h3 id=tags-활용>Tags 활용<a hidden class=anchor aria-hidden=true href=#tags-활용>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#ff79c6>name</span>: tags test
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>hosts</span>: localhost
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>tasks</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>shell </span>: echo step 1
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>register</span>: out
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>tags</span>: 
</span></span><span style=display:flex><span>        - step1
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>debug </span>: var=out.stdout_lines
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>tags</span>: 
</span></span><span style=display:flex><span>        - step1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>shell </span>: echo step 2
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>register</span>: out
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>tags</span>: 
</span></span><span style=display:flex><span>        - step2
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>debug </span>: var=out.stdout_lines
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>tags</span>: 
</span></span><span style=display:flex><span>        - step2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>shell </span>: echo step 3
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>register</span>: out
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>tags</span>: 
</span></span><span style=display:flex><span>        - step3
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>debug </span>: var=out.stdout_lines
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>tags</span>: 
</span></span><span style=display:flex><span>        - step3
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6272a4># Setp2 tags 만 실행 </span>
</span></span><span style=display:flex><span>&gt; ansible-playbook test.yml --tags <span style=color:#f1fa8c>&#34;step2&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ok: <span style=color:#ff79c6>[</span>localhost<span style=color:#ff79c6>]</span> <span style=color:#ff79c6>=</span>&gt; <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;out.stdout_lines&#34;</span>: <span style=color:#ff79c6>[</span>
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;step 2&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>]</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>}</span>
</span></span></code></pre></div><hr><h3 id=windows-host-사용>Windows Host 사용<a hidden class=anchor aria-hidden=true href=#windows-host-사용>#</a></h3><ul><li>Windows Host로 사용하는 방법<ul><li>ssh</li><li>winrm : <a href=https://github.com/cdecl/winrm-101>https://github.com/cdecl/winrm-101</a>{:target="_blank"}</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#6272a4># host 설정 : Service Enable </span>
</span></span><span style=display:flex><span>winrm qc 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 인증 및 AllowUnencrypted 설정 </span>
</span></span><span style=display:flex><span>winrm <span style=color:#8be9fd;font-style:italic>set </span>winrm/config/service/Auth <span style=color:#f1fa8c>&#39;@{Basic=&#34;true&#34;}&#39;</span>
</span></span><span style=display:flex><span>winrm <span style=color:#8be9fd;font-style:italic>set </span>winrm/config/service <span style=color:#f1fa8c>&#39;@{AllowUnencrypted=&#34;true&#34;}&#39;</span>
</span></span><span style=display:flex><span>winrm <span style=color:#8be9fd;font-style:italic>set </span>winrm/config/winrs <span style=color:#f1fa8c>&#39;@{MaxMemoryPerShellMB=&#34;1024&#34;}&#39;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6272a4># winrm 을 사용하기 위한 python 모듈 설치 </span>
</span></span><span style=display:flex><span>pip install pywinrm   <span style=color:#6272a4># --user </span>
</span></span></code></pre></div><ul><li>Inventory 구성</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#ff79c6>[win]</span>
</span></span><span style=display:flex><span><span style=color:#50fa7b>192.168.28.25</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>[win:vars]</span>
</span></span><span style=display:flex><span><span style=color:#50fa7b>ansible_user</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>rundeck</span>
</span></span><span style=display:flex><span><span style=color:#50fa7b>ansible_password</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&lt;passowrd&gt;</span>
</span></span><span style=display:flex><span><span style=color:#50fa7b>ansible_connection</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>winrm</span>
</span></span><span style=display:flex><span><span style=color:#50fa7b>ansible_port</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>5985  </span>
</span></span><span style=display:flex><span><span style=color:#6272a4># ansible_winrm_server_cert_validation=ignore</span>
</span></span></code></pre></div><ul><li>Windows 모듈<ul><li><a href=https://docs.ansible.com/ansible/latest/modules/list_of_windows_modules.html>https://docs.ansible.com/ansible/latest/modules/list_of_windows_modules.html</a>{:target="_blank"}</li><li>win_command – Executes a command on a remote Windows node</li><li>win_copy – Copies files to remote locations on windows hosts</li><li>win_shell – Execute shell commands on target hosts (powershell)</li><li>win_chocolatey – Manage packages using chocolatey</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#ff79c6>name</span>: ping test 
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>hosts</span>: win
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>gather_facts</span>: <span style=color:#ff79c6>no</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>tasks</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>win_ping</span>:
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>- <span style=color:#ff79c6>name</span>: Install git from a pre configured source (win_chocolatey_source)
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>hosts</span>: win
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>tasks</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>win_chocolatey</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>name</span>: git
</span></span></code></pre></div><hr><h3 id=ansible-facts>Ansible Facts<a hidden class=anchor aria-hidden=true href=#ansible-facts>#</a></h3><ul><li>Facts : 원격서버(Node)로 부터 수집한 정보를 담고 있는 변수</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6272a4># 원격서버 Facts 확인</span>
</span></span><span style=display:flex><span>&gt; ansible hostname -m setup 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubem | <span style=color:#8be9fd;font-style:italic>SUCCESS</span> <span style=color:#ff79c6>=</span>&gt; <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;ansible_facts&#34;</span>: <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_all_ipv4_addresses&#34;</span>: <span style=color:#ff79c6>[</span>
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;10.244.0.0&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;10.244.0.1&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;192.168.137.108&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;172.17.0.1&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>]</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_all_ipv6_addresses&#34;</span>: <span style=color:#ff79c6>[</span>
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;fe80::e04c:baff:fe78:2e93&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;fe80::b8f6:d7ff:fecc:4c91&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;fe80::f8e5:7ff:fe0f:6b60&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;fe80::48b8:90ff:fede:71cf&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;fe80::8aa8:d266:54e5:1608&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;fe80::2918:237b:3860:3272&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>]</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_apparmor&#34;</span>: <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;status&#34;</span>: <span style=color:#f1fa8c>&#34;disabled&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>}</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_architecture&#34;</span>: <span style=color:#f1fa8c>&#34;x86_64&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_bios_date&#34;</span>: <span style=color:#f1fa8c>&#34;11/26/2012&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_bios_version&#34;</span>: <span style=color:#f1fa8c>&#34;Hyper-V UEFI Release v1.0&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_cmdline&#34;</span>: <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;BOOT_IMAGE&#34;</span>: <span style=color:#f1fa8c>&#34;/vmlinuz-3.10.0-957.1.3.el7.x86_64&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;LANG&#34;</span>: <span style=color:#f1fa8c>&#34;ko_KR.UTF-8&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;crashkernel&#34;</span>: <span style=color:#f1fa8c>&#34;auto&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;quiet&#34;</span>: true,
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;rd.lvm.lv&#34;</span>: <span style=color:#f1fa8c>&#34;centos/swap&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;rhgb&#34;</span>: true,
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;ro&#34;</span>: true,
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;root&#34;</span>: <span style=color:#f1fa8c>&#34;/dev/mapper/centos-root&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>}</span>,
</span></span><span style=display:flex><span>...                                                       
</span></span></code></pre></div><ul><li>ansible_distribution 필터링<ul><li>OS 구분시 유효</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>&gt; ansible win -m setup -a <span style=color:#f1fa8c>&#34;filter=ansible_distribution*&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kube02 | <span style=color:#8be9fd;font-style:italic>SUCCESS</span> <span style=color:#ff79c6>=</span>&gt; <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;ansible_facts&#34;</span>: <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_distribution&#34;</span>: <span style=color:#f1fa8c>&#34;CentOS&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_distribution_file_parsed&#34;</span>: true,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_distribution_file_path&#34;</span>: <span style=color:#f1fa8c>&#34;/etc/redhat-release&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_distribution_file_variety&#34;</span>: <span style=color:#f1fa8c>&#34;RedHat&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_distribution_major_version&#34;</span>: <span style=color:#f1fa8c>&#34;7&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_distribution_release&#34;</span>: <span style=color:#f1fa8c>&#34;Core&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_distribution_version&#34;</span>: <span style=color:#f1fa8c>&#34;7.6.1810&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>}</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;changed&#34;</span>: <span style=color:#8be9fd;font-style:italic>false</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span>kube01 | <span style=color:#8be9fd;font-style:italic>SUCCESS</span> <span style=color:#ff79c6>=</span>&gt; <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;ansible_facts&#34;</span>: <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_distribution&#34;</span>: <span style=color:#f1fa8c>&#34;CentOS&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_distribution_file_parsed&#34;</span>: true,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_distribution_file_path&#34;</span>: <span style=color:#f1fa8c>&#34;/etc/redhat-release&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_distribution_file_variety&#34;</span>: <span style=color:#f1fa8c>&#34;RedHat&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_distribution_major_version&#34;</span>: <span style=color:#f1fa8c>&#34;7&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_distribution_release&#34;</span>: <span style=color:#f1fa8c>&#34;Core&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_distribution_version&#34;</span>: <span style=color:#f1fa8c>&#34;7.6.1810&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>}</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;changed&#34;</span>: <span style=color:#8be9fd;font-style:italic>false</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span>kubem | <span style=color:#8be9fd;font-style:italic>SUCCESS</span> <span style=color:#ff79c6>=</span>&gt; <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;ansible_facts&#34;</span>: <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_distribution&#34;</span>: <span style=color:#f1fa8c>&#34;CentOS&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_distribution_file_parsed&#34;</span>: true,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_distribution_file_path&#34;</span>: <span style=color:#f1fa8c>&#34;/etc/redhat-release&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_distribution_file_variety&#34;</span>: <span style=color:#f1fa8c>&#34;RedHat&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_distribution_major_version&#34;</span>: <span style=color:#f1fa8c>&#34;7&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_distribution_release&#34;</span>: <span style=color:#f1fa8c>&#34;Core&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_distribution_version&#34;</span>: <span style=color:#f1fa8c>&#34;7.6.1810&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>}</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;changed&#34;</span>: <span style=color:#8be9fd;font-style:italic>false</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span>192.168.28.25 | <span style=color:#8be9fd;font-style:italic>SUCCESS</span> <span style=color:#ff79c6>=</span>&gt; <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;ansible_facts&#34;</span>: <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_architecture&#34;</span>: <span style=color:#f1fa8c>&#34;64비트&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_bios_date&#34;</span>: <span style=color:#f1fa8c>&#34;11-10-2015&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_bios_version&#34;</span>: <span style=color:#f1fa8c>&#34;P89&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_date_time&#34;</span>: <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>			....
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>}</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_distribution&#34;</span>: <span style=color:#f1fa8c>&#34;Microsoft Windows Server 2016 Standard&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_distribution_major_version&#34;</span>: <span style=color:#f1fa8c>&#34;10&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;ansible_distribution_version&#34;</span>: <span style=color:#f1fa8c>&#34;10.0.14393.0&#34;</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><h4 id=ansible-facts-1>Ansible Facts<a hidden class=anchor aria-hidden=true href=#ansible-facts-1>#</a></h4><ul><li>OS 구분에 따른 필터링<ul><li>when 구문 사용</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span>- <span style=color:#ff79c6>name</span>: nginx
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>hosts</span>: localhost
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>tasks</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>service</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>name</span>: nginx
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>state</span>: started
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>become</span>: <span style=color:#ff79c6>yes</span>        
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>when</span>: ansible_distribution == &#39;CentOS&#39; and ansible_distribution_major_version == &#39;6&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>systemd</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>name</span>: nginx
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>enabled</span>: <span style=color:#ff79c6>yes</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>state</span>: started
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>become</span>: <span style=color:#ff79c6>yes</span>        
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>when</span>: ansible_distribution == &#39;CentOS&#39; and ansible_distribution_major_version == &#39;7&#39;
</span></span></code></pre></div><hr><h3 id=참고>참고<a hidden class=anchor aria-hidden=true href=#참고>#</a></h3><ul><li>Awesome Ansible : <a href=https://github.com/jdauphant/awesome-ansible>https://github.com/jdauphant/awesome-ansible</a>{:target="_blank"}<ul><li>Ansible tutorial : <a href=https://github.com/leucos/ansible-tuto>https://github.com/leucos/ansible-tuto</a>{:target="_blank"}</li><li>Ansible examples : <a href=https://github.com/ansible/ansible-examples>https://github.com/ansible/ansible-examples</a>{:target="_blank"}</li></ul></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://cdecl.github.io/tags/ansible/>Ansible</a></li></ul></footer><script src=https://giscus.app/client.js data-repo=cdecl/cdecl.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkzNDk1ODUyNjg=" data-category=General data-category-id=DIC_kwDOFNY_dM4C1XMk data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=transparent_dark data-lang=ko crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2026 <a href=https://cdecl.github.io/>cdeclog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>