<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Restic Basic | cdeclog</title><meta name=keywords content="restic,snapshot backup,minio,rclone"><meta name=description content='Snapshots 기능을 제공하는 modern backup program
restic

https://restic.net/{:target="_blank"}
Go로 만들어진 백업 프로그램, 크로스프랫폼 지원

- from Linux, BSD, Mac and Windows
- to many different storage types, including self-hosted and online services
- easily, being a single executable that you can run without a server or complex setup
- effectively, only transferring the parts that actually changed in the files you back up
- securely, by careful use of cryptography in every part of the process
- verifiably, enabling you to make sure that your files can be restored when needed
- freely - restic is entirely free to use and completely open source
Install

Package 설치 및 Binary 지원

Package : https://restic.readthedocs.io/en/stable/020_installation.html{:target="_blank"}
Binary : https://github.com/restic/restic/releases/tag/v0.12.1{:target="_blank"}



$ curl -LO https://github.com/restic/restic/releases/download/v0.12.1/restic_0.12.1_linux_amd64.bz2

# install bzip2
$ sudo yum install bzip2 -y

$ bunzip2 restic_0.12.1_linux_amd64.bz2
$ mv restic_0.12.1_linux_amd64 restic
$ sudo mv restic /usr/local/bin
$ restic

restic is a backup program which allows saving multiple revisions of files and
directories in an encrypted repository stored on different backends.

Usage:
  restic [command]

Available Commands:
  backup        Create a new backup of files and/or directories
  cache         Operate on local cache directories
  cat           Print internal objects to stdout
  check         Check the repository for errors
  copy          Copy snapshots from one repository to another
  diff          Show differences between two snapshots
  dump          Print a backed-up file to stdout
  find          Find a file, a directory or restic IDs
  forget        Remove snapshots from the repository
  generate      Generate manual pages and auto-completion files (bash, fish, zsh)
  help          Help about any command
  init          Initialize a new repository
  key           Manage keys (passwords)
  list          List objects in the repository
  ls            List files in a snapshot
  migrate       Apply migrations
  mount         Mount the repository
  prune         Remove unneeded data from the repository
  rebuild-index Build a new index
  recover       Recover data from the repository
  restore       Extract the data from a snapshot
  self-update   Update the restic binary
  snapshots     List all snapshots
  stats         Scan the repository and show basic statistics
  tag           Modify tags on snapshots
  unlock        Remove locks other processes created
  version       Print version information
....

Backup & Restore
Backup Repository 생성
# Repository 접근을 위한 패드워스 필요, 일단 1111
# -r, --repo repository repository to backup to or restore from (default: $RESTIC_REPOSITORY)
$ restic init -r repo
enter password for new repository:
enter password again:
created restic repository 7f3cfb3e9a at repo

Please note that knowledge of your password is required to access
the repository. Losing your password means that your data is
irrecoverably lost.

# password 파일 생성, -p 옵션으로 지정 
$ echo 1111 > passwd
Backup : snapshots 생성
# Backup 
# restic -r <repository> -p <passwd file> backup <Source>
# -p, --password-file file  file to read the repository password from (default: $RESTIC_PASSWORD_FILE)
$ restic -r repo -p passwd backup /home/cdecl/temp/mvcapp
repository e4ccc49d opened successfully, password is correct
no parent snapshot found, will read all files

Files:          79 new,     0 changed,     0 unmodified
Dirs:           40 new,     0 changed,     0 unmodified
Added to the repo: 4.854 MiB

processed 79 files, 4.811 MiB in 0:00
snapshot 9aff8447 saved

# 파일생성 및 다시백업 
$ touch /home/cdecl/temp/mvcapp/test.txt

$ restic -r repo -p passwd backup /home/cdecl/temp/mvcapp
repository e4ccc49d opened successfully, password is correct
using parent snapshot 9aff8447

Files:           1 new,     0 changed,    79 unmodified
Dirs:            0 new,     4 changed,    36 unmodified
Added to the repo: 7.742 KiB

processed 80 files, 4.811 MiB in 0:00
snapshot f4b94d9b saved
Snapshots 확인
# snapshots 2개 화인 확인
$ restic -r repo -p passwd snapshots
repository e4ccc49d opened successfully, password is correct
ID        Time                 Host        Tags        Paths
------------------------------------------------------------------------------
9aff8447  2021-11-25 15:17:52  centos1                 /home/cdecl/temp/mvcapp
f4b94d9b  2021-11-25 15:22:24  centos1                 /home/cdecl/temp/mvcapp
------------------------------------------------------------------------------
2 snapshots

Snapshots 비교

$ restic -r repo -p passwd diff 9aff8447 f4b94d9b
repository e4ccc49d opened successfully, password is correct
comparing snapshot 9aff8447 to f4b94d9b:

+    /home/cdecl/temp/mvcapp/test.txt

Files:           1 new,     0 removed,     0 changed
Dirs:            0 new,     0 removed
Others:          0 new,     0 removed
Data Blobs:      0 new,     0 removed
Tree Blobs:      5 new,     5 removed
  Added:   7.742 KiB
  Removed: 7.456 KiB
Restore : Snapshots 에서 복원
# restic -r <repository> -p <passwd file> restore <snapshots id> -t <Target>
$ restic -r repo -p passwd restore 9aff8447 -t restore-mvcapp
repository e4ccc49d opened successfully, password is correct
restoring <Snapshot 9aff8447 of [/home/cdecl/temp/mvcapp] at 2021-11-25 15:17:52.115925352 
 +0900 KST by cdecl@centos1> to restore-mvcapp
MinIO & RClone Backend 지원

https://restic.readthedocs.io/en/stable/030_preparing_a_new_repo.html{:target="_blank"}

Local, SFTP, REST Server, Amazon S3, Minio Server, Microsoft Azure Blob Storage, 
Google Cloud Storage, Other Services via rclone 등 지원
MinIO Repository 만들기
$ export AWS_ACCESS_KEY_ID=key
$ export AWS_SECRET_ACCESS_KEY=passwd

$  restic init -r s3:http://minio.server:9000/restic
enter password for new repository:
enter password again:
created restic repository 65a27250da at s3:http://minio.server:9000/restic

Please note that knowledge of your password is required to access
the repository. Losing your password means that your data is
irrecoverably lost.


# Backup
$ restic -r s3:http://minio.server:9000/restic -p passwd backup /home/cdecl/temp/mvcapp

# snapshots
$ restic -r s3:http://minio.server:9000/restic -p passwd snapshots
repository 65a27250 opened successfully, password is correct
ID        Time                 Host        Tags        Paths
------------------------------------------------------------------------------
73d37fbd  2021-11-25 15:37:34  centos1                 /home/cdecl/temp/mvcapp
------------------------------------------------------------------------------
1 snapshots
RClone Backend 로 사용
$ rclone config show
[infradb]
type = s3
env_auth = false
access_key_id = key
secret_access_key = passwd
region = us-east-1
endpoint = http://minio.server:9000

# rclone config 사용 respository 만들기 
$ restic init -r rclone:infradb:restic
enter password for new repository:
enter password again:
created restic repository ce850667c9 at rclone:infradb:restic

Please note that knowledge of your password is required to access
the repository. Losing your password means that your data is
irrecoverably lost.

# Backup
$ restic -r rclone:infradb:restic -p passwd backup /home/cdecl/temp/mvcapp

# snapshots
$ restic -r rclone:infradb:restic -p passwd snapshots

Snapshots 관리

https://restic.readthedocs.io/en/stable/060_forget.html{:target="_blank"}

$ restic -r rclone:infradb:restic -p passwd snapshots
repository ce850667 opened successfully, password is correct
ID        Time                 Host        Tags        Paths
------------------------------------------------------------------------------
a3737738  2021-11-25 15:44:05  centos1                 /home/cdecl/temp/mvcapp
00f16d70  2021-11-25 15:44:50  centos1                 /home/cdecl/temp/mvcapp
0e83568a  2021-11-25 15:44:51  centos1                 /home/cdecl/temp/mvcapp
4041e3ca  2021-11-25 15:44:53  centos1                 /home/cdecl/temp/mvcapp
eb1e56c7  2021-11-25 15:44:54  centos1                 /home/cdecl/temp/mvcapp
d81b3d2a  2021-11-25 15:44:55  centos1                 /home/cdecl/temp/mvcapp
------------------------------------------------------------------------------
6 snapshots

# snapshots 1개 지우기
$ restic -r rclone:infradb:restic -p passwd forget d81b3d2a
repository ce850667 opened successfully, password is correct
[0:00] 100.00%  1 / 1 files deleted

# 스냅샷의 파일에서 참조한 데이터는 여전히 저장소에 저장
# 참조되지 않은 데이터를 정리하려면 prune 명령 실행
$ restic -r rclone:infradb:restic -p passwd prune
repository ce850667 opened successfully, password is correct
loading indexes...
loading all snapshots...
finding data that is still in use for 5 snapshots
[0:00] 100.00%  5 / 5 snapshots
searching used packs...
collecting packs for deletion and repacking
[0:00] 100.00%  9 / 9 packs processed

to repack:            0 blobs / 0 B
this removes          0 blobs / 0 B
to delete:            2 blobs / 1004 B
total prune:          2 blobs / 1004 B
remaining:          125 blobs / 4.862 MiB
unused size after prune: 0 B (0.00% of remaining size)

rebuilding index
[0:00] 100.00%  8 / 8 packs processed
deleting obsolete index files
[0:00] 100.00%  6 / 6 files deleted
removing 1 old packs
[0:00] 100.00%  1 / 1 files deleted
done

# 최근 1개만 놔두고 snapshots 삭제 및 prune
$ restic -r rclone:infradb:restic -p passwd forget --keep-last 1 --prune
repository ce850667 opened successfully, password is correct
Applying Policy: keep 1 latest snapshots
keep 1 snapshots:
ID        Time                 Host        Tags        Reasons        Paths
---------------------------------------------------------------------------------------------
eb1e56c7  2021-11-25 15:44:54  centos1                 last snapshot  /home/cdecl/temp/mvcapp
---------------------------------------------------------------------------------------------
1 snapshots

remove 4 snapshots:
ID        Time                 Host        Tags        Paths
------------------------------------------------------------------------------
a3737738  2021-11-25 15:44:05  centos1                 /home/cdecl/temp/mvcapp
00f16d70  2021-11-25 15:44:50  centos1                 /home/cdecl/temp/mvcapp
0e83568a  2021-11-25 15:44:51  centos1                 /home/cdecl/temp/mvcapp
4041e3ca  2021-11-25 15:44:53  centos1                 /home/cdecl/temp/mvcapp
------------------------------------------------------------------------------
4 snapshots

[0:00] 100.00%  4 / 4 files deleted
4 snapshots have been removed, running prune
loading indexes...
loading all snapshots...
finding data that is still in use for 1 snapshots
[0:00] 100.00%  1 / 1 snapshots
searching used packs...
collecting packs for deletion and repacking
[0:00] 100.00%  8 / 8 packs processed

to repack:           39 blobs / 47.305 KiB
this removes          2 blobs / 1007 B
to delete:            6 blobs / 2.950 KiB
total prune:          8 blobs / 3.934 KiB
remaining:          117 blobs / 4.858 MiB
unused size after prune: 0 B (0.00% of remaining size)

repacking packs
[0:00] 100.00%  2 / 2 packs repacked
rebuilding index
[0:00] 100.00%  5 / 5 packs processed
deleting obsolete index files
[0:00] 100.00%  1 / 1 files deleted
removing 5 old packs
[0:00] 100.00%  5 / 5 files deleted
done

# snapshots 확인
$ restic -r rclone:infradb:restic -p passwd snapshots
repository ce850667 opened successfully, password is correct
ID        Time                 Host        Tags        Paths
------------------------------------------------------------------------------
eb1e56c7  2021-11-25 15:44:54  centos1                 /home/cdecl/temp/mvcapp
------------------------------------------------------------------------------
1 snapshots

forget 주요 인수

--keep-last n never delete the n last (most recent) snapshots
--keep-hourly n for the last n hours in which a snapshot was made, keep only the last snapshot for each hour.
--keep-daily n for the last n days which have one or more snapshots, only keep the last one for that day.
--keep-weekly n for the last n weeks which have one or more snapshots, only keep the last one for that week.
--keep-monthly n for the last n months which have one or more snapshots, only keep the last one for that month.
--keep-yearly n for the last n years which have one or more snapshots, only keep the last one for that year.
--keep-tag keep all snapshots which have all tags specified by this option (can be specified multiple times).
'><meta name=author content="Byung Kyu KIM"><link rel=canonical href=https://cdecl.github.io/devops/restic-basic/><link crossorigin=anonymous href=/assets/css/stylesheet.54a2acb878b1e8e44d17c120f64b04a7b2e96d45aafeeef8e52e931080d3fbab.css integrity="sha256-VKKsuHix6ORNF8Eg9ksEp7LpbUWq/u745S6TEIDT+6s=" rel="preload stylesheet" as=style><link rel=icon href=https://cdecl.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://cdecl.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://cdecl.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://cdecl.github.io/apple-touch-icon.png><link rel=mask-icon href=https://cdecl.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://cdecl.github.io/devops/restic-basic/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-VQQHHYPN7K"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VQQHHYPN7K")}</script><meta property="og:url" content="https://cdecl.github.io/devops/restic-basic/"><meta property="og:site_name" content="cdeclog"><meta property="og:title" content="Restic Basic"><meta property="og:description" content='Snapshots 기능을 제공하는 modern backup program
restic https://restic.net/{:target="_blank"} Go로 만들어진 백업 프로그램, 크로스프랫폼 지원 - from Linux, BSD, Mac and Windows - to many different storage types, including self-hosted and online services - easily, being a single executable that you can run without a server or complex setup - effectively, only transferring the parts that actually changed in the files you back up - securely, by careful use of cryptography in every part of the process - verifiably, enabling you to make sure that your files can be restored when needed - freely - restic is entirely free to use and completely open source Install Package 설치 및 Binary 지원 Package : https://restic.readthedocs.io/en/stable/020_installation.html{:target="_blank"} Binary : https://github.com/restic/restic/releases/tag/v0.12.1{:target="_blank"} $ curl -LO https://github.com/restic/restic/releases/download/v0.12.1/restic_0.12.1_linux_amd64.bz2 # install bzip2 $ sudo yum install bzip2 -y $ bunzip2 restic_0.12.1_linux_amd64.bz2 $ mv restic_0.12.1_linux_amd64 restic $ sudo mv restic /usr/local/bin $ restic restic is a backup program which allows saving multiple revisions of files and directories in an encrypted repository stored on different backends. Usage: restic [command] Available Commands: backup Create a new backup of files and/or directories cache Operate on local cache directories cat Print internal objects to stdout check Check the repository for errors copy Copy snapshots from one repository to another diff Show differences between two snapshots dump Print a backed-up file to stdout find Find a file, a directory or restic IDs forget Remove snapshots from the repository generate Generate manual pages and auto-completion files (bash, fish, zsh) help Help about any command init Initialize a new repository key Manage keys (passwords) list List objects in the repository ls List files in a snapshot migrate Apply migrations mount Mount the repository prune Remove unneeded data from the repository rebuild-index Build a new index recover Recover data from the repository restore Extract the data from a snapshot self-update Update the restic binary snapshots List all snapshots stats Scan the repository and show basic statistics tag Modify tags on snapshots unlock Remove locks other processes created version Print version information .... Backup & Restore Backup Repository 생성 # Repository 접근을 위한 패드워스 필요, 일단 1111 # -r, --repo repository repository to backup to or restore from (default: $RESTIC_REPOSITORY) $ restic init -r repo enter password for new repository: enter password again: created restic repository 7f3cfb3e9a at repo Please note that knowledge of your password is required to access the repository. Losing your password means that your data is irrecoverably lost. # password 파일 생성, -p 옵션으로 지정 $ echo 1111 > passwd Backup : snapshots 생성 # Backup # restic -r <repository> -p <passwd file> backup <Source> # -p, --password-file file file to read the repository password from (default: $RESTIC_PASSWORD_FILE) $ restic -r repo -p passwd backup /home/cdecl/temp/mvcapp repository e4ccc49d opened successfully, password is correct no parent snapshot found, will read all files Files: 79 new, 0 changed, 0 unmodified Dirs: 40 new, 0 changed, 0 unmodified Added to the repo: 4.854 MiB processed 79 files, 4.811 MiB in 0:00 snapshot 9aff8447 saved # 파일생성 및 다시백업 $ touch /home/cdecl/temp/mvcapp/test.txt $ restic -r repo -p passwd backup /home/cdecl/temp/mvcapp repository e4ccc49d opened successfully, password is correct using parent snapshot 9aff8447 Files: 1 new, 0 changed, 79 unmodified Dirs: 0 new, 4 changed, 36 unmodified Added to the repo: 7.742 KiB processed 80 files, 4.811 MiB in 0:00 snapshot f4b94d9b saved Snapshots 확인 # snapshots 2개 화인 확인 $ restic -r repo -p passwd snapshots repository e4ccc49d opened successfully, password is correct ID Time Host Tags Paths ------------------------------------------------------------------------------ 9aff8447 2021-11-25 15:17:52 centos1 /home/cdecl/temp/mvcapp f4b94d9b 2021-11-25 15:22:24 centos1 /home/cdecl/temp/mvcapp ------------------------------------------------------------------------------ 2 snapshots Snapshots 비교 $ restic -r repo -p passwd diff 9aff8447 f4b94d9b repository e4ccc49d opened successfully, password is correct comparing snapshot 9aff8447 to f4b94d9b: + /home/cdecl/temp/mvcapp/test.txt Files: 1 new, 0 removed, 0 changed Dirs: 0 new, 0 removed Others: 0 new, 0 removed Data Blobs: 0 new, 0 removed Tree Blobs: 5 new, 5 removed Added: 7.742 KiB Removed: 7.456 KiB Restore : Snapshots 에서 복원 # restic -r <repository> -p <passwd file> restore <snapshots id> -t <Target> $ restic -r repo -p passwd restore 9aff8447 -t restore-mvcapp repository e4ccc49d opened successfully, password is correct restoring <Snapshot 9aff8447 of [/home/cdecl/temp/mvcapp] at 2021-11-25 15:17:52.115925352 +0900 KST by cdecl@centos1> to restore-mvcapp MinIO & RClone Backend 지원 https://restic.readthedocs.io/en/stable/030_preparing_a_new_repo.html{:target="_blank"} Local, SFTP, REST Server, Amazon S3, Minio Server, Microsoft Azure Blob Storage, Google Cloud Storage, Other Services via rclone 등 지원 MinIO Repository 만들기 $ export AWS_ACCESS_KEY_ID=key $ export AWS_SECRET_ACCESS_KEY=passwd $ restic init -r s3:http://minio.server:9000/restic enter password for new repository: enter password again: created restic repository 65a27250da at s3:http://minio.server:9000/restic Please note that knowledge of your password is required to access the repository. Losing your password means that your data is irrecoverably lost. # Backup $ restic -r s3:http://minio.server:9000/restic -p passwd backup /home/cdecl/temp/mvcapp # snapshots $ restic -r s3:http://minio.server:9000/restic -p passwd snapshots repository 65a27250 opened successfully, password is correct ID Time Host Tags Paths ------------------------------------------------------------------------------ 73d37fbd 2021-11-25 15:37:34 centos1 /home/cdecl/temp/mvcapp ------------------------------------------------------------------------------ 1 snapshots RClone Backend 로 사용 $ rclone config show [infradb] type = s3 env_auth = false access_key_id = key secret_access_key = passwd region = us-east-1 endpoint = http://minio.server:9000 # rclone config 사용 respository 만들기 $ restic init -r rclone:infradb:restic enter password for new repository: enter password again: created restic repository ce850667c9 at rclone:infradb:restic Please note that knowledge of your password is required to access the repository. Losing your password means that your data is irrecoverably lost. # Backup $ restic -r rclone:infradb:restic -p passwd backup /home/cdecl/temp/mvcapp # snapshots $ restic -r rclone:infradb:restic -p passwd snapshots Snapshots 관리 https://restic.readthedocs.io/en/stable/060_forget.html{:target="_blank"} $ restic -r rclone:infradb:restic -p passwd snapshots repository ce850667 opened successfully, password is correct ID Time Host Tags Paths ------------------------------------------------------------------------------ a3737738 2021-11-25 15:44:05 centos1 /home/cdecl/temp/mvcapp 00f16d70 2021-11-25 15:44:50 centos1 /home/cdecl/temp/mvcapp 0e83568a 2021-11-25 15:44:51 centos1 /home/cdecl/temp/mvcapp 4041e3ca 2021-11-25 15:44:53 centos1 /home/cdecl/temp/mvcapp eb1e56c7 2021-11-25 15:44:54 centos1 /home/cdecl/temp/mvcapp d81b3d2a 2021-11-25 15:44:55 centos1 /home/cdecl/temp/mvcapp ------------------------------------------------------------------------------ 6 snapshots # snapshots 1개 지우기 $ restic -r rclone:infradb:restic -p passwd forget d81b3d2a repository ce850667 opened successfully, password is correct [0:00] 100.00% 1 / 1 files deleted # 스냅샷의 파일에서 참조한 데이터는 여전히 저장소에 저장 # 참조되지 않은 데이터를 정리하려면 prune 명령 실행 $ restic -r rclone:infradb:restic -p passwd prune repository ce850667 opened successfully, password is correct loading indexes... loading all snapshots... finding data that is still in use for 5 snapshots [0:00] 100.00% 5 / 5 snapshots searching used packs... collecting packs for deletion and repacking [0:00] 100.00% 9 / 9 packs processed to repack: 0 blobs / 0 B this removes 0 blobs / 0 B to delete: 2 blobs / 1004 B total prune: 2 blobs / 1004 B remaining: 125 blobs / 4.862 MiB unused size after prune: 0 B (0.00% of remaining size) rebuilding index [0:00] 100.00% 8 / 8 packs processed deleting obsolete index files [0:00] 100.00% 6 / 6 files deleted removing 1 old packs [0:00] 100.00% 1 / 1 files deleted done # 최근 1개만 놔두고 snapshots 삭제 및 prune $ restic -r rclone:infradb:restic -p passwd forget --keep-last 1 --prune repository ce850667 opened successfully, password is correct Applying Policy: keep 1 latest snapshots keep 1 snapshots: ID Time Host Tags Reasons Paths --------------------------------------------------------------------------------------------- eb1e56c7 2021-11-25 15:44:54 centos1 last snapshot /home/cdecl/temp/mvcapp --------------------------------------------------------------------------------------------- 1 snapshots remove 4 snapshots: ID Time Host Tags Paths ------------------------------------------------------------------------------ a3737738 2021-11-25 15:44:05 centos1 /home/cdecl/temp/mvcapp 00f16d70 2021-11-25 15:44:50 centos1 /home/cdecl/temp/mvcapp 0e83568a 2021-11-25 15:44:51 centos1 /home/cdecl/temp/mvcapp 4041e3ca 2021-11-25 15:44:53 centos1 /home/cdecl/temp/mvcapp ------------------------------------------------------------------------------ 4 snapshots [0:00] 100.00% 4 / 4 files deleted 4 snapshots have been removed, running prune loading indexes... loading all snapshots... finding data that is still in use for 1 snapshots [0:00] 100.00% 1 / 1 snapshots searching used packs... collecting packs for deletion and repacking [0:00] 100.00% 8 / 8 packs processed to repack: 39 blobs / 47.305 KiB this removes 2 blobs / 1007 B to delete: 6 blobs / 2.950 KiB total prune: 8 blobs / 3.934 KiB remaining: 117 blobs / 4.858 MiB unused size after prune: 0 B (0.00% of remaining size) repacking packs [0:00] 100.00% 2 / 2 packs repacked rebuilding index [0:00] 100.00% 5 / 5 packs processed deleting obsolete index files [0:00] 100.00% 1 / 1 files deleted removing 5 old packs [0:00] 100.00% 5 / 5 files deleted done # snapshots 확인 $ restic -r rclone:infradb:restic -p passwd snapshots repository ce850667 opened successfully, password is correct ID Time Host Tags Paths ------------------------------------------------------------------------------ eb1e56c7 2021-11-25 15:44:54 centos1 /home/cdecl/temp/mvcapp ------------------------------------------------------------------------------ 1 snapshots forget 주요 인수 --keep-last n never delete the n last (most recent) snapshots --keep-hourly n for the last n hours in which a snapshot was made, keep only the last snapshot for each hour. --keep-daily n for the last n days which have one or more snapshots, only keep the last one for that day. --keep-weekly n for the last n weeks which have one or more snapshots, only keep the last one for that week. --keep-monthly n for the last n months which have one or more snapshots, only keep the last one for that month. --keep-yearly n for the last n years which have one or more snapshots, only keep the last one for that year. --keep-tag keep all snapshots which have all tags specified by this option (can be specified multiple times). '><meta property="og:locale" content="ko-kr"><meta property="og:type" content="article"><meta property="article:section" content="devops"><meta property="article:published_time" content="2021-11-25T00:00:00+09:00"><meta property="article:modified_time" content="2021-11-25T00:00:00+09:00"><meta property="article:tag" content="Restic"><meta property="article:tag" content="Snapshot Backup"><meta property="article:tag" content="Minio"><meta property="article:tag" content="Rclone"><meta name=twitter:card content="summary"><meta name=twitter:title content="Restic Basic"><meta name=twitter:description content='Snapshots 기능을 제공하는 modern backup program
restic

https://restic.net/{:target="_blank"}
Go로 만들어진 백업 프로그램, 크로스프랫폼 지원

- from Linux, BSD, Mac and Windows
- to many different storage types, including self-hosted and online services
- easily, being a single executable that you can run without a server or complex setup
- effectively, only transferring the parts that actually changed in the files you back up
- securely, by careful use of cryptography in every part of the process
- verifiably, enabling you to make sure that your files can be restored when needed
- freely - restic is entirely free to use and completely open source
Install

Package 설치 및 Binary 지원

Package : https://restic.readthedocs.io/en/stable/020_installation.html{:target="_blank"}
Binary : https://github.com/restic/restic/releases/tag/v0.12.1{:target="_blank"}



$ curl -LO https://github.com/restic/restic/releases/download/v0.12.1/restic_0.12.1_linux_amd64.bz2

# install bzip2
$ sudo yum install bzip2 -y

$ bunzip2 restic_0.12.1_linux_amd64.bz2
$ mv restic_0.12.1_linux_amd64 restic
$ sudo mv restic /usr/local/bin
$ restic

restic is a backup program which allows saving multiple revisions of files and
directories in an encrypted repository stored on different backends.

Usage:
  restic [command]

Available Commands:
  backup        Create a new backup of files and/or directories
  cache         Operate on local cache directories
  cat           Print internal objects to stdout
  check         Check the repository for errors
  copy          Copy snapshots from one repository to another
  diff          Show differences between two snapshots
  dump          Print a backed-up file to stdout
  find          Find a file, a directory or restic IDs
  forget        Remove snapshots from the repository
  generate      Generate manual pages and auto-completion files (bash, fish, zsh)
  help          Help about any command
  init          Initialize a new repository
  key           Manage keys (passwords)
  list          List objects in the repository
  ls            List files in a snapshot
  migrate       Apply migrations
  mount         Mount the repository
  prune         Remove unneeded data from the repository
  rebuild-index Build a new index
  recover       Recover data from the repository
  restore       Extract the data from a snapshot
  self-update   Update the restic binary
  snapshots     List all snapshots
  stats         Scan the repository and show basic statistics
  tag           Modify tags on snapshots
  unlock        Remove locks other processes created
  version       Print version information
....

Backup & Restore
Backup Repository 생성
# Repository 접근을 위한 패드워스 필요, 일단 1111
# -r, --repo repository repository to backup to or restore from (default: $RESTIC_REPOSITORY)
$ restic init -r repo
enter password for new repository:
enter password again:
created restic repository 7f3cfb3e9a at repo

Please note that knowledge of your password is required to access
the repository. Losing your password means that your data is
irrecoverably lost.

# password 파일 생성, -p 옵션으로 지정 
$ echo 1111 > passwd
Backup : snapshots 생성
# Backup 
# restic -r <repository> -p <passwd file> backup <Source>
# -p, --password-file file  file to read the repository password from (default: $RESTIC_PASSWORD_FILE)
$ restic -r repo -p passwd backup /home/cdecl/temp/mvcapp
repository e4ccc49d opened successfully, password is correct
no parent snapshot found, will read all files

Files:          79 new,     0 changed,     0 unmodified
Dirs:           40 new,     0 changed,     0 unmodified
Added to the repo: 4.854 MiB

processed 79 files, 4.811 MiB in 0:00
snapshot 9aff8447 saved

# 파일생성 및 다시백업 
$ touch /home/cdecl/temp/mvcapp/test.txt

$ restic -r repo -p passwd backup /home/cdecl/temp/mvcapp
repository e4ccc49d opened successfully, password is correct
using parent snapshot 9aff8447

Files:           1 new,     0 changed,    79 unmodified
Dirs:            0 new,     4 changed,    36 unmodified
Added to the repo: 7.742 KiB

processed 80 files, 4.811 MiB in 0:00
snapshot f4b94d9b saved
Snapshots 확인
# snapshots 2개 화인 확인
$ restic -r repo -p passwd snapshots
repository e4ccc49d opened successfully, password is correct
ID        Time                 Host        Tags        Paths
------------------------------------------------------------------------------
9aff8447  2021-11-25 15:17:52  centos1                 /home/cdecl/temp/mvcapp
f4b94d9b  2021-11-25 15:22:24  centos1                 /home/cdecl/temp/mvcapp
------------------------------------------------------------------------------
2 snapshots

Snapshots 비교

$ restic -r repo -p passwd diff 9aff8447 f4b94d9b
repository e4ccc49d opened successfully, password is correct
comparing snapshot 9aff8447 to f4b94d9b:

+    /home/cdecl/temp/mvcapp/test.txt

Files:           1 new,     0 removed,     0 changed
Dirs:            0 new,     0 removed
Others:          0 new,     0 removed
Data Blobs:      0 new,     0 removed
Tree Blobs:      5 new,     5 removed
  Added:   7.742 KiB
  Removed: 7.456 KiB
Restore : Snapshots 에서 복원
# restic -r <repository> -p <passwd file> restore <snapshots id> -t <Target>
$ restic -r repo -p passwd restore 9aff8447 -t restore-mvcapp
repository e4ccc49d opened successfully, password is correct
restoring <Snapshot 9aff8447 of [/home/cdecl/temp/mvcapp] at 2021-11-25 15:17:52.115925352 
 +0900 KST by cdecl@centos1> to restore-mvcapp
MinIO & RClone Backend 지원

https://restic.readthedocs.io/en/stable/030_preparing_a_new_repo.html{:target="_blank"}

Local, SFTP, REST Server, Amazon S3, Minio Server, Microsoft Azure Blob Storage, 
Google Cloud Storage, Other Services via rclone 등 지원
MinIO Repository 만들기
$ export AWS_ACCESS_KEY_ID=key
$ export AWS_SECRET_ACCESS_KEY=passwd

$  restic init -r s3:http://minio.server:9000/restic
enter password for new repository:
enter password again:
created restic repository 65a27250da at s3:http://minio.server:9000/restic

Please note that knowledge of your password is required to access
the repository. Losing your password means that your data is
irrecoverably lost.


# Backup
$ restic -r s3:http://minio.server:9000/restic -p passwd backup /home/cdecl/temp/mvcapp

# snapshots
$ restic -r s3:http://minio.server:9000/restic -p passwd snapshots
repository 65a27250 opened successfully, password is correct
ID        Time                 Host        Tags        Paths
------------------------------------------------------------------------------
73d37fbd  2021-11-25 15:37:34  centos1                 /home/cdecl/temp/mvcapp
------------------------------------------------------------------------------
1 snapshots
RClone Backend 로 사용
$ rclone config show
[infradb]
type = s3
env_auth = false
access_key_id = key
secret_access_key = passwd
region = us-east-1
endpoint = http://minio.server:9000

# rclone config 사용 respository 만들기 
$ restic init -r rclone:infradb:restic
enter password for new repository:
enter password again:
created restic repository ce850667c9 at rclone:infradb:restic

Please note that knowledge of your password is required to access
the repository. Losing your password means that your data is
irrecoverably lost.

# Backup
$ restic -r rclone:infradb:restic -p passwd backup /home/cdecl/temp/mvcapp

# snapshots
$ restic -r rclone:infradb:restic -p passwd snapshots

Snapshots 관리

https://restic.readthedocs.io/en/stable/060_forget.html{:target="_blank"}

$ restic -r rclone:infradb:restic -p passwd snapshots
repository ce850667 opened successfully, password is correct
ID        Time                 Host        Tags        Paths
------------------------------------------------------------------------------
a3737738  2021-11-25 15:44:05  centos1                 /home/cdecl/temp/mvcapp
00f16d70  2021-11-25 15:44:50  centos1                 /home/cdecl/temp/mvcapp
0e83568a  2021-11-25 15:44:51  centos1                 /home/cdecl/temp/mvcapp
4041e3ca  2021-11-25 15:44:53  centos1                 /home/cdecl/temp/mvcapp
eb1e56c7  2021-11-25 15:44:54  centos1                 /home/cdecl/temp/mvcapp
d81b3d2a  2021-11-25 15:44:55  centos1                 /home/cdecl/temp/mvcapp
------------------------------------------------------------------------------
6 snapshots

# snapshots 1개 지우기
$ restic -r rclone:infradb:restic -p passwd forget d81b3d2a
repository ce850667 opened successfully, password is correct
[0:00] 100.00%  1 / 1 files deleted

# 스냅샷의 파일에서 참조한 데이터는 여전히 저장소에 저장
# 참조되지 않은 데이터를 정리하려면 prune 명령 실행
$ restic -r rclone:infradb:restic -p passwd prune
repository ce850667 opened successfully, password is correct
loading indexes...
loading all snapshots...
finding data that is still in use for 5 snapshots
[0:00] 100.00%  5 / 5 snapshots
searching used packs...
collecting packs for deletion and repacking
[0:00] 100.00%  9 / 9 packs processed

to repack:            0 blobs / 0 B
this removes          0 blobs / 0 B
to delete:            2 blobs / 1004 B
total prune:          2 blobs / 1004 B
remaining:          125 blobs / 4.862 MiB
unused size after prune: 0 B (0.00% of remaining size)

rebuilding index
[0:00] 100.00%  8 / 8 packs processed
deleting obsolete index files
[0:00] 100.00%  6 / 6 files deleted
removing 1 old packs
[0:00] 100.00%  1 / 1 files deleted
done

# 최근 1개만 놔두고 snapshots 삭제 및 prune
$ restic -r rclone:infradb:restic -p passwd forget --keep-last 1 --prune
repository ce850667 opened successfully, password is correct
Applying Policy: keep 1 latest snapshots
keep 1 snapshots:
ID        Time                 Host        Tags        Reasons        Paths
---------------------------------------------------------------------------------------------
eb1e56c7  2021-11-25 15:44:54  centos1                 last snapshot  /home/cdecl/temp/mvcapp
---------------------------------------------------------------------------------------------
1 snapshots

remove 4 snapshots:
ID        Time                 Host        Tags        Paths
------------------------------------------------------------------------------
a3737738  2021-11-25 15:44:05  centos1                 /home/cdecl/temp/mvcapp
00f16d70  2021-11-25 15:44:50  centos1                 /home/cdecl/temp/mvcapp
0e83568a  2021-11-25 15:44:51  centos1                 /home/cdecl/temp/mvcapp
4041e3ca  2021-11-25 15:44:53  centos1                 /home/cdecl/temp/mvcapp
------------------------------------------------------------------------------
4 snapshots

[0:00] 100.00%  4 / 4 files deleted
4 snapshots have been removed, running prune
loading indexes...
loading all snapshots...
finding data that is still in use for 1 snapshots
[0:00] 100.00%  1 / 1 snapshots
searching used packs...
collecting packs for deletion and repacking
[0:00] 100.00%  8 / 8 packs processed

to repack:           39 blobs / 47.305 KiB
this removes          2 blobs / 1007 B
to delete:            6 blobs / 2.950 KiB
total prune:          8 blobs / 3.934 KiB
remaining:          117 blobs / 4.858 MiB
unused size after prune: 0 B (0.00% of remaining size)

repacking packs
[0:00] 100.00%  2 / 2 packs repacked
rebuilding index
[0:00] 100.00%  5 / 5 packs processed
deleting obsolete index files
[0:00] 100.00%  1 / 1 files deleted
removing 5 old packs
[0:00] 100.00%  5 / 5 files deleted
done

# snapshots 확인
$ restic -r rclone:infradb:restic -p passwd snapshots
repository ce850667 opened successfully, password is correct
ID        Time                 Host        Tags        Paths
------------------------------------------------------------------------------
eb1e56c7  2021-11-25 15:44:54  centos1                 /home/cdecl/temp/mvcapp
------------------------------------------------------------------------------
1 snapshots

forget 주요 인수

--keep-last n never delete the n last (most recent) snapshots
--keep-hourly n for the last n hours in which a snapshot was made, keep only the last snapshot for each hour.
--keep-daily n for the last n days which have one or more snapshots, only keep the last one for that day.
--keep-weekly n for the last n weeks which have one or more snapshots, only keep the last one for that week.
--keep-monthly n for the last n months which have one or more snapshots, only keep the last one for that month.
--keep-yearly n for the last n years which have one or more snapshots, only keep the last one for that year.
--keep-tag keep all snapshots which have all tags specified by this option (can be specified multiple times).
'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Devops","item":"https://cdecl.github.io/devops/"},{"@type":"ListItem","position":2,"name":"Restic Basic","item":"https://cdecl.github.io/devops/restic-basic/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Restic Basic","name":"Restic Basic","description":"Snapshots 기능을 제공하는 modern backup program\nrestic https://restic.net/{:target=\u0026quot;_blank\u0026quot;} Go로 만들어진 백업 프로그램, 크로스프랫폼 지원 - from Linux, BSD, Mac and Windows - to many different storage types, including self-hosted and online services - easily, being a single executable that you can run without a server or complex setup - effectively, only transferring the parts that actually changed in the files you back up - securely, by careful use of cryptography in every part of the process - verifiably, enabling you to make sure that your files can be restored when needed - freely - restic is entirely free to use and completely open source Install Package 설치 및 Binary 지원 Package : https://restic.readthedocs.io/en/stable/020_installation.html{:target=\u0026quot;_blank\u0026quot;} Binary : https://github.com/restic/restic/releases/tag/v0.12.1{:target=\u0026quot;_blank\u0026quot;} $ curl -LO https://github.com/restic/restic/releases/download/v0.12.1/restic_0.12.1_linux_amd64.bz2 # install bzip2 $ sudo yum install bzip2 -y $ bunzip2 restic_0.12.1_linux_amd64.bz2 $ mv restic_0.12.1_linux_amd64 restic $ sudo mv restic /usr/local/bin $ restic restic is a backup program which allows saving multiple revisions of files and directories in an encrypted repository stored on different backends. Usage: restic [command] Available Commands: backup Create a new backup of files and/or directories cache Operate on local cache directories cat Print internal objects to stdout check Check the repository for errors copy Copy snapshots from one repository to another diff Show differences between two snapshots dump Print a backed-up file to stdout find Find a file, a directory or restic IDs forget Remove snapshots from the repository generate Generate manual pages and auto-completion files (bash, fish, zsh) help Help about any command init Initialize a new repository key Manage keys (passwords) list List objects in the repository ls List files in a snapshot migrate Apply migrations mount Mount the repository prune Remove unneeded data from the repository rebuild-index Build a new index recover Recover data from the repository restore Extract the data from a snapshot self-update Update the restic binary snapshots List all snapshots stats Scan the repository and show basic statistics tag Modify tags on snapshots unlock Remove locks other processes created version Print version information .... Backup \u0026amp; Restore Backup Repository 생성 # Repository 접근을 위한 패드워스 필요, 일단 1111 # -r, --repo repository repository to backup to or restore from (default: $RESTIC_REPOSITORY) $ restic init -r repo enter password for new repository: enter password again: created restic repository 7f3cfb3e9a at repo Please note that knowledge of your password is required to access the repository. Losing your password means that your data is irrecoverably lost. # password 파일 생성, -p 옵션으로 지정 $ echo 1111 \u0026gt; passwd Backup : snapshots 생성 # Backup # restic -r \u0026lt;repository\u0026gt; -p \u0026lt;passwd file\u0026gt; backup \u0026lt;Source\u0026gt; # -p, --password-file file file to read the repository password from (default: $RESTIC_PASSWORD_FILE) $ restic -r repo -p passwd backup /home/cdecl/temp/mvcapp repository e4ccc49d opened successfully, password is correct no parent snapshot found, will read all files Files: 79 new, 0 changed, 0 unmodified Dirs: 40 new, 0 changed, 0 unmodified Added to the repo: 4.854 MiB processed 79 files, 4.811 MiB in 0:00 snapshot 9aff8447 saved # 파일생성 및 다시백업 $ touch /home/cdecl/temp/mvcapp/test.txt $ restic -r repo -p passwd backup /home/cdecl/temp/mvcapp repository e4ccc49d opened successfully, password is correct using parent snapshot 9aff8447 Files: 1 new, 0 changed, 79 unmodified Dirs: 0 new, 4 changed, 36 unmodified Added to the repo: 7.742 KiB processed 80 files, 4.811 MiB in 0:00 snapshot f4b94d9b saved Snapshots 확인 # snapshots 2개 화인 확인 $ restic -r repo -p passwd snapshots repository e4ccc49d opened successfully, password is correct ID Time Host Tags Paths ------------------------------------------------------------------------------ 9aff8447 2021-11-25 15:17:52 centos1 /home/cdecl/temp/mvcapp f4b94d9b 2021-11-25 15:22:24 centos1 /home/cdecl/temp/mvcapp ------------------------------------------------------------------------------ 2 snapshots Snapshots 비교 $ restic -r repo -p passwd diff 9aff8447 f4b94d9b repository e4ccc49d opened successfully, password is correct comparing snapshot 9aff8447 to f4b94d9b: + /home/cdecl/temp/mvcapp/test.txt Files: 1 new, 0 removed, 0 changed Dirs: 0 new, 0 removed Others: 0 new, 0 removed Data Blobs: 0 new, 0 removed Tree Blobs: 5 new, 5 removed Added: 7.742 KiB Removed: 7.456 KiB Restore : Snapshots 에서 복원 # restic -r \u0026lt;repository\u0026gt; -p \u0026lt;passwd file\u0026gt; restore \u0026lt;snapshots id\u0026gt; -t \u0026lt;Target\u0026gt; $ restic -r repo -p passwd restore 9aff8447 -t restore-mvcapp repository e4ccc49d opened successfully, password is correct restoring \u0026lt;Snapshot 9aff8447 of [/home/cdecl/temp/mvcapp] at 2021-11-25 15:17:52.115925352 +0900 KST by cdecl@centos1\u0026gt; to restore-mvcapp MinIO \u0026amp; RClone Backend 지원 https://restic.readthedocs.io/en/stable/030_preparing_a_new_repo.html{:target=\u0026quot;_blank\u0026quot;} Local, SFTP, REST Server, Amazon S3, Minio Server, Microsoft Azure Blob Storage, Google Cloud Storage, Other Services via rclone 등 지원 MinIO Repository 만들기 $ export AWS_ACCESS_KEY_ID=key $ export AWS_SECRET_ACCESS_KEY=passwd $ restic init -r s3:http://minio.server:9000/restic enter password for new repository: enter password again: created restic repository 65a27250da at s3:http://minio.server:9000/restic Please note that knowledge of your password is required to access the repository. Losing your password means that your data is irrecoverably lost. # Backup $ restic -r s3:http://minio.server:9000/restic -p passwd backup /home/cdecl/temp/mvcapp # snapshots $ restic -r s3:http://minio.server:9000/restic -p passwd snapshots repository 65a27250 opened successfully, password is correct ID Time Host Tags Paths ------------------------------------------------------------------------------ 73d37fbd 2021-11-25 15:37:34 centos1 /home/cdecl/temp/mvcapp ------------------------------------------------------------------------------ 1 snapshots RClone Backend 로 사용 $ rclone config show [infradb] type = s3 env_auth = false access_key_id = key secret_access_key = passwd region = us-east-1 endpoint = http://minio.server:9000 # rclone config 사용 respository 만들기 $ restic init -r rclone:infradb:restic enter password for new repository: enter password again: created restic repository ce850667c9 at rclone:infradb:restic Please note that knowledge of your password is required to access the repository. Losing your password means that your data is irrecoverably lost. # Backup $ restic -r rclone:infradb:restic -p passwd backup /home/cdecl/temp/mvcapp # snapshots $ restic -r rclone:infradb:restic -p passwd snapshots Snapshots 관리 https://restic.readthedocs.io/en/stable/060_forget.html{:target=\u0026quot;_blank\u0026quot;} $ restic -r rclone:infradb:restic -p passwd snapshots repository ce850667 opened successfully, password is correct ID Time Host Tags Paths ------------------------------------------------------------------------------ a3737738 2021-11-25 15:44:05 centos1 /home/cdecl/temp/mvcapp 00f16d70 2021-11-25 15:44:50 centos1 /home/cdecl/temp/mvcapp 0e83568a 2021-11-25 15:44:51 centos1 /home/cdecl/temp/mvcapp 4041e3ca 2021-11-25 15:44:53 centos1 /home/cdecl/temp/mvcapp eb1e56c7 2021-11-25 15:44:54 centos1 /home/cdecl/temp/mvcapp d81b3d2a 2021-11-25 15:44:55 centos1 /home/cdecl/temp/mvcapp ------------------------------------------------------------------------------ 6 snapshots # snapshots 1개 지우기 $ restic -r rclone:infradb:restic -p passwd forget d81b3d2a repository ce850667 opened successfully, password is correct [0:00] 100.00% 1 / 1 files deleted # 스냅샷의 파일에서 참조한 데이터는 여전히 저장소에 저장 # 참조되지 않은 데이터를 정리하려면 prune 명령 실행 $ restic -r rclone:infradb:restic -p passwd prune repository ce850667 opened successfully, password is correct loading indexes... loading all snapshots... finding data that is still in use for 5 snapshots [0:00] 100.00% 5 / 5 snapshots searching used packs... collecting packs for deletion and repacking [0:00] 100.00% 9 / 9 packs processed to repack: 0 blobs / 0 B this removes 0 blobs / 0 B to delete: 2 blobs / 1004 B total prune: 2 blobs / 1004 B remaining: 125 blobs / 4.862 MiB unused size after prune: 0 B (0.00% of remaining size) rebuilding index [0:00] 100.00% 8 / 8 packs processed deleting obsolete index files [0:00] 100.00% 6 / 6 files deleted removing 1 old packs [0:00] 100.00% 1 / 1 files deleted done # 최근 1개만 놔두고 snapshots 삭제 및 prune $ restic -r rclone:infradb:restic -p passwd forget --keep-last 1 --prune repository ce850667 opened successfully, password is correct Applying Policy: keep 1 latest snapshots keep 1 snapshots: ID Time Host Tags Reasons Paths --------------------------------------------------------------------------------------------- eb1e56c7 2021-11-25 15:44:54 centos1 last snapshot /home/cdecl/temp/mvcapp --------------------------------------------------------------------------------------------- 1 snapshots remove 4 snapshots: ID Time Host Tags Paths ------------------------------------------------------------------------------ a3737738 2021-11-25 15:44:05 centos1 /home/cdecl/temp/mvcapp 00f16d70 2021-11-25 15:44:50 centos1 /home/cdecl/temp/mvcapp 0e83568a 2021-11-25 15:44:51 centos1 /home/cdecl/temp/mvcapp 4041e3ca 2021-11-25 15:44:53 centos1 /home/cdecl/temp/mvcapp ------------------------------------------------------------------------------ 4 snapshots [0:00] 100.00% 4 / 4 files deleted 4 snapshots have been removed, running prune loading indexes... loading all snapshots... finding data that is still in use for 1 snapshots [0:00] 100.00% 1 / 1 snapshots searching used packs... collecting packs for deletion and repacking [0:00] 100.00% 8 / 8 packs processed to repack: 39 blobs / 47.305 KiB this removes 2 blobs / 1007 B to delete: 6 blobs / 2.950 KiB total prune: 8 blobs / 3.934 KiB remaining: 117 blobs / 4.858 MiB unused size after prune: 0 B (0.00% of remaining size) repacking packs [0:00] 100.00% 2 / 2 packs repacked rebuilding index [0:00] 100.00% 5 / 5 packs processed deleting obsolete index files [0:00] 100.00% 1 / 1 files deleted removing 5 old packs [0:00] 100.00% 5 / 5 files deleted done # snapshots 확인 $ restic -r rclone:infradb:restic -p passwd snapshots repository ce850667 opened successfully, password is correct ID Time Host Tags Paths ------------------------------------------------------------------------------ eb1e56c7 2021-11-25 15:44:54 centos1 /home/cdecl/temp/mvcapp ------------------------------------------------------------------------------ 1 snapshots forget 주요 인수 --keep-last n never delete the n last (most recent) snapshots --keep-hourly n for the last n hours in which a snapshot was made, keep only the last snapshot for each hour. --keep-daily n for the last n days which have one or more snapshots, only keep the last one for that day. --keep-weekly n for the last n weeks which have one or more snapshots, only keep the last one for that week. --keep-monthly n for the last n months which have one or more snapshots, only keep the last one for that month. --keep-yearly n for the last n years which have one or more snapshots, only keep the last one for that year. --keep-tag keep all snapshots which have all tags specified by this option (can be specified multiple times). ","keywords":["restic","snapshot backup","minio","rclone"],"articleBody":"Snapshots 기능을 제공하는 modern backup program\nrestic https://restic.net/{:target=\"_blank\"} Go로 만들어진 백업 프로그램, 크로스프랫폼 지원 - from Linux, BSD, Mac and Windows - to many different storage types, including self-hosted and online services - easily, being a single executable that you can run without a server or complex setup - effectively, only transferring the parts that actually changed in the files you back up - securely, by careful use of cryptography in every part of the process - verifiably, enabling you to make sure that your files can be restored when needed - freely - restic is entirely free to use and completely open source Install Package 설치 및 Binary 지원 Package : https://restic.readthedocs.io/en/stable/020_installation.html{:target=\"_blank\"} Binary : https://github.com/restic/restic/releases/tag/v0.12.1{:target=\"_blank\"} $ curl -LO https://github.com/restic/restic/releases/download/v0.12.1/restic_0.12.1_linux_amd64.bz2 # install bzip2 $ sudo yum install bzip2 -y $ bunzip2 restic_0.12.1_linux_amd64.bz2 $ mv restic_0.12.1_linux_amd64 restic $ sudo mv restic /usr/local/bin $ restic restic is a backup program which allows saving multiple revisions of files and directories in an encrypted repository stored on different backends. Usage: restic [command] Available Commands: backup Create a new backup of files and/or directories cache Operate on local cache directories cat Print internal objects to stdout check Check the repository for errors copy Copy snapshots from one repository to another diff Show differences between two snapshots dump Print a backed-up file to stdout find Find a file, a directory or restic IDs forget Remove snapshots from the repository generate Generate manual pages and auto-completion files (bash, fish, zsh) help Help about any command init Initialize a new repository key Manage keys (passwords) list List objects in the repository ls List files in a snapshot migrate Apply migrations mount Mount the repository prune Remove unneeded data from the repository rebuild-index Build a new index recover Recover data from the repository restore Extract the data from a snapshot self-update Update the restic binary snapshots List all snapshots stats Scan the repository and show basic statistics tag Modify tags on snapshots unlock Remove locks other processes created version Print version information .... Backup \u0026 Restore Backup Repository 생성 # Repository 접근을 위한 패드워스 필요, 일단 1111 # -r, --repo repository repository to backup to or restore from (default: $RESTIC_REPOSITORY) $ restic init -r repo enter password for new repository: enter password again: created restic repository 7f3cfb3e9a at repo Please note that knowledge of your password is required to access the repository. Losing your password means that your data is irrecoverably lost. # password 파일 생성, -p 옵션으로 지정 $ echo 1111 \u003e passwd Backup : snapshots 생성 # Backup # restic -r -p backup # -p, --password-file file file to read the repository password from (default: $RESTIC_PASSWORD_FILE) $ restic -r repo -p passwd backup /home/cdecl/temp/mvcapp repository e4ccc49d opened successfully, password is correct no parent snapshot found, will read all files Files: 79 new, 0 changed, 0 unmodified Dirs: 40 new, 0 changed, 0 unmodified Added to the repo: 4.854 MiB processed 79 files, 4.811 MiB in 0:00 snapshot 9aff8447 saved # 파일생성 및 다시백업 $ touch /home/cdecl/temp/mvcapp/test.txt $ restic -r repo -p passwd backup /home/cdecl/temp/mvcapp repository e4ccc49d opened successfully, password is correct using parent snapshot 9aff8447 Files: 1 new, 0 changed, 79 unmodified Dirs: 0 new, 4 changed, 36 unmodified Added to the repo: 7.742 KiB processed 80 files, 4.811 MiB in 0:00 snapshot f4b94d9b saved Snapshots 확인 # snapshots 2개 화인 확인 $ restic -r repo -p passwd snapshots repository e4ccc49d opened successfully, password is correct ID Time Host Tags Paths ------------------------------------------------------------------------------ 9aff8447 2021-11-25 15:17:52 centos1 /home/cdecl/temp/mvcapp f4b94d9b 2021-11-25 15:22:24 centos1 /home/cdecl/temp/mvcapp ------------------------------------------------------------------------------ 2 snapshots Snapshots 비교 $ restic -r repo -p passwd diff 9aff8447 f4b94d9b repository e4ccc49d opened successfully, password is correct comparing snapshot 9aff8447 to f4b94d9b: + /home/cdecl/temp/mvcapp/test.txt Files: 1 new, 0 removed, 0 changed Dirs: 0 new, 0 removed Others: 0 new, 0 removed Data Blobs: 0 new, 0 removed Tree Blobs: 5 new, 5 removed Added: 7.742 KiB Removed: 7.456 KiB Restore : Snapshots 에서 복원 # restic -r -p restore -t $ restic -r repo -p passwd restore 9aff8447 -t restore-mvcapp repository e4ccc49d opened successfully, password is correct restoring ","wordCount":"1522","inLanguage":"en","datePublished":"2021-11-25T00:00:00+09:00","dateModified":"2021-11-25T00:00:00+09:00","author":{"@type":"Person","name":"Byung Kyu KIM"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://cdecl.github.io/devops/restic-basic/"},"publisher":{"@type":"Organization","name":"cdeclog","logo":{"@type":"ImageObject","url":"https://cdecl.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://cdecl.github.io/ accesskey=h title="cdeclog (Alt + H)">cdeclog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://cdecl.github.io/dev/ title=Dev><span>Dev</span></a></li><li><a href=https://cdecl.github.io/devops/ title=DevOps><span>DevOps</span></a></li><li><a href=https://cdecl.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://cdecl.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://cdecl.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Restic Basic</h1><div class=post-meta><span title='2021-11-25 00:00:00 +0900 KST'>November 25, 2021</span>&nbsp;·&nbsp;<span>Byung Kyu KIM</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#restic aria-label=restic>restic</a><ul><li><a href=#install aria-label=Install>Install</a></li><li><a href=#backup--restore aria-label="Backup & Restore">Backup & Restore</a><ul><ul><li><a href=#backup-repository-%ec%83%9d%ec%84%b1 aria-label="Backup Repository 생성">Backup Repository 생성</a></li><li><a href=#backup--snapshots-%ec%83%9d%ec%84%b1 aria-label="Backup : snapshots 생성">Backup : snapshots 생성</a></li><li><a href=#snapshots-%ed%99%95%ec%9d%b8 aria-label="Snapshots 확인">Snapshots 확인</a></li><li><a href=#restore--snapshots-%ec%97%90%ec%84%9c-%eb%b3%b5%ec%9b%90 aria-label="Restore : Snapshots 에서 복원">Restore : Snapshots 에서 복원</a></li></ul></ul></li><li><a href=#minio--rclone-backend-%ec%a7%80%ec%9b%90 aria-label="MinIO & RClone Backend 지원">MinIO & RClone Backend 지원</a><ul><ul><li><a href=#minio-repository-%eb%a7%8c%eb%93%a4%ea%b8%b0 aria-label="MinIO Repository 만들기">MinIO Repository 만들기</a></li><li><a href=#rclone-backend-%eb%a1%9c-%ec%82%ac%ec%9a%a9 aria-label="RClone Backend 로 사용">RClone Backend 로 사용</a></li></ul><li><a href=#snapshots-%ea%b4%80%eb%a6%ac aria-label="Snapshots 관리">Snapshots 관리</a></li></ul></li></ul></li></ul></div></details></div><div class=post-content><p>Snapshots 기능을 제공하는 modern backup program</p><h2 id=restic>restic<a hidden class=anchor aria-hidden=true href=#restic>#</a></h2><ul><li><a href=https://restic.net/>https://restic.net/</a>{:target="_blank"}</li><li>Go로 만들어진 백업 프로그램, 크로스프랫폼 지원</li></ul><pre tabindex=0><code>- from Linux, BSD, Mac and Windows
- to many different storage types, including self-hosted and online services
- easily, being a single executable that you can run without a server or complex setup
- effectively, only transferring the parts that actually changed in the files you back up
- securely, by careful use of cryptography in every part of the process
- verifiably, enabling you to make sure that your files can be restored when needed
- freely - restic is entirely free to use and completely open source
</code></pre><h3 id=install>Install<a hidden class=anchor aria-hidden=true href=#install>#</a></h3><ul><li>Package 설치 및 Binary 지원<ul><li>Package : <a href=https://restic.readthedocs.io/en/stable/020_installation.html>https://restic.readthedocs.io/en/stable/020_installation.html</a>{:target="_blank"}</li><li>Binary : <a href=https://github.com/restic/restic/releases/tag/v0.12.1>https://github.com/restic/restic/releases/tag/v0.12.1</a>{:target="_blank"}</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ curl -LO https://github.com/restic/restic/releases/download/v0.12.1/restic_0.12.1_linux_amd64.bz2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># install bzip2</span>
</span></span><span style=display:flex><span>$ sudo yum install bzip2 -y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ bunzip2 restic_0.12.1_linux_amd64.bz2
</span></span><span style=display:flex><span>$ mv restic_0.12.1_linux_amd64 restic
</span></span><span style=display:flex><span>$ sudo mv restic /usr/local/bin
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ restic
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>restic is a backup program which allows saving multiple revisions of files and
</span></span><span style=display:flex><span>directories in an encrypted repository stored on different backends.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Usage:
</span></span><span style=display:flex><span>  restic <span style=color:#f92672>[</span>command<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Available Commands:
</span></span><span style=display:flex><span>  backup        Create a new backup of files and/or directories
</span></span><span style=display:flex><span>  cache         Operate on local cache directories
</span></span><span style=display:flex><span>  cat           Print internal objects to stdout
</span></span><span style=display:flex><span>  check         Check the repository <span style=color:#66d9ef>for</span> errors
</span></span><span style=display:flex><span>  copy          Copy snapshots from one repository to another
</span></span><span style=display:flex><span>  diff          Show differences between two snapshots
</span></span><span style=display:flex><span>  dump          Print a backed-up file to stdout
</span></span><span style=display:flex><span>  find          Find a file, a directory or restic IDs
</span></span><span style=display:flex><span>  forget        Remove snapshots from the repository
</span></span><span style=display:flex><span>  generate      Generate manual pages and auto-completion files <span style=color:#f92672>(</span>bash, fish, zsh<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  help          Help about any command
</span></span><span style=display:flex><span>  init          Initialize a new repository
</span></span><span style=display:flex><span>  key           Manage keys <span style=color:#f92672>(</span>passwords<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  list          List objects in the repository
</span></span><span style=display:flex><span>  ls            List files in a snapshot
</span></span><span style=display:flex><span>  migrate       Apply migrations
</span></span><span style=display:flex><span>  mount         Mount the repository
</span></span><span style=display:flex><span>  prune         Remove unneeded data from the repository
</span></span><span style=display:flex><span>  rebuild-index Build a new index
</span></span><span style=display:flex><span>  recover       Recover data from the repository
</span></span><span style=display:flex><span>  restore       Extract the data from a snapshot
</span></span><span style=display:flex><span>  self-update   Update the restic binary
</span></span><span style=display:flex><span>  snapshots     List all snapshots
</span></span><span style=display:flex><span>  stats         Scan the repository and show basic statistics
</span></span><span style=display:flex><span>  tag           Modify tags on snapshots
</span></span><span style=display:flex><span>  unlock        Remove locks other processes created
</span></span><span style=display:flex><span>  version       Print version information
</span></span><span style=display:flex><span>....
</span></span></code></pre></div><hr><h3 id=backup--restore>Backup & Restore<a hidden class=anchor aria-hidden=true href=#backup--restore>#</a></h3><h5 id=backup-repository-생성>Backup Repository 생성<a hidden class=anchor aria-hidden=true href=#backup-repository-생성>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># Repository 접근을 위한 패드워스 필요, 일단 1111</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -r, --repo repository repository to backup to or restore from (default: $RESTIC_REPOSITORY)</span>
</span></span><span style=display:flex><span>$ restic init -r repo
</span></span><span style=display:flex><span>enter password <span style=color:#66d9ef>for</span> new repository:
</span></span><span style=display:flex><span>enter password again:
</span></span><span style=display:flex><span>created restic repository 7f3cfb3e9a at repo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Please note that knowledge of your password is required to access
</span></span><span style=display:flex><span>the repository. Losing your password means that your data is
</span></span><span style=display:flex><span>irrecoverably lost.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># password 파일 생성, -p 옵션으로 지정 </span>
</span></span><span style=display:flex><span>$ echo <span style=color:#ae81ff>1111</span> &gt; passwd
</span></span></code></pre></div><h5 id=backup--snapshots-생성>Backup : snapshots 생성<a hidden class=anchor aria-hidden=true href=#backup--snapshots-생성>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># Backup </span>
</span></span><span style=display:flex><span><span style=color:#75715e># restic -r &lt;repository&gt; -p &lt;passwd file&gt; backup &lt;Source&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -p, --password-file file  file to read the repository password from (default: $RESTIC_PASSWORD_FILE)</span>
</span></span><span style=display:flex><span>$ restic -r repo -p passwd backup /home/cdecl/temp/mvcapp
</span></span><span style=display:flex><span>repository e4ccc49d opened successfully, password is correct
</span></span><span style=display:flex><span>no parent snapshot found, will read all files
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Files:          <span style=color:#ae81ff>79</span> new,     <span style=color:#ae81ff>0</span> changed,     <span style=color:#ae81ff>0</span> unmodified
</span></span><span style=display:flex><span>Dirs:           <span style=color:#ae81ff>40</span> new,     <span style=color:#ae81ff>0</span> changed,     <span style=color:#ae81ff>0</span> unmodified
</span></span><span style=display:flex><span>Added to the repo: 4.854 MiB
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>processed <span style=color:#ae81ff>79</span> files, 4.811 MiB in 0:00
</span></span><span style=display:flex><span>snapshot 9aff8447 saved
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 파일생성 및 다시백업 </span>
</span></span><span style=display:flex><span>$ touch /home/cdecl/temp/mvcapp/test.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ restic -r repo -p passwd backup /home/cdecl/temp/mvcapp
</span></span><span style=display:flex><span>repository e4ccc49d opened successfully, password is correct
</span></span><span style=display:flex><span>using parent snapshot 9aff8447
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Files:           <span style=color:#ae81ff>1</span> new,     <span style=color:#ae81ff>0</span> changed,    <span style=color:#ae81ff>79</span> unmodified
</span></span><span style=display:flex><span>Dirs:            <span style=color:#ae81ff>0</span> new,     <span style=color:#ae81ff>4</span> changed,    <span style=color:#ae81ff>36</span> unmodified
</span></span><span style=display:flex><span>Added to the repo: 7.742 KiB
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>processed <span style=color:#ae81ff>80</span> files, 4.811 MiB in 0:00
</span></span><span style=display:flex><span>snapshot f4b94d9b saved
</span></span></code></pre></div><h5 id=snapshots-확인>Snapshots 확인<a hidden class=anchor aria-hidden=true href=#snapshots-확인>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># snapshots 2개 화인 확인</span>
</span></span><span style=display:flex><span>$ restic -r repo -p passwd snapshots
</span></span><span style=display:flex><span>repository e4ccc49d opened successfully, password is correct
</span></span><span style=display:flex><span>ID        Time                 Host        Tags        Paths
</span></span><span style=display:flex><span>------------------------------------------------------------------------------
</span></span><span style=display:flex><span>9aff8447  2021-11-25 15:17:52  centos1                 /home/cdecl/temp/mvcapp
</span></span><span style=display:flex><span>f4b94d9b  2021-11-25 15:22:24  centos1                 /home/cdecl/temp/mvcapp
</span></span><span style=display:flex><span>------------------------------------------------------------------------------
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span> snapshots
</span></span></code></pre></div><ul><li>Snapshots 비교</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ restic -r repo -p passwd diff 9aff8447 f4b94d9b
</span></span><span style=display:flex><span>repository e4ccc49d opened successfully, password is correct
</span></span><span style=display:flex><span>comparing snapshot 9aff8447 to f4b94d9b:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>+    /home/cdecl/temp/mvcapp/test.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Files:           <span style=color:#ae81ff>1</span> new,     <span style=color:#ae81ff>0</span> removed,     <span style=color:#ae81ff>0</span> changed
</span></span><span style=display:flex><span>Dirs:            <span style=color:#ae81ff>0</span> new,     <span style=color:#ae81ff>0</span> removed
</span></span><span style=display:flex><span>Others:          <span style=color:#ae81ff>0</span> new,     <span style=color:#ae81ff>0</span> removed
</span></span><span style=display:flex><span>Data Blobs:      <span style=color:#ae81ff>0</span> new,     <span style=color:#ae81ff>0</span> removed
</span></span><span style=display:flex><span>Tree Blobs:      <span style=color:#ae81ff>5</span> new,     <span style=color:#ae81ff>5</span> removed
</span></span><span style=display:flex><span>  Added:   7.742 KiB
</span></span><span style=display:flex><span>  Removed: 7.456 KiB
</span></span></code></pre></div><h5 id=restore--snapshots-에서-복원>Restore : Snapshots 에서 복원<a hidden class=anchor aria-hidden=true href=#restore--snapshots-에서-복원>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># restic -r &lt;repository&gt; -p &lt;passwd file&gt; restore &lt;snapshots id&gt; -t &lt;Target&gt;</span>
</span></span><span style=display:flex><span>$ restic -r repo -p passwd restore 9aff8447 -t restore-mvcapp
</span></span><span style=display:flex><span>repository e4ccc49d opened successfully, password is correct
</span></span><span style=display:flex><span>restoring &lt;Snapshot 9aff8447 of <span style=color:#f92672>[</span>/home/cdecl/temp/mvcapp<span style=color:#f92672>]</span> at 2021-11-25 15:17:52.115925352 
</span></span><span style=display:flex><span> +0900 KST by cdecl@centos1&gt; to restore-mvcapp
</span></span></code></pre></div><h3 id=minio--rclone-backend-지원>MinIO & RClone Backend 지원<a hidden class=anchor aria-hidden=true href=#minio--rclone-backend-지원>#</a></h3><ul><li><a href=https://restic.readthedocs.io/en/stable/030_preparing_a_new_repo.html>https://restic.readthedocs.io/en/stable/030_preparing_a_new_repo.html</a>{:target="_blank"}</li></ul><pre tabindex=0><code>Local, SFTP, REST Server, Amazon S3, Minio Server, Microsoft Azure Blob Storage, 
Google Cloud Storage, Other Services via rclone 등 지원
</code></pre><h5 id=minio-repository-만들기>MinIO Repository 만들기<a hidden class=anchor aria-hidden=true href=#minio-repository-만들기>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ export AWS_ACCESS_KEY_ID<span style=color:#f92672>=</span>key
</span></span><span style=display:flex><span>$ export AWS_SECRET_ACCESS_KEY<span style=color:#f92672>=</span>passwd
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$  restic init -r s3:http://minio.server:9000/restic
</span></span><span style=display:flex><span>enter password <span style=color:#66d9ef>for</span> new repository:
</span></span><span style=display:flex><span>enter password again:
</span></span><span style=display:flex><span>created restic repository 65a27250da at s3:http://minio.server:9000/restic
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Please note that knowledge of your password is required to access
</span></span><span style=display:flex><span>the repository. Losing your password means that your data is
</span></span><span style=display:flex><span>irrecoverably lost.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Backup</span>
</span></span><span style=display:flex><span>$ restic -r s3:http://minio.server:9000/restic -p passwd backup /home/cdecl/temp/mvcapp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># snapshots</span>
</span></span><span style=display:flex><span>$ restic -r s3:http://minio.server:9000/restic -p passwd snapshots
</span></span><span style=display:flex><span>repository 65a27250 opened successfully, password is correct
</span></span><span style=display:flex><span>ID        Time                 Host        Tags        Paths
</span></span><span style=display:flex><span>------------------------------------------------------------------------------
</span></span><span style=display:flex><span>73d37fbd  2021-11-25 15:37:34  centos1                 /home/cdecl/temp/mvcapp
</span></span><span style=display:flex><span>------------------------------------------------------------------------------
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> snapshots
</span></span></code></pre></div><h5 id=rclone-backend-로-사용>RClone Backend 로 사용<a hidden class=anchor aria-hidden=true href=#rclone-backend-로-사용>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ rclone config show
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>infradb<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>type <span style=color:#f92672>=</span> s3
</span></span><span style=display:flex><span>env_auth <span style=color:#f92672>=</span> false
</span></span><span style=display:flex><span>access_key_id <span style=color:#f92672>=</span> key
</span></span><span style=display:flex><span>secret_access_key <span style=color:#f92672>=</span> passwd
</span></span><span style=display:flex><span>region <span style=color:#f92672>=</span> us-east-1
</span></span><span style=display:flex><span>endpoint <span style=color:#f92672>=</span> http://minio.server:9000
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># rclone config 사용 respository 만들기 </span>
</span></span><span style=display:flex><span>$ restic init -r rclone:infradb:restic
</span></span><span style=display:flex><span>enter password <span style=color:#66d9ef>for</span> new repository:
</span></span><span style=display:flex><span>enter password again:
</span></span><span style=display:flex><span>created restic repository ce850667c9 at rclone:infradb:restic
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Please note that knowledge of your password is required to access
</span></span><span style=display:flex><span>the repository. Losing your password means that your data is
</span></span><span style=display:flex><span>irrecoverably lost.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Backup</span>
</span></span><span style=display:flex><span>$ restic -r rclone:infradb:restic -p passwd backup /home/cdecl/temp/mvcapp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># snapshots</span>
</span></span><span style=display:flex><span>$ restic -r rclone:infradb:restic -p passwd snapshots
</span></span></code></pre></div><hr><h4 id=snapshots-관리>Snapshots 관리<a hidden class=anchor aria-hidden=true href=#snapshots-관리>#</a></h4><ul><li><a href=https://restic.readthedocs.io/en/stable/060_forget.html>https://restic.readthedocs.io/en/stable/060_forget.html</a>{:target="_blank"}</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ restic -r rclone:infradb:restic -p passwd snapshots
</span></span><span style=display:flex><span>repository ce850667 opened successfully, password is correct
</span></span><span style=display:flex><span>ID        Time                 Host        Tags        Paths
</span></span><span style=display:flex><span>------------------------------------------------------------------------------
</span></span><span style=display:flex><span>a3737738  2021-11-25 15:44:05  centos1                 /home/cdecl/temp/mvcapp
</span></span><span style=display:flex><span>00f16d70  2021-11-25 15:44:50  centos1                 /home/cdecl/temp/mvcapp
</span></span><span style=display:flex><span>0e83568a  2021-11-25 15:44:51  centos1                 /home/cdecl/temp/mvcapp
</span></span><span style=display:flex><span>4041e3ca  2021-11-25 15:44:53  centos1                 /home/cdecl/temp/mvcapp
</span></span><span style=display:flex><span>eb1e56c7  2021-11-25 15:44:54  centos1                 /home/cdecl/temp/mvcapp
</span></span><span style=display:flex><span>d81b3d2a  2021-11-25 15:44:55  centos1                 /home/cdecl/temp/mvcapp
</span></span><span style=display:flex><span>------------------------------------------------------------------------------
</span></span><span style=display:flex><span><span style=color:#ae81ff>6</span> snapshots
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># snapshots 1개 지우기</span>
</span></span><span style=display:flex><span>$ restic -r rclone:infradb:restic -p passwd forget d81b3d2a
</span></span><span style=display:flex><span>repository ce850667 opened successfully, password is correct
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>0:00<span style=color:#f92672>]</span> 100.00%  <span style=color:#ae81ff>1</span> / <span style=color:#ae81ff>1</span> files deleted
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 스냅샷의 파일에서 참조한 데이터는 여전히 저장소에 저장</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 참조되지 않은 데이터를 정리하려면 prune 명령 실행</span>
</span></span><span style=display:flex><span>$ restic -r rclone:infradb:restic -p passwd prune
</span></span><span style=display:flex><span>repository ce850667 opened successfully, password is correct
</span></span><span style=display:flex><span>loading indexes...
</span></span><span style=display:flex><span>loading all snapshots...
</span></span><span style=display:flex><span>finding data that is still in use <span style=color:#66d9ef>for</span> <span style=color:#ae81ff>5</span> snapshots
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>0:00<span style=color:#f92672>]</span> 100.00%  <span style=color:#ae81ff>5</span> / <span style=color:#ae81ff>5</span> snapshots
</span></span><span style=display:flex><span>searching used packs...
</span></span><span style=display:flex><span>collecting packs <span style=color:#66d9ef>for</span> deletion and repacking
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>0:00<span style=color:#f92672>]</span> 100.00%  <span style=color:#ae81ff>9</span> / <span style=color:#ae81ff>9</span> packs processed
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>to repack:            <span style=color:#ae81ff>0</span> blobs / <span style=color:#ae81ff>0</span> B
</span></span><span style=display:flex><span>this removes          <span style=color:#ae81ff>0</span> blobs / <span style=color:#ae81ff>0</span> B
</span></span><span style=display:flex><span>to delete:            <span style=color:#ae81ff>2</span> blobs / <span style=color:#ae81ff>1004</span> B
</span></span><span style=display:flex><span>total prune:          <span style=color:#ae81ff>2</span> blobs / <span style=color:#ae81ff>1004</span> B
</span></span><span style=display:flex><span>remaining:          <span style=color:#ae81ff>125</span> blobs / 4.862 MiB
</span></span><span style=display:flex><span>unused size after prune: <span style=color:#ae81ff>0</span> B <span style=color:#f92672>(</span>0.00% of remaining size<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rebuilding index
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>0:00<span style=color:#f92672>]</span> 100.00%  <span style=color:#ae81ff>8</span> / <span style=color:#ae81ff>8</span> packs processed
</span></span><span style=display:flex><span>deleting obsolete index files
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>0:00<span style=color:#f92672>]</span> 100.00%  <span style=color:#ae81ff>6</span> / <span style=color:#ae81ff>6</span> files deleted
</span></span><span style=display:flex><span>removing <span style=color:#ae81ff>1</span> old packs
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>0:00<span style=color:#f92672>]</span> 100.00%  <span style=color:#ae81ff>1</span> / <span style=color:#ae81ff>1</span> files deleted
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 최근 1개만 놔두고 snapshots 삭제 및 prune</span>
</span></span><span style=display:flex><span>$ restic -r rclone:infradb:restic -p passwd forget --keep-last <span style=color:#ae81ff>1</span> --prune
</span></span><span style=display:flex><span>repository ce850667 opened successfully, password is correct
</span></span><span style=display:flex><span>Applying Policy: keep <span style=color:#ae81ff>1</span> latest snapshots
</span></span><span style=display:flex><span>keep <span style=color:#ae81ff>1</span> snapshots:
</span></span><span style=display:flex><span>ID        Time                 Host        Tags        Reasons        Paths
</span></span><span style=display:flex><span>---------------------------------------------------------------------------------------------
</span></span><span style=display:flex><span>eb1e56c7  2021-11-25 15:44:54  centos1                 last snapshot  /home/cdecl/temp/mvcapp
</span></span><span style=display:flex><span>---------------------------------------------------------------------------------------------
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> snapshots
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>remove <span style=color:#ae81ff>4</span> snapshots:
</span></span><span style=display:flex><span>ID        Time                 Host        Tags        Paths
</span></span><span style=display:flex><span>------------------------------------------------------------------------------
</span></span><span style=display:flex><span>a3737738  2021-11-25 15:44:05  centos1                 /home/cdecl/temp/mvcapp
</span></span><span style=display:flex><span>00f16d70  2021-11-25 15:44:50  centos1                 /home/cdecl/temp/mvcapp
</span></span><span style=display:flex><span>0e83568a  2021-11-25 15:44:51  centos1                 /home/cdecl/temp/mvcapp
</span></span><span style=display:flex><span>4041e3ca  2021-11-25 15:44:53  centos1                 /home/cdecl/temp/mvcapp
</span></span><span style=display:flex><span>------------------------------------------------------------------------------
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> snapshots
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>0:00<span style=color:#f92672>]</span> 100.00%  <span style=color:#ae81ff>4</span> / <span style=color:#ae81ff>4</span> files deleted
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> snapshots have been removed, running prune
</span></span><span style=display:flex><span>loading indexes...
</span></span><span style=display:flex><span>loading all snapshots...
</span></span><span style=display:flex><span>finding data that is still in use <span style=color:#66d9ef>for</span> <span style=color:#ae81ff>1</span> snapshots
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>0:00<span style=color:#f92672>]</span> 100.00%  <span style=color:#ae81ff>1</span> / <span style=color:#ae81ff>1</span> snapshots
</span></span><span style=display:flex><span>searching used packs...
</span></span><span style=display:flex><span>collecting packs <span style=color:#66d9ef>for</span> deletion and repacking
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>0:00<span style=color:#f92672>]</span> 100.00%  <span style=color:#ae81ff>8</span> / <span style=color:#ae81ff>8</span> packs processed
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>to repack:           <span style=color:#ae81ff>39</span> blobs / 47.305 KiB
</span></span><span style=display:flex><span>this removes          <span style=color:#ae81ff>2</span> blobs / <span style=color:#ae81ff>1007</span> B
</span></span><span style=display:flex><span>to delete:            <span style=color:#ae81ff>6</span> blobs / 2.950 KiB
</span></span><span style=display:flex><span>total prune:          <span style=color:#ae81ff>8</span> blobs / 3.934 KiB
</span></span><span style=display:flex><span>remaining:          <span style=color:#ae81ff>117</span> blobs / 4.858 MiB
</span></span><span style=display:flex><span>unused size after prune: <span style=color:#ae81ff>0</span> B <span style=color:#f92672>(</span>0.00% of remaining size<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>repacking packs
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>0:00<span style=color:#f92672>]</span> 100.00%  <span style=color:#ae81ff>2</span> / <span style=color:#ae81ff>2</span> packs repacked
</span></span><span style=display:flex><span>rebuilding index
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>0:00<span style=color:#f92672>]</span> 100.00%  <span style=color:#ae81ff>5</span> / <span style=color:#ae81ff>5</span> packs processed
</span></span><span style=display:flex><span>deleting obsolete index files
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>0:00<span style=color:#f92672>]</span> 100.00%  <span style=color:#ae81ff>1</span> / <span style=color:#ae81ff>1</span> files deleted
</span></span><span style=display:flex><span>removing <span style=color:#ae81ff>5</span> old packs
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>0:00<span style=color:#f92672>]</span> 100.00%  <span style=color:#ae81ff>5</span> / <span style=color:#ae81ff>5</span> files deleted
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># snapshots 확인</span>
</span></span><span style=display:flex><span>$ restic -r rclone:infradb:restic -p passwd snapshots
</span></span><span style=display:flex><span>repository ce850667 opened successfully, password is correct
</span></span><span style=display:flex><span>ID        Time                 Host        Tags        Paths
</span></span><span style=display:flex><span>------------------------------------------------------------------------------
</span></span><span style=display:flex><span>eb1e56c7  2021-11-25 15:44:54  centos1                 /home/cdecl/temp/mvcapp
</span></span><span style=display:flex><span>------------------------------------------------------------------------------
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> snapshots
</span></span></code></pre></div><ul><li>forget 주요 인수</li></ul><pre tabindex=0><code>--keep-last n never delete the n last (most recent) snapshots
--keep-hourly n for the last n hours in which a snapshot was made, keep only the last snapshot for each hour.
--keep-daily n for the last n days which have one or more snapshots, only keep the last one for that day.
--keep-weekly n for the last n weeks which have one or more snapshots, only keep the last one for that week.
--keep-monthly n for the last n months which have one or more snapshots, only keep the last one for that month.
--keep-yearly n for the last n years which have one or more snapshots, only keep the last one for that year.
--keep-tag keep all snapshots which have all tags specified by this option (can be specified multiple times).
</code></pre></div><footer class=post-footer><ul class=post-tags><li><a href=https://cdecl.github.io/tags/restic/>Restic</a></li><li><a href=https://cdecl.github.io/tags/snapshot-backup/>Snapshot Backup</a></li><li><a href=https://cdecl.github.io/tags/minio/>Minio</a></li><li><a href=https://cdecl.github.io/tags/rclone/>Rclone</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://cdecl.github.io/>cdeclog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>