<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Helm chart 생성, 배포 | cdeclog</title><meta name=keywords content="helm,kubernetes,k8s,docker,k3s"><meta name=description content='Kubernetes 패키지 매니저 도구인 helm을 통해 chart 생성 및 Kubernetes 배포

K3S 환경에서 테스트

Helm

https://helm.sh/{:target="_blank"}
Kubernetes 배포를 위한 패키지 매니저 툴 (e.g yum, choco)
chart 라는 yaml 파일 기반의 템플릿 파일을 통해 패키지화 및 Kubernetes 설치 관리

Deployment, Service, Ingress 등 Kubernetes 서비스의 manifest 생성 및 설치


Helm Repository 를 통해 패키지 등록 및 다른 패키지 설치 가능


Helm Install

바이너리 직접 설치 및 설치 Script 활용
Homebrew, Chocolatey 등의 패키지로도 설치 가능

바이너리 다운로드

https://github.com/helm/helm/releases

$ curl -LO https://get.helm.sh/helm-v3.7.1-linux-amd64.tar.gz
$ tar -zxvf helm-v3.7.1-linux-amd64.tar.gz

$ tree linux-amd64
linux-amd64
├── LICENSE
├── README.md
└── helm

$ sudo cp linux-amd64/helm /usr/local/bin/
설치 Script 활용

$ chmod 700 get_helm.sh
$ ./get_helm.sh

Creating Your Own Charts

kubernetes 설치를 위한 chart 생성 및 세팅
https://helm.sh/docs/helm/helm_create/{:target="_blank"}

# chart 생성
$ helm create mvcapp
Creating mvcapp
Chart directory 구조

Chart.yaml : Chart 버전, 이미지버전, 설명등을 기술하는 파일
values.yaml : manifest template 파일 기반, 기준 값을 세팅하는 파일
templates/ : kubernetes manifest template 파일
charts/  : chart 의존성 파일

$ tree mvcapp
mvcapp
├── Chart.yaml
├── charts
├── templates
│   ├── NOTES.txt
│   ├── _helpers.tpl
│   ├── deployment.yaml
│   ├── hpa.yaml
│   ├── ingress.yaml
│   ├── service.yaml
│   ├── serviceaccount.yaml
│   └── tests
│       └── test-connection.yaml
└── values.yaml
Chart.yaml 수정

version : Chart 버전
appVersion : Deploy 되는 image 버전

apiVersion: v2
name: mvcapp
description: .net core test mvc application
# ... 생략
type: application
# ... 생략
version: 0.1.0
# ... 생략
appVersion: "0.6"  # appVersion: "1.16.0"
values.yaml 수정

replicaCount : Pod 의 replica 개수, 2개로 수정
image.repository : docker image 이름, cdecl/mvcapp 로 수정
service.type : On-Premise에서 테스트 목적, NodePort로 수정
service.nodePort : nodePort를 적용하기 위해 신규 추가

# Default values for mvcapp.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 2

image:
  repository: cdecl/mvcapp
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# ... 생략

service:
  type: NodePort   # ClusterIP
  port: 80
  nodePort: 30010

ingress:

# ... 생략

resources: {}
  # We usually recommend not to specify default resources and to leave this as a conscious
  # choice for the user. This also increases chances charts run on environments with little
  # resources, such as Minikube. If you do want to specify resources, uncomment the following
  # lines, adjust them as necessary, and remove the curly braces after &#39;resources:&#39;.
  # limits:
  #   cpu: 100m
  #   memory: 128Mi
  # requests:
  #   cpu: 100m
  #   memory: 128Mi

# ... 생략
templates/service.yaml 수정

nodePort 를 적용하기 위해 template 수정
spec.ports.nodePort: {{ .Values.service.nodePort }} 추가

apiVersion: v1
kind: Service
metadata:
  name: {{ include "mvcapp.fullname" . }}
  labels:
    {{- include "mvcapp.labels" . | nindent 4 }}
spec:
  type: {{ .Values.service.type }}
  ports:
    - port: {{ .Values.service.port }}
      targetPort: http
      pro
      name: http
      nodePort: {{ .Values.service.nodePort }}
  selector:
    {{- include "mvcapp.selectorLabels" . | nindent 4 }}
helm lint : chart 파일 검사

https://helm.sh/docs/helm/helm_lint/{:target="_blank"}

$ helm lint mvcapp
==> Linting mvcapp
[INFO] Chart.yaml: icon is recommended

1 chart(s) linted, 0 chart(s) failed
helm template : kubernetes manifest 생성

https://helm.sh/docs/helm/helm_template/{:target="_blank"}
values.yaml 에 세팅한 기준으로 manifest 생성

$ helm template mvcapp
---
# Source: mvcapp/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: RELEASE-NAME-mvcapp
  labels:
    helm.sh/chart: mvcapp-0.1.0
    app.kubernetes.io/name: mvcapp
    app.kubernetes.io/instance: RELEASE-NAME
    app.kubernetes.io/version: "0.6"
    app.kubernetes.io/managed-by: Helm
---
# Source: mvcapp/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: RELEASE-NAME-mvcapp
  labels:
    helm.sh/chart: mvcapp-0.1.0
    app.kubernetes.io/name: mvcapp
    app.kubernetes.io/instance: RELEASE-NAME
    app.kubernetes.io/version: "0.6"
    app.kubernetes.io/managed-by: Helm
spec:
  type: NodePort
  ports:
    - port: 80
      targetPort: http
      pro
      name: http
  selector:
    app.kubernetes.io/name: mvcapp
    app.kubernetes.io/instance: RELEASE-NAME
---
# Source: mvcapp/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: RELEASE-NAME-mvcapp
  labels:
    helm.sh/chart: mvcapp-0.1.0
    app.kubernetes.io/name: mvcapp
    app.kubernetes.io/instance: RELEASE-NAME
    app.kubernetes.io/version: "0.6"
    app.kubernetes.io/managed-by: Helm
spec:
  replicas: 2
  selector:
    matchLabels:
      app.kubernetes.io/name: mvcapp
      app.kubernetes.io/instance: RELEASE-NAME
  template:
    metadata:
      labels:
        app.kubernetes.io/name: mvcapp
        app.kubernetes.io/instance: RELEASE-NAME
    spec:
      serviceAccountName: RELEASE-NAME-mvcapp
      securityContext:
        {}
      containers:
        - name: mvcapp
          securityContext:
            {}
          image: "cdecl/mvcapp:0.6"
          imagePullPolicy: IfNotPresent
          ports:
            - name: http
              containerPort: 80
              pro
          livenessProbe:
            httpGet:
              path: /
              port: http
          readinessProbe:
            httpGet:
              path: /
              port: http
          resources:
            {}
---
# Source: mvcapp/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "RELEASE-NAME-mvcapp-test-connection"
  labels:
    helm.sh/chart: mvcapp-0.1.0
    app.kubernetes.io/name: mvcapp
    app.kubernetes.io/instance: RELEASE-NAME
    app.kubernetes.io/version: "0.6"
    app.kubernetes.io/managed-by: Helm
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: [&#39;wget&#39;]
      args: [&#39;RELEASE-NAME-mvcapp:80&#39;]
  restartPolicy: Never
helm install : chart 활용 kubernetes service install

https://helm.sh/docs/helm/helm_install/{:target="_blank"}
install : helm install [NAME] [CHART] [flags]

# 설치하지는 않고 테스트 
$ helm install mvcapp-svc mvcapp --dry-run

# 로컬 Chart 를 통한 설치 
$ helm install mvcapp-svc mvcapp
NAME: mvcapp-svc
LAST DEPLOYED: Thu Nov  4 13:29:38 2021
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export NODE_PORT=$(kubectl get --namespace default -o jsonpath="{.spec.ports[0].nodePort}" services mvcapp-svc)
  export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath="{.items[0].status.addresses[0].address}")
  echo http://$NODE_IP:$NODE_PORT

$ kubectl get svc
NAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
kubernetes   ClusterIP   10.43.0.1       <none>        443/TCP        78d
mvcapp-svc   NodePort    10.43.202.254   <none>        80:31503/TCP   29s

$ kubectl get pod
NAME                          READY   STATUS    RESTARTS   AGE
mvcapp-svc-78ff4d97f9-hd9rf   1/1     Running   0          37s
mvcapp-svc-78ff4d97f9-x4984   1/1     Running   0          37s

KS3 export KUBECONFIG=/etc/rancher/k3s/k3s.yaml 세팅'><meta name=author content="Byung Kyu KIM"><link rel=canonical href=https://cdecl.github.io/devops/helm-chart-install/><link crossorigin=anonymous href=/assets/css/stylesheet.54a2acb878b1e8e44d17c120f64b04a7b2e96d45aafeeef8e52e931080d3fbab.css integrity="sha256-VKKsuHix6ORNF8Eg9ksEp7LpbUWq/u745S6TEIDT+6s=" rel="preload stylesheet" as=style><link rel=icon href=https://cdecl.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://cdecl.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://cdecl.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://cdecl.github.io/apple-touch-icon.png><link rel=mask-icon href=https://cdecl.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://cdecl.github.io/devops/helm-chart-install/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-VQQHHYPN7K"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VQQHHYPN7K")}</script><meta property="og:url" content="https://cdecl.github.io/devops/helm-chart-install/"><meta property="og:site_name" content="cdeclog"><meta property="og:title" content="Helm chart 생성, 배포"><meta property="og:description" content='Kubernetes 패키지 매니저 도구인 helm을 통해 chart 생성 및 Kubernetes 배포
K3S 환경에서 테스트
Helm https://helm.sh/{:target="_blank"} Kubernetes 배포를 위한 패키지 매니저 툴 (e.g yum, choco) chart 라는 yaml 파일 기반의 템플릿 파일을 통해 패키지화 및 Kubernetes 설치 관리 Deployment, Service, Ingress 등 Kubernetes 서비스의 manifest 생성 및 설치 Helm Repository 를 통해 패키지 등록 및 다른 패키지 설치 가능 Helm Install 바이너리 직접 설치 및 설치 Script 활용 Homebrew, Chocolatey 등의 패키지로도 설치 가능 바이너리 다운로드 https://github.com/helm/helm/releases $ curl -LO https://get.helm.sh/helm-v3.7.1-linux-amd64.tar.gz $ tar -zxvf helm-v3.7.1-linux-amd64.tar.gz $ tree linux-amd64 linux-amd64 ├── LICENSE ├── README.md └── helm $ sudo cp linux-amd64/helm /usr/local/bin/ 설치 Script 활용 $ chmod 700 get_helm.sh $ ./get_helm.sh Creating Your Own Charts kubernetes 설치를 위한 chart 생성 및 세팅 https://helm.sh/docs/helm/helm_create/{:target="_blank"} # chart 생성 $ helm create mvcapp Creating mvcapp Chart directory 구조 Chart.yaml : Chart 버전, 이미지버전, 설명등을 기술하는 파일 values.yaml : manifest template 파일 기반, 기준 값을 세팅하는 파일 templates/ : kubernetes manifest template 파일 charts/ : chart 의존성 파일 $ tree mvcapp mvcapp ├── Chart.yaml ├── charts ├── templates │ ├── NOTES.txt │ ├── _helpers.tpl │ ├── deployment.yaml │ ├── hpa.yaml │ ├── ingress.yaml │ ├── service.yaml │ ├── serviceaccount.yaml │ └── tests │ └── test-connection.yaml └── values.yaml Chart.yaml 수정 version : Chart 버전 appVersion : Deploy 되는 image 버전 apiVersion: v2 name: mvcapp description: .net core test mvc application # ... 생략 type: application # ... 생략 version: 0.1.0 # ... 생략 appVersion: "0.6" # appVersion: "1.16.0" values.yaml 수정 replicaCount : Pod 의 replica 개수, 2개로 수정 image.repository : docker image 이름, cdecl/mvcapp 로 수정 service.type : On-Premise에서 테스트 목적, NodePort로 수정 service.nodePort : nodePort를 적용하기 위해 신규 추가 # Default values for mvcapp. # This is a YAML-formatted file. # Declare variables to be passed into your templates. replicaCount: 2 image: repository: cdecl/mvcapp pullPolicy: IfNotPresent # Overrides the image tag whose default is the chart appVersion. tag: "" imagePullSecrets: [] nameOverride: "" fullnameOverride: "" # ... 생략 service: type: NodePort # ClusterIP port: 80 nodePort: 30010 ingress: # ... 생략 resources: {} # We usually recommend not to specify default resources and to leave this as a conscious # choice for the user. This also increases chances charts run on environments with little # resources, such as Minikube. If you do want to specify resources, uncomment the following # lines, adjust them as necessary, and remove the curly braces after &#39;resources:&#39;. # limits: # cpu: 100m # memory: 128Mi # requests: # cpu: 100m # memory: 128Mi # ... 생략 templates/service.yaml 수정 nodePort 를 적용하기 위해 template 수정 spec.ports.nodePort: {{ .Values.service.nodePort }} 추가 apiVersion: v1 kind: Service metadata: name: {{ include "mvcapp.fullname" . }} labels: {{- include "mvcapp.labels" . | nindent 4 }} spec: type: {{ .Values.service.type }} ports: - port: {{ .Values.service.port }} targetPort: http pro name: http nodePort: {{ .Values.service.nodePort }} selector: {{- include "mvcapp.selectorLabels" . | nindent 4 }} helm lint : chart 파일 검사 https://helm.sh/docs/helm/helm_lint/{:target="_blank"} $ helm lint mvcapp ==> Linting mvcapp [INFO] Chart.yaml: icon is recommended 1 chart(s) linted, 0 chart(s) failed helm template : kubernetes manifest 생성 https://helm.sh/docs/helm/helm_template/{:target="_blank"} values.yaml 에 세팅한 기준으로 manifest 생성 $ helm template mvcapp --- # Source: mvcapp/templates/serviceaccount.yaml apiVersion: v1 kind: ServiceAccount metadata: name: RELEASE-NAME-mvcapp labels: helm.sh/chart: mvcapp-0.1.0 app.kubernetes.io/name: mvcapp app.kubernetes.io/instance: RELEASE-NAME app.kubernetes.io/version: "0.6" app.kubernetes.io/managed-by: Helm --- # Source: mvcapp/templates/service.yaml apiVersion: v1 kind: Service metadata: name: RELEASE-NAME-mvcapp labels: helm.sh/chart: mvcapp-0.1.0 app.kubernetes.io/name: mvcapp app.kubernetes.io/instance: RELEASE-NAME app.kubernetes.io/version: "0.6" app.kubernetes.io/managed-by: Helm spec: type: NodePort ports: - port: 80 targetPort: http pro name: http selector: app.kubernetes.io/name: mvcapp app.kubernetes.io/instance: RELEASE-NAME --- # Source: mvcapp/templates/deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: RELEASE-NAME-mvcapp labels: helm.sh/chart: mvcapp-0.1.0 app.kubernetes.io/name: mvcapp app.kubernetes.io/instance: RELEASE-NAME app.kubernetes.io/version: "0.6" app.kubernetes.io/managed-by: Helm spec: replicas: 2 selector: matchLabels: app.kubernetes.io/name: mvcapp app.kubernetes.io/instance: RELEASE-NAME template: metadata: labels: app.kubernetes.io/name: mvcapp app.kubernetes.io/instance: RELEASE-NAME spec: serviceAccountName: RELEASE-NAME-mvcapp securityContext: {} containers: - name: mvcapp securityContext: {} image: "cdecl/mvcapp:0.6" imagePullPolicy: IfNotPresent ports: - name: http containerPort: 80 pro livenessProbe: httpGet: path: / port: http readinessProbe: httpGet: path: / port: http resources: {} --- # Source: mvcapp/templates/tests/test-connection.yaml apiVersion: v1 kind: Pod metadata: name: "RELEASE-NAME-mvcapp-test-connection" labels: helm.sh/chart: mvcapp-0.1.0 app.kubernetes.io/name: mvcapp app.kubernetes.io/instance: RELEASE-NAME app.kubernetes.io/version: "0.6" app.kubernetes.io/managed-by: Helm annotations: "helm.sh/hook": test spec: containers: - name: wget image: busybox command: [&#39;wget&#39;] args: [&#39;RELEASE-NAME-mvcapp:80&#39;] restartPolicy: Never helm install : chart 활용 kubernetes service install https://helm.sh/docs/helm/helm_install/{:target="_blank"} install : helm install [NAME] [CHART] [flags] # 설치하지는 않고 테스트 $ helm install mvcapp-svc mvcapp --dry-run # 로컬 Chart 를 통한 설치 $ helm install mvcapp-svc mvcapp NAME: mvcapp-svc LAST DEPLOYED: Thu Nov 4 13:29:38 2021 NAMESPACE: default STATUS: deployed REVISION: 1 NOTES: 1. Get the application URL by running these commands: export NODE_PORT=$(kubectl get --namespace default -o jsonpath="{.spec.ports[0].nodePort}" services mvcapp-svc) export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath="{.items[0].status.addresses[0].address}") echo http://$NODE_IP:$NODE_PORT $ kubectl get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kubernetes ClusterIP 10.43.0.1 <none> 443/TCP 78d mvcapp-svc NodePort 10.43.202.254 <none> 80:31503/TCP 29s $ kubectl get pod NAME READY STATUS RESTARTS AGE mvcapp-svc-78ff4d97f9-hd9rf 1/1 Running 0 37s mvcapp-svc-78ff4d97f9-x4984 1/1 Running 0 37s KS3 export KUBECONFIG=/etc/rancher/k3s/k3s.yaml 세팅'><meta property="og:locale" content="ko-kr"><meta property="og:type" content="article"><meta property="article:section" content="devops"><meta property="article:published_time" content="2021-11-03T00:00:00+09:00"><meta property="article:modified_time" content="2021-11-03T00:00:00+09:00"><meta property="article:tag" content="Helm"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="K8s"><meta property="article:tag" content="Docker"><meta property="article:tag" content="K3s"><meta name=twitter:card content="summary"><meta name=twitter:title content="Helm chart 생성, 배포"><meta name=twitter:description content='Kubernetes 패키지 매니저 도구인 helm을 통해 chart 생성 및 Kubernetes 배포

K3S 환경에서 테스트

Helm

https://helm.sh/{:target="_blank"}
Kubernetes 배포를 위한 패키지 매니저 툴 (e.g yum, choco)
chart 라는 yaml 파일 기반의 템플릿 파일을 통해 패키지화 및 Kubernetes 설치 관리

Deployment, Service, Ingress 등 Kubernetes 서비스의 manifest 생성 및 설치


Helm Repository 를 통해 패키지 등록 및 다른 패키지 설치 가능


Helm Install

바이너리 직접 설치 및 설치 Script 활용
Homebrew, Chocolatey 등의 패키지로도 설치 가능

바이너리 다운로드

https://github.com/helm/helm/releases

$ curl -LO https://get.helm.sh/helm-v3.7.1-linux-amd64.tar.gz
$ tar -zxvf helm-v3.7.1-linux-amd64.tar.gz

$ tree linux-amd64
linux-amd64
├── LICENSE
├── README.md
└── helm

$ sudo cp linux-amd64/helm /usr/local/bin/
설치 Script 활용

$ chmod 700 get_helm.sh
$ ./get_helm.sh

Creating Your Own Charts

kubernetes 설치를 위한 chart 생성 및 세팅
https://helm.sh/docs/helm/helm_create/{:target="_blank"}

# chart 생성
$ helm create mvcapp
Creating mvcapp
Chart directory 구조

Chart.yaml : Chart 버전, 이미지버전, 설명등을 기술하는 파일
values.yaml : manifest template 파일 기반, 기준 값을 세팅하는 파일
templates/ : kubernetes manifest template 파일
charts/  : chart 의존성 파일

$ tree mvcapp
mvcapp
├── Chart.yaml
├── charts
├── templates
│   ├── NOTES.txt
│   ├── _helpers.tpl
│   ├── deployment.yaml
│   ├── hpa.yaml
│   ├── ingress.yaml
│   ├── service.yaml
│   ├── serviceaccount.yaml
│   └── tests
│       └── test-connection.yaml
└── values.yaml
Chart.yaml 수정

version : Chart 버전
appVersion : Deploy 되는 image 버전

apiVersion: v2
name: mvcapp
description: .net core test mvc application
# ... 생략
type: application
# ... 생략
version: 0.1.0
# ... 생략
appVersion: "0.6"  # appVersion: "1.16.0"
values.yaml 수정

replicaCount : Pod 의 replica 개수, 2개로 수정
image.repository : docker image 이름, cdecl/mvcapp 로 수정
service.type : On-Premise에서 테스트 목적, NodePort로 수정
service.nodePort : nodePort를 적용하기 위해 신규 추가

# Default values for mvcapp.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 2

image:
  repository: cdecl/mvcapp
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# ... 생략

service:
  type: NodePort   # ClusterIP
  port: 80
  nodePort: 30010

ingress:

# ... 생략

resources: {}
  # We usually recommend not to specify default resources and to leave this as a conscious
  # choice for the user. This also increases chances charts run on environments with little
  # resources, such as Minikube. If you do want to specify resources, uncomment the following
  # lines, adjust them as necessary, and remove the curly braces after &#39;resources:&#39;.
  # limits:
  #   cpu: 100m
  #   memory: 128Mi
  # requests:
  #   cpu: 100m
  #   memory: 128Mi

# ... 생략
templates/service.yaml 수정

nodePort 를 적용하기 위해 template 수정
spec.ports.nodePort: {{ .Values.service.nodePort }} 추가

apiVersion: v1
kind: Service
metadata:
  name: {{ include "mvcapp.fullname" . }}
  labels:
    {{- include "mvcapp.labels" . | nindent 4 }}
spec:
  type: {{ .Values.service.type }}
  ports:
    - port: {{ .Values.service.port }}
      targetPort: http
      pro
      name: http
      nodePort: {{ .Values.service.nodePort }}
  selector:
    {{- include "mvcapp.selectorLabels" . | nindent 4 }}
helm lint : chart 파일 검사

https://helm.sh/docs/helm/helm_lint/{:target="_blank"}

$ helm lint mvcapp
==> Linting mvcapp
[INFO] Chart.yaml: icon is recommended

1 chart(s) linted, 0 chart(s) failed
helm template : kubernetes manifest 생성

https://helm.sh/docs/helm/helm_template/{:target="_blank"}
values.yaml 에 세팅한 기준으로 manifest 생성

$ helm template mvcapp
---
# Source: mvcapp/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: RELEASE-NAME-mvcapp
  labels:
    helm.sh/chart: mvcapp-0.1.0
    app.kubernetes.io/name: mvcapp
    app.kubernetes.io/instance: RELEASE-NAME
    app.kubernetes.io/version: "0.6"
    app.kubernetes.io/managed-by: Helm
---
# Source: mvcapp/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: RELEASE-NAME-mvcapp
  labels:
    helm.sh/chart: mvcapp-0.1.0
    app.kubernetes.io/name: mvcapp
    app.kubernetes.io/instance: RELEASE-NAME
    app.kubernetes.io/version: "0.6"
    app.kubernetes.io/managed-by: Helm
spec:
  type: NodePort
  ports:
    - port: 80
      targetPort: http
      pro
      name: http
  selector:
    app.kubernetes.io/name: mvcapp
    app.kubernetes.io/instance: RELEASE-NAME
---
# Source: mvcapp/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: RELEASE-NAME-mvcapp
  labels:
    helm.sh/chart: mvcapp-0.1.0
    app.kubernetes.io/name: mvcapp
    app.kubernetes.io/instance: RELEASE-NAME
    app.kubernetes.io/version: "0.6"
    app.kubernetes.io/managed-by: Helm
spec:
  replicas: 2
  selector:
    matchLabels:
      app.kubernetes.io/name: mvcapp
      app.kubernetes.io/instance: RELEASE-NAME
  template:
    metadata:
      labels:
        app.kubernetes.io/name: mvcapp
        app.kubernetes.io/instance: RELEASE-NAME
    spec:
      serviceAccountName: RELEASE-NAME-mvcapp
      securityContext:
        {}
      containers:
        - name: mvcapp
          securityContext:
            {}
          image: "cdecl/mvcapp:0.6"
          imagePullPolicy: IfNotPresent
          ports:
            - name: http
              containerPort: 80
              pro
          livenessProbe:
            httpGet:
              path: /
              port: http
          readinessProbe:
            httpGet:
              path: /
              port: http
          resources:
            {}
---
# Source: mvcapp/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "RELEASE-NAME-mvcapp-test-connection"
  labels:
    helm.sh/chart: mvcapp-0.1.0
    app.kubernetes.io/name: mvcapp
    app.kubernetes.io/instance: RELEASE-NAME
    app.kubernetes.io/version: "0.6"
    app.kubernetes.io/managed-by: Helm
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: [&#39;wget&#39;]
      args: [&#39;RELEASE-NAME-mvcapp:80&#39;]
  restartPolicy: Never
helm install : chart 활용 kubernetes service install

https://helm.sh/docs/helm/helm_install/{:target="_blank"}
install : helm install [NAME] [CHART] [flags]

# 설치하지는 않고 테스트 
$ helm install mvcapp-svc mvcapp --dry-run

# 로컬 Chart 를 통한 설치 
$ helm install mvcapp-svc mvcapp
NAME: mvcapp-svc
LAST DEPLOYED: Thu Nov  4 13:29:38 2021
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export NODE_PORT=$(kubectl get --namespace default -o jsonpath="{.spec.ports[0].nodePort}" services mvcapp-svc)
  export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath="{.items[0].status.addresses[0].address}")
  echo http://$NODE_IP:$NODE_PORT

$ kubectl get svc
NAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
kubernetes   ClusterIP   10.43.0.1       <none>        443/TCP        78d
mvcapp-svc   NodePort    10.43.202.254   <none>        80:31503/TCP   29s

$ kubectl get pod
NAME                          READY   STATUS    RESTARTS   AGE
mvcapp-svc-78ff4d97f9-hd9rf   1/1     Running   0          37s
mvcapp-svc-78ff4d97f9-x4984   1/1     Running   0          37s

KS3 export KUBECONFIG=/etc/rancher/k3s/k3s.yaml 세팅'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Devops","item":"https://cdecl.github.io/devops/"},{"@type":"ListItem","position":2,"name":"Helm chart 생성, 배포","item":"https://cdecl.github.io/devops/helm-chart-install/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Helm chart 생성, 배포","name":"Helm chart 생성, 배포","description":"Kubernetes 패키지 매니저 도구인 helm을 통해 chart 생성 및 Kubernetes 배포\nK3S 환경에서 테스트\nHelm https://helm.sh/{:target=\u0026quot;_blank\u0026quot;} Kubernetes 배포를 위한 패키지 매니저 툴 (e.g yum, choco) chart 라는 yaml 파일 기반의 템플릿 파일을 통해 패키지화 및 Kubernetes 설치 관리 Deployment, Service, Ingress 등 Kubernetes 서비스의 manifest 생성 및 설치 Helm Repository 를 통해 패키지 등록 및 다른 패키지 설치 가능 Helm Install 바이너리 직접 설치 및 설치 Script 활용 Homebrew, Chocolatey 등의 패키지로도 설치 가능 바이너리 다운로드 https://github.com/helm/helm/releases $ curl -LO https://get.helm.sh/helm-v3.7.1-linux-amd64.tar.gz $ tar -zxvf helm-v3.7.1-linux-amd64.tar.gz $ tree linux-amd64 linux-amd64 ├── LICENSE ├── README.md └── helm $ sudo cp linux-amd64/helm /usr/local/bin/ 설치 Script 활용 $ chmod 700 get_helm.sh $ ./get_helm.sh Creating Your Own Charts kubernetes 설치를 위한 chart 생성 및 세팅 https://helm.sh/docs/helm/helm_create/{:target=\u0026quot;_blank\u0026quot;} # chart 생성 $ helm create mvcapp Creating mvcapp Chart directory 구조 Chart.yaml : Chart 버전, 이미지버전, 설명등을 기술하는 파일 values.yaml : manifest template 파일 기반, 기준 값을 세팅하는 파일 templates/ : kubernetes manifest template 파일 charts/ : chart 의존성 파일 $ tree mvcapp mvcapp ├── Chart.yaml ├── charts ├── templates │ ├── NOTES.txt │ ├── _helpers.tpl │ ├── deployment.yaml │ ├── hpa.yaml │ ├── ingress.yaml │ ├── service.yaml │ ├── serviceaccount.yaml │ └── tests │ └── test-connection.yaml └── values.yaml Chart.yaml 수정 version : Chart 버전 appVersion : Deploy 되는 image 버전 apiVersion: v2 name: mvcapp description: .net core test mvc application # ... 생략 type: application # ... 생략 version: 0.1.0 # ... 생략 appVersion: \u0026#34;0.6\u0026#34; # appVersion: \u0026#34;1.16.0\u0026#34; values.yaml 수정 replicaCount : Pod 의 replica 개수, 2개로 수정 image.repository : docker image 이름, cdecl/mvcapp 로 수정 service.type : On-Premise에서 테스트 목적, NodePort로 수정 service.nodePort : nodePort를 적용하기 위해 신규 추가 # Default values for mvcapp. # This is a YAML-formatted file. # Declare variables to be passed into your templates. replicaCount: 2 image: repository: cdecl/mvcapp pullPolicy: IfNotPresent # Overrides the image tag whose default is the chart appVersion. tag: \u0026#34;\u0026#34; imagePullSecrets: [] nameOverride: \u0026#34;\u0026#34; fullnameOverride: \u0026#34;\u0026#34; # ... 생략 service: type: NodePort # ClusterIP port: 80 nodePort: 30010 ingress: # ... 생략 resources: {} # We usually recommend not to specify default resources and to leave this as a conscious # choice for the user. This also increases chances charts run on environments with little # resources, such as Minikube. If you do want to specify resources, uncomment the following # lines, adjust them as necessary, and remove the curly braces after \u0026#39;resources:\u0026#39;. # limits: # cpu: 100m # memory: 128Mi # requests: # cpu: 100m # memory: 128Mi # ... 생략 templates/service.yaml 수정 nodePort 를 적용하기 위해 template 수정 spec.ports.nodePort: {{ .Values.service.nodePort }} 추가 apiVersion: v1 kind: Service metadata: name: {{ include \u0026#34;mvcapp.fullname\u0026#34; . }} labels: {{- include \u0026#34;mvcapp.labels\u0026#34; . | nindent 4 }} spec: type: {{ .Values.service.type }} ports: - port: {{ .Values.service.port }} targetPort: http pro name: http nodePort: {{ .Values.service.nodePort }} selector: {{- include \u0026#34;mvcapp.selectorLabels\u0026#34; . | nindent 4 }} helm lint : chart 파일 검사 https://helm.sh/docs/helm/helm_lint/{:target=\u0026quot;_blank\u0026quot;} $ helm lint mvcapp ==\u0026gt; Linting mvcapp [INFO] Chart.yaml: icon is recommended 1 chart(s) linted, 0 chart(s) failed helm template : kubernetes manifest 생성 https://helm.sh/docs/helm/helm_template/{:target=\u0026quot;_blank\u0026quot;} values.yaml 에 세팅한 기준으로 manifest 생성 $ helm template mvcapp --- # Source: mvcapp/templates/serviceaccount.yaml apiVersion: v1 kind: ServiceAccount metadata: name: RELEASE-NAME-mvcapp labels: helm.sh/chart: mvcapp-0.1.0 app.kubernetes.io/name: mvcapp app.kubernetes.io/instance: RELEASE-NAME app.kubernetes.io/version: \u0026#34;0.6\u0026#34; app.kubernetes.io/managed-by: Helm --- # Source: mvcapp/templates/service.yaml apiVersion: v1 kind: Service metadata: name: RELEASE-NAME-mvcapp labels: helm.sh/chart: mvcapp-0.1.0 app.kubernetes.io/name: mvcapp app.kubernetes.io/instance: RELEASE-NAME app.kubernetes.io/version: \u0026#34;0.6\u0026#34; app.kubernetes.io/managed-by: Helm spec: type: NodePort ports: - port: 80 targetPort: http pro name: http selector: app.kubernetes.io/name: mvcapp app.kubernetes.io/instance: RELEASE-NAME --- # Source: mvcapp/templates/deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: RELEASE-NAME-mvcapp labels: helm.sh/chart: mvcapp-0.1.0 app.kubernetes.io/name: mvcapp app.kubernetes.io/instance: RELEASE-NAME app.kubernetes.io/version: \u0026#34;0.6\u0026#34; app.kubernetes.io/managed-by: Helm spec: replicas: 2 selector: matchLabels: app.kubernetes.io/name: mvcapp app.kubernetes.io/instance: RELEASE-NAME template: metadata: labels: app.kubernetes.io/name: mvcapp app.kubernetes.io/instance: RELEASE-NAME spec: serviceAccountName: RELEASE-NAME-mvcapp securityContext: {} containers: - name: mvcapp securityContext: {} image: \u0026#34;cdecl/mvcapp:0.6\u0026#34; imagePullPolicy: IfNotPresent ports: - name: http containerPort: 80 pro livenessProbe: httpGet: path: / port: http readinessProbe: httpGet: path: / port: http resources: {} --- # Source: mvcapp/templates/tests/test-connection.yaml apiVersion: v1 kind: Pod metadata: name: \u0026#34;RELEASE-NAME-mvcapp-test-connection\u0026#34; labels: helm.sh/chart: mvcapp-0.1.0 app.kubernetes.io/name: mvcapp app.kubernetes.io/instance: RELEASE-NAME app.kubernetes.io/version: \u0026#34;0.6\u0026#34; app.kubernetes.io/managed-by: Helm annotations: \u0026#34;helm.sh/hook\u0026#34;: test spec: containers: - name: wget image: busybox command: [\u0026#39;wget\u0026#39;] args: [\u0026#39;RELEASE-NAME-mvcapp:80\u0026#39;] restartPolicy: Never helm install : chart 활용 kubernetes service install https://helm.sh/docs/helm/helm_install/{:target=\u0026quot;_blank\u0026quot;} install : helm install [NAME] [CHART] [flags] # 설치하지는 않고 테스트 $ helm install mvcapp-svc mvcapp --dry-run # 로컬 Chart 를 통한 설치 $ helm install mvcapp-svc mvcapp NAME: mvcapp-svc LAST DEPLOYED: Thu Nov 4 13:29:38 2021 NAMESPACE: default STATUS: deployed REVISION: 1 NOTES: 1. Get the application URL by running these commands: export NODE_PORT=$(kubectl get --namespace default -o jsonpath=\u0026#34;{.spec.ports[0].nodePort}\u0026#34; services mvcapp-svc) export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath=\u0026#34;{.items[0].status.addresses[0].address}\u0026#34;) echo http://$NODE_IP:$NODE_PORT $ kubectl get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kubernetes ClusterIP 10.43.0.1 \u0026lt;none\u0026gt; 443/TCP 78d mvcapp-svc NodePort 10.43.202.254 \u0026lt;none\u0026gt; 80:31503/TCP 29s $ kubectl get pod NAME READY STATUS RESTARTS AGE mvcapp-svc-78ff4d97f9-hd9rf 1/1 Running 0 37s mvcapp-svc-78ff4d97f9-x4984 1/1 Running 0 37s KS3 export KUBECONFIG=/etc/rancher/k3s/k3s.yaml 세팅\n","keywords":["helm","kubernetes","k8s","docker","k3s"],"articleBody":"Kubernetes 패키지 매니저 도구인 helm을 통해 chart 생성 및 Kubernetes 배포\nK3S 환경에서 테스트\nHelm https://helm.sh/{:target=\"_blank\"} Kubernetes 배포를 위한 패키지 매니저 툴 (e.g yum, choco) chart 라는 yaml 파일 기반의 템플릿 파일을 통해 패키지화 및 Kubernetes 설치 관리 Deployment, Service, Ingress 등 Kubernetes 서비스의 manifest 생성 및 설치 Helm Repository 를 통해 패키지 등록 및 다른 패키지 설치 가능 Helm Install 바이너리 직접 설치 및 설치 Script 활용 Homebrew, Chocolatey 등의 패키지로도 설치 가능 바이너리 다운로드 https://github.com/helm/helm/releases $ curl -LO https://get.helm.sh/helm-v3.7.1-linux-amd64.tar.gz $ tar -zxvf helm-v3.7.1-linux-amd64.tar.gz $ tree linux-amd64 linux-amd64 ├── LICENSE ├── README.md └── helm $ sudo cp linux-amd64/helm /usr/local/bin/ 설치 Script 활용 $ chmod 700 get_helm.sh $ ./get_helm.sh Creating Your Own Charts kubernetes 설치를 위한 chart 생성 및 세팅 https://helm.sh/docs/helm/helm_create/{:target=\"_blank\"} # chart 생성 $ helm create mvcapp Creating mvcapp Chart directory 구조 Chart.yaml : Chart 버전, 이미지버전, 설명등을 기술하는 파일 values.yaml : manifest template 파일 기반, 기준 값을 세팅하는 파일 templates/ : kubernetes manifest template 파일 charts/ : chart 의존성 파일 $ tree mvcapp mvcapp ├── Chart.yaml ├── charts ├── templates │ ├── NOTES.txt │ ├── _helpers.tpl │ ├── deployment.yaml │ ├── hpa.yaml │ ├── ingress.yaml │ ├── service.yaml │ ├── serviceaccount.yaml │ └── tests │ └── test-connection.yaml └── values.yaml Chart.yaml 수정 version : Chart 버전 appVersion : Deploy 되는 image 버전 apiVersion: v2 name: mvcapp description: .net core test mvc application # ... 생략 type: application # ... 생략 version: 0.1.0 # ... 생략 appVersion: \"0.6\" # appVersion: \"1.16.0\" values.yaml 수정 replicaCount : Pod 의 replica 개수, 2개로 수정 image.repository : docker image 이름, cdecl/mvcapp 로 수정 service.type : On-Premise에서 테스트 목적, NodePort로 수정 service.nodePort : nodePort를 적용하기 위해 신규 추가 # Default values for mvcapp. # This is a YAML-formatted file. # Declare variables to be passed into your templates. replicaCount: 2 image: repository: cdecl/mvcapp pullPolicy: IfNotPresent # Overrides the image tag whose default is the chart appVersion. tag: \"\" imagePullSecrets: [] nameOverride: \"\" fullnameOverride: \"\" # ... 생략 service: type: NodePort # ClusterIP port: 80 nodePort: 30010 ingress: # ... 생략 resources: {} # We usually recommend not to specify default resources and to leave this as a conscious # choice for the user. This also increases chances charts run on environments with little # resources, such as Minikube. If you do want to specify resources, uncomment the following # lines, adjust them as necessary, and remove the curly braces after 'resources:'. # limits: # cpu: 100m # memory: 128Mi # requests: # cpu: 100m # memory: 128Mi # ... 생략 templates/service.yaml 수정 nodePort 를 적용하기 위해 template 수정 spec.ports.nodePort: {{ .Values.service.nodePort }} 추가 apiVersion: v1 kind: Service metadata: name: {{ include \"mvcapp.fullname\" . }} labels: {{- include \"mvcapp.labels\" . | nindent 4 }} spec: type: {{ .Values.service.type }} ports: - port: {{ .Values.service.port }} targetPort: http pro name: http nodePort: {{ .Values.service.nodePort }} selector: {{- include \"mvcapp.selectorLabels\" . | nindent 4 }} helm lint : chart 파일 검사 https://helm.sh/docs/helm/helm_lint/{:target=\"_blank\"} $ helm lint mvcapp ==\u003e Linting mvcapp [INFO] Chart.yaml: icon is recommended 1 chart(s) linted, 0 chart(s) failed helm template : kubernetes manifest 생성 https://helm.sh/docs/helm/helm_template/{:target=\"_blank\"} values.yaml 에 세팅한 기준으로 manifest 생성 $ helm template mvcapp --- # Source: mvcapp/templates/serviceaccount.yaml apiVersion: v1 kind: ServiceAccount metadata: name: RELEASE-NAME-mvcapp labels: helm.sh/chart: mvcapp-0.1.0 app.kubernetes.io/name: mvcapp app.kubernetes.io/instance: RELEASE-NAME app.kubernetes.io/version: \"0.6\" app.kubernetes.io/managed-by: Helm --- # Source: mvcapp/templates/service.yaml apiVersion: v1 kind: Service metadata: name: RELEASE-NAME-mvcapp labels: helm.sh/chart: mvcapp-0.1.0 app.kubernetes.io/name: mvcapp app.kubernetes.io/instance: RELEASE-NAME app.kubernetes.io/version: \"0.6\" app.kubernetes.io/managed-by: Helm spec: type: NodePort ports: - port: 80 targetPort: http pro name: http selector: app.kubernetes.io/name: mvcapp app.kubernetes.io/instance: RELEASE-NAME --- # Source: mvcapp/templates/deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: RELEASE-NAME-mvcapp labels: helm.sh/chart: mvcapp-0.1.0 app.kubernetes.io/name: mvcapp app.kubernetes.io/instance: RELEASE-NAME app.kubernetes.io/version: \"0.6\" app.kubernetes.io/managed-by: Helm spec: replicas: 2 selector: matchLabels: app.kubernetes.io/name: mvcapp app.kubernetes.io/instance: RELEASE-NAME template: metadata: labels: app.kubernetes.io/name: mvcapp app.kubernetes.io/instance: RELEASE-NAME spec: serviceAccountName: RELEASE-NAME-mvcapp securityContext: {} containers: - name: mvcapp securityContext: {} image: \"cdecl/mvcapp:0.6\" imagePullPolicy: IfNotPresent ports: - name: http containerPort: 80 pro livenessProbe: httpGet: path: / port: http readinessProbe: httpGet: path: / port: http resources: {} --- # Source: mvcapp/templates/tests/test-connection.yaml apiVersion: v1 kind: Pod metadata: name: \"RELEASE-NAME-mvcapp-test-connection\" labels: helm.sh/chart: mvcapp-0.1.0 app.kubernetes.io/name: mvcapp app.kubernetes.io/instance: RELEASE-NAME app.kubernetes.io/version: \"0.6\" app.kubernetes.io/managed-by: Helm annotations: \"helm.sh/hook\": test spec: containers: - name: wget image: busybox command: ['wget'] args: ['RELEASE-NAME-mvcapp:80'] restartPolicy: Never helm install : chart 활용 kubernetes service install https://helm.sh/docs/helm/helm_install/{:target=\"_blank\"} install : helm install [NAME] [CHART] [flags] # 설치하지는 않고 테스트 $ helm install mvcapp-svc mvcapp --dry-run # 로컬 Chart 를 통한 설치 $ helm install mvcapp-svc mvcapp NAME: mvcapp-svc LAST DEPLOYED: Thu Nov 4 13:29:38 2021 NAMESPACE: default STATUS: deployed REVISION: 1 NOTES: 1. Get the application URL by running these commands: export NODE_PORT=$(kubectl get --namespace default -o jsonpath=\"{.spec.ports[0].nodePort}\" services mvcapp-svc) export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath=\"{.items[0].status.addresses[0].address}\") echo http://$NODE_IP:$NODE_PORT $ kubectl get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kubernetes ClusterIP 10.43.0.1 443/TCP 78d mvcapp-svc NodePort 10.43.202.254 80:31503/TCP 29s $ kubectl get pod NAME READY STATUS RESTARTS AGE mvcapp-svc-78ff4d97f9-hd9rf 1/1 Running 0 37s mvcapp-svc-78ff4d97f9-x4984 1/1 Running 0 37s KS3 export KUBECONFIG=/etc/rancher/k3s/k3s.yaml 세팅\nhelm upgrade, helm uninstall upgrade : helm upgrade [NAME] [CHART] [flags] uninstall : helm uninstall [NAME] $ helm upgrade mvcapp-svc mvcapp Release \"mvcapp-svc\" has been upgraded. Happy Helming! NAME: mvcapp-svc LAST DEPLOYED: Thu Nov 4 13:44:54 2021 NAMESPACE: default STATUS: deployed REVISION: 5 ... # helm list $ helm list NAME NAMESPACE REVISION UPDATED STATUS CHART APP VERSION mvcapp-svc default 5 2021-11-04 13:44:54.170028077 +0900 KST deployed mvcapp-0.1.0 0.6 # helm history $ helm history mvcapp-svc REVISION UPDATED STATUS CHART APP VERSION DESCRIPTION 1 Thu Nov 4 13:42:12 2021 superseded mvcapp-0.1.0 0.6 Install complete 2 Thu Nov 4 13:42:58 2021 superseded mvcapp-0.1.0 0.5 Upgrade complete 3 Thu Nov 4 13:43:40 2021 superseded mvcapp-0.1.0 0.6 Rollback to 1 4 Thu Nov 4 13:44:32 2021 superseded mvcapp-0.1.0 0.5 Upgrade complete 5 Thu Nov 4 13:44:54 2021 deployed mvcapp-0.1.0 0.6 Upgrade complete # helm uninstall $ helm uninstall mvcapp-svc release \"mvcapp-svc\" uninstalled Chart package, repository helm package https://helm.sh/docs/helm/helm_package/{:target=\"_blank\"} chart 디렉토리를 압축하여 패키지화 $ helm package mvcapp Successfully packaged chart and saved it to: /home/cdecl/temp/helm/mvcapp-0.1.0.tgz Local repository directory https://helm.sh/docs/helm/helm_repo_index/{:target=\"_blank\"} helm repo index : 패키지된 차트의 Index 파일 생성 # repository local directory $ mkdir chart-repo # index 파일 생성 $ helm repo index chart-repo $ cat chart-repo/index.yaml apiVersion: v1 entries: {} generated: \"2021-11-04T14:00:37.388050909+09:00\" # chart package 파일 넣기 $ mv mvcapp-0.1.0.tgz chart-repo # index 파일 갱신 $ helm repo index chart-repo $ cat chart-repo/index.yaml apiVersion: v1 entries: mvcapp: - apiVersion: v2 appVersion: \"0.6\" created: \"2021-11-04T14:02:46.688756427+09:00\" description: A Helm chart for Kubernetes digest: ff28f1c2434531c801bf68106bd5b314e4ff90adac5619e6856d9765052afb83 name: mvcapp type: application urls: - mvcapp-0.1.0.tgz version: 0.1.0 generated: \"2021-11-04T14:02:46.688277626+09:00\" Github chart repository 활용 github repository 생성 및 local repository directory push github repository page 세팅 Repository 등록 및 설치 github page url 로 등록 # add $ helm repo add github https://cdecl.github.io/chart-repo/ \"github\" has been added to your repositories # list $ helm repo list NAME URL stable https://charts.helm.sh/stable github https://cdecl.github.io/chart-repo/ # search $ helm search repo mvcapp NAME CHART VERSION APP VERSION DESCRIPTION github/mvcapp 0.1.0 0.6 A Helm chart for Kubernetes # install from repository $ helm install mvcapp-svc github/mvcapp NAME: mvcapp-svc LAST DEPLOYED: Fri Nov 5 15:46:24 2021 NAMESPACE: default STATUS: deployed REVISION: 1 NOTES: 1. Get the application URL by running these commands: export NODE_PORT=$(kubectl get --namespace default -o jsonpath=\"{.spec.ports[0].nodePort}\" services mvcapp-svc) export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath=\"{.items[0].status.addresses[0].address}\") echo http://$NODE_IP:$NODE_PORT ConfigMap 적용 templates/ 경로에 ConfigMap yaml 파일 생성 templates/configmap.yaml 내부에 .Files.Get \"PATH\" 로 정의된 PATH 파일을 패키지 디렉토리에 위치 $ cat mvcapp/templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: {{ .Release.Name }}-configmap data: config.json: |- {{ .Files.Get \"config.json\" | indent 4}} $ cat mvcapp/config.json { \"url\": \"https://cdecl.github.io/\" } $ helm template mvcapp --- # ... 생략 --- # Source: mvcapp/templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: RELEASE-NAME-configmap data: config.json: |- { \"url\": \"https://cdecl.github.io/\" } --- # ... 생략 ","wordCount":"1280","inLanguage":"en","datePublished":"2021-11-03T00:00:00+09:00","dateModified":"2021-11-03T00:00:00+09:00","author":{"@type":"Person","name":"Byung Kyu KIM"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://cdecl.github.io/devops/helm-chart-install/"},"publisher":{"@type":"Organization","name":"cdeclog","logo":{"@type":"ImageObject","url":"https://cdecl.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://cdecl.github.io/ accesskey=h title="cdeclog (Alt + H)">cdeclog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://cdecl.github.io/dev/ title=Dev><span>Dev</span></a></li><li><a href=https://cdecl.github.io/devops/ title=DevOps><span>DevOps</span></a></li><li><a href=https://cdecl.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://cdecl.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://cdecl.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Helm chart 생성, 배포</h1><div class=post-meta><span title='2021-11-03 00:00:00 +0900 KST'>November 3, 2021</span>&nbsp;·&nbsp;<span>Byung Kyu KIM</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#helm aria-label=Helm>Helm</a><ul><li><a href=#helm-install aria-label="Helm Install">Helm Install</a><ul><ul><li><a href=#%eb%b0%94%ec%9d%b4%eb%84%88%eb%a6%ac-%eb%8b%a4%ec%9a%b4%eb%a1%9c%eb%93%9c aria-label="바이너리 다운로드">바이너리 다운로드</a></li><li><a href=#%ec%84%a4%ec%b9%98-script-%ed%99%9c%ec%9a%a9 aria-label="설치 Script 활용">설치 Script 활용</a></li></ul></ul></li><li><a href=#creating-your-own-charts aria-label="Creating Your Own Charts">Creating Your Own Charts</a><ul><ul><li><a href=#chart-directory-%ea%b5%ac%ec%a1%b0 aria-label="Chart directory 구조">Chart directory 구조</a></li><li><a href=#chartyaml-%ec%88%98%ec%a0%95 aria-label="Chart.yaml 수정">Chart.yaml 수정</a></li><li><a href=#valuesyaml-%ec%88%98%ec%a0%95 aria-label="values.yaml 수정">values.yaml 수정</a></li><li><a href=#templatesserviceyaml-%ec%88%98%ec%a0%95 aria-label="templates/service.yaml 수정">templates/service.yaml 수정</a></li><li><a href=#helm-lint--chart-%ed%8c%8c%ec%9d%bc-%ea%b2%80%ec%82%ac aria-label="helm lint : chart 파일 검사">helm lint : chart 파일 검사</a></li><li><a href=#helm-template--kubernetes-manifest-%ec%83%9d%ec%84%b1 aria-label="helm template : kubernetes manifest 생성">helm template : kubernetes manifest 생성</a></li><li><a href=#helm-install--chart-%ed%99%9c%ec%9a%a9-kubernetes-service-install aria-label="helm install : chart 활용 kubernetes service install">helm install : chart 활용 kubernetes service install</a></li><li><a href=#helm-upgrade-helm-uninstall aria-label="helm upgrade, helm uninstall">helm upgrade, helm uninstall</a></li></ul><li><a href=#chart-package-repository aria-label="Chart package, repository">Chart package, repository</a><ul><li><a href=#helm-package aria-label="helm package">helm package</a></li><li><a href=#local-repository-directory aria-label="Local repository directory">Local repository directory</a></li></ul></li><li><a href=#github-chart-repository-%ed%99%9c%ec%9a%a9 aria-label="Github chart repository 활용">Github chart repository 활용</a><ul><li><a href=#repository-%eb%93%b1%eb%a1%9d-%eb%b0%8f-%ec%84%a4%ec%b9%98 aria-label="Repository 등록 및 설치">Repository 등록 및 설치</a></li></ul></li><li><a href=#configmap-%ec%a0%81%ec%9a%a9 aria-label="ConfigMap 적용">ConfigMap 적용</a></li></ul></li></ul></li></ul></div></details></div><div class=post-content><p><code>Kubernetes</code> 패키지 매니저 도구인 <code>helm</code>을 통해 <code>chart</code> 생성 및 <code>Kubernetes</code> 배포</p><blockquote><p>K3S 환경에서 테스트</p></blockquote><h2 id=helm>Helm<a hidden class=anchor aria-hidden=true href=#helm>#</a></h2><ul><li><a href=https://helm.sh/>https://helm.sh/</a>{:target="_blank"}</li><li>Kubernetes 배포를 위한 패키지 매니저 툴 (e.g <code>yum</code>, <code>choco</code>)</li><li><code>chart</code> 라는 <code>yaml</code> 파일 기반의 템플릿 파일을 통해 패키지화 및 <code>Kubernetes</code> 설치 관리<ul><li><code>Deployment</code>, <code>Service</code>, <code>Ingress</code> 등 <code>Kubernetes</code> 서비스의 manifest 생성 및 설치</li></ul></li><li>Helm Repository 를 통해 패키지 등록 및 다른 패키지 설치 가능</li></ul><hr><h3 id=helm-install>Helm Install<a hidden class=anchor aria-hidden=true href=#helm-install>#</a></h3><ul><li>바이너리 직접 설치 및 설치 Script 활용</li><li><code>Homebrew</code>, <code>Chocolatey</code> 등의 패키지로도 설치 가능</li></ul><h5 id=바이너리-다운로드>바이너리 다운로드<a hidden class=anchor aria-hidden=true href=#바이너리-다운로드>#</a></h5><ul><li><a href=https://github.com/helm/helm/releases>https://github.com/helm/helm/releases</a></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ curl -LO https://get.helm.sh/helm-v3.7.1-linux-amd64.tar.gz
</span></span><span style=display:flex><span>$ tar -zxvf helm-v3.7.1-linux-amd64.tar.gz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ tree linux-amd64
</span></span><span style=display:flex><span>linux-amd64
</span></span><span style=display:flex><span>├── LICENSE
</span></span><span style=display:flex><span>├── README.md
</span></span><span style=display:flex><span>└── helm
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ sudo cp linux-amd64/helm /usr/local/bin/
</span></span></code></pre></div><h5 id=설치-script-활용>설치 Script 활용<a hidden class=anchor aria-hidden=true href=#설치-script-활용>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>
</span></span><span style=display:flex><span>$ chmod <span style=color:#ae81ff>700</span> get_helm.sh
</span></span><span style=display:flex><span>$ ./get_helm.sh
</span></span></code></pre></div><hr><h3 id=creating-your-own-charts>Creating Your Own Charts<a hidden class=anchor aria-hidden=true href=#creating-your-own-charts>#</a></h3><ul><li><code>kubernetes</code> 설치를 위한 <code>chart</code> 생성 및 세팅</li><li><a href=https://helm.sh/docs/helm/helm_create/>https://helm.sh/docs/helm/helm_create/</a>{:target="_blank"}</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># chart 생성</span>
</span></span><span style=display:flex><span>$ helm create mvcapp
</span></span><span style=display:flex><span>Creating mvcapp
</span></span></code></pre></div><h5 id=chart-directory-구조>Chart directory 구조<a hidden class=anchor aria-hidden=true href=#chart-directory-구조>#</a></h5><ul><li><code>Chart.yaml</code> : Chart 버전, 이미지버전, 설명등을 기술하는 파일</li><li><code>values.yaml</code> : manifest template 파일 기반, 기준 값을 세팅하는 파일</li><li><code>templates/</code> : kubernetes manifest template 파일</li><li><code>charts/</code> : chart 의존성 파일</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ tree mvcapp
</span></span><span style=display:flex><span>mvcapp
</span></span><span style=display:flex><span>├── Chart.yaml
</span></span><span style=display:flex><span>├── charts
</span></span><span style=display:flex><span>├── templates
</span></span><span style=display:flex><span>│   ├── NOTES.txt
</span></span><span style=display:flex><span>│   ├── _helpers.tpl
</span></span><span style=display:flex><span>│   ├── deployment.yaml
</span></span><span style=display:flex><span>│   ├── hpa.yaml
</span></span><span style=display:flex><span>│   ├── ingress.yaml
</span></span><span style=display:flex><span>│   ├── service.yaml
</span></span><span style=display:flex><span>│   ├── serviceaccount.yaml
</span></span><span style=display:flex><span>│   └── tests
</span></span><span style=display:flex><span>│       └── test-connection.yaml
</span></span><span style=display:flex><span>└── values.yaml
</span></span></code></pre></div><h5 id=chartyaml-수정><code>Chart.yaml</code> 수정<a hidden class=anchor aria-hidden=true href=#chartyaml-수정>#</a></h5><ul><li><code>version</code> : Chart 버전</li><li><code>appVersion</code> : Deploy 되는 image 버전</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>mvcapp</span>
</span></span><span style=display:flex><span><span style=color:#f92672>description</span>: <span style=color:#ae81ff>.net core test mvc application</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ... 생략</span>
</span></span><span style=display:flex><span><span style=color:#f92672>type</span>: <span style=color:#ae81ff>application</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ... 생략</span>
</span></span><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#ae81ff>0.1.0</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ... 생략</span>
</span></span><span style=display:flex><span><span style=color:#f92672>appVersion</span>: <span style=color:#e6db74>&#34;0.6&#34;</span>  <span style=color:#75715e># appVersion: &#34;1.16.0&#34;</span>
</span></span></code></pre></div><h5 id=valuesyaml-수정><code>values.yaml</code> 수정<a hidden class=anchor aria-hidden=true href=#valuesyaml-수정>#</a></h5><ul><li><code>replicaCount</code> : Pod 의 replica 개수, 2개로 수정</li><li><code>image.repository</code> : docker image 이름, <code>cdecl/mvcapp</code> 로 수정</li><li><code>service.type</code> : <code>On-Premise</code>에서 테스트 목적, <code>NodePort</code>로 수정</li><li><code>service.nodePort</code> : <code>nodePort</code>를 적용하기 위해 신규 추가</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Default values for mvcapp.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># This is a YAML-formatted file.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Declare variables to be passed into your templates.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>replicaCount</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>image</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>repository</span>: <span style=color:#ae81ff>cdecl/mvcapp</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>pullPolicy</span>: <span style=color:#ae81ff>IfNotPresent</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Overrides the image tag whose default is the chart appVersion.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>tag</span>: <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>imagePullSecrets</span>: []
</span></span><span style=display:flex><span><span style=color:#f92672>nameOverride</span>: <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>fullnameOverride</span>: <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ... 생략</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort  </span> <span style=color:#75715e># ClusterIP</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodePort</span>: <span style=color:#ae81ff>30010</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>ingress</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ... 생략</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>resources</span>: {}
</span></span><span style=display:flex><span>  <span style=color:#75715e># We usually recommend not to specify default resources and to leave this as a conscious</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># choice for the user. This also increases chances charts run on environments with little</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># resources, such as Minikube. If you do want to specify resources, uncomment the following</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># lines, adjust them as necessary, and remove the curly braces after &#39;resources:&#39;.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># limits:</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#   cpu: 100m</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#   memory: 128Mi</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># requests:</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#   cpu: 100m</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#   memory: 128Mi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ... 생략</span>
</span></span></code></pre></div><h5 id=templatesserviceyaml-수정><code>templates/service.yaml</code> 수정<a hidden class=anchor aria-hidden=true href=#templatesserviceyaml-수정>#</a></h5><ul><li><code>nodePort</code> 를 적용하기 위해 template 수정</li><li><code>spec.ports.nodePort: {{ .Values.service.nodePort }}</code> 추가</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: {{ <span style=color:#ae81ff>include &#34;mvcapp.fullname&#34; . }}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    {{- <span style=color:#ae81ff>include &#34;mvcapp.labels&#34; . | nindent 4 }}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: {{ <span style=color:#ae81ff>.Values.service.type }}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>port</span>: {{ <span style=color:#ae81ff>.Values.service.port }}</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>http</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>pro</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>http</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>nodePort</span>: {{ <span style=color:#ae81ff>.Values.service.nodePort }}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    {{- <span style=color:#ae81ff>include &#34;mvcapp.selectorLabels&#34; . | nindent 4 }}</span>
</span></span></code></pre></div><h5 id=helm-lint--chart-파일-검사><code>helm lint</code> : chart 파일 검사<a hidden class=anchor aria-hidden=true href=#helm-lint--chart-파일-검사>#</a></h5><ul><li><a href=https://helm.sh/docs/helm/helm_lint/>https://helm.sh/docs/helm/helm_lint/</a>{:target="_blank"}</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ helm lint mvcapp
</span></span><span style=display:flex><span><span style=color:#f92672>==</span>&gt; Linting mvcapp
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> Chart.yaml: icon is recommended
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> chart<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> linted, <span style=color:#ae81ff>0</span> chart<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> failed
</span></span></code></pre></div><h5 id=helm-template--kubernetes-manifest-생성><code>helm template</code> : kubernetes manifest 생성<a hidden class=anchor aria-hidden=true href=#helm-template--kubernetes-manifest-생성>#</a></h5><ul><li><a href=https://helm.sh/docs/helm/helm_template/>https://helm.sh/docs/helm/helm_template/</a>{:target="_blank"}</li><li><code>values.yaml</code> 에 세팅한 기준으로 manifest 생성</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ helm template mvcapp
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#75715e># Source: mvcapp/templates/serviceaccount.yaml</span>
</span></span><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: ServiceAccount
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: RELEASE-NAME-mvcapp
</span></span><span style=display:flex><span>  labels:
</span></span><span style=display:flex><span>    helm.sh/chart: mvcapp-0.1.0
</span></span><span style=display:flex><span>    app.kubernetes.io/name: mvcapp
</span></span><span style=display:flex><span>    app.kubernetes.io/instance: RELEASE-NAME
</span></span><span style=display:flex><span>    app.kubernetes.io/version: <span style=color:#e6db74>&#34;0.6&#34;</span>
</span></span><span style=display:flex><span>    app.kubernetes.io/managed-by: Helm
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#75715e># Source: mvcapp/templates/service.yaml</span>
</span></span><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Service
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: RELEASE-NAME-mvcapp
</span></span><span style=display:flex><span>  labels:
</span></span><span style=display:flex><span>    helm.sh/chart: mvcapp-0.1.0
</span></span><span style=display:flex><span>    app.kubernetes.io/name: mvcapp
</span></span><span style=display:flex><span>    app.kubernetes.io/instance: RELEASE-NAME
</span></span><span style=display:flex><span>    app.kubernetes.io/version: <span style=color:#e6db74>&#34;0.6&#34;</span>
</span></span><span style=display:flex><span>    app.kubernetes.io/managed-by: Helm
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  type: NodePort
</span></span><span style=display:flex><span>  ports:
</span></span><span style=display:flex><span>    - port: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>      targetPort: http
</span></span><span style=display:flex><span>      pro
</span></span><span style=display:flex><span>      name: http
</span></span><span style=display:flex><span>  selector:
</span></span><span style=display:flex><span>    app.kubernetes.io/name: mvcapp
</span></span><span style=display:flex><span>    app.kubernetes.io/instance: RELEASE-NAME
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#75715e># Source: mvcapp/templates/deployment.yaml</span>
</span></span><span style=display:flex><span>apiVersion: apps/v1
</span></span><span style=display:flex><span>kind: Deployment
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: RELEASE-NAME-mvcapp
</span></span><span style=display:flex><span>  labels:
</span></span><span style=display:flex><span>    helm.sh/chart: mvcapp-0.1.0
</span></span><span style=display:flex><span>    app.kubernetes.io/name: mvcapp
</span></span><span style=display:flex><span>    app.kubernetes.io/instance: RELEASE-NAME
</span></span><span style=display:flex><span>    app.kubernetes.io/version: <span style=color:#e6db74>&#34;0.6&#34;</span>
</span></span><span style=display:flex><span>    app.kubernetes.io/managed-by: Helm
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  replicas: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  selector:
</span></span><span style=display:flex><span>    matchLabels:
</span></span><span style=display:flex><span>      app.kubernetes.io/name: mvcapp
</span></span><span style=display:flex><span>      app.kubernetes.io/instance: RELEASE-NAME
</span></span><span style=display:flex><span>  template:
</span></span><span style=display:flex><span>    metadata:
</span></span><span style=display:flex><span>      labels:
</span></span><span style=display:flex><span>        app.kubernetes.io/name: mvcapp
</span></span><span style=display:flex><span>        app.kubernetes.io/instance: RELEASE-NAME
</span></span><span style=display:flex><span>    spec:
</span></span><span style=display:flex><span>      serviceAccountName: RELEASE-NAME-mvcapp
</span></span><span style=display:flex><span>      securityContext:
</span></span><span style=display:flex><span>        <span style=color:#f92672>{}</span>
</span></span><span style=display:flex><span>      containers:
</span></span><span style=display:flex><span>        - name: mvcapp
</span></span><span style=display:flex><span>          securityContext:
</span></span><span style=display:flex><span>            <span style=color:#f92672>{}</span>
</span></span><span style=display:flex><span>          image: <span style=color:#e6db74>&#34;cdecl/mvcapp:0.6&#34;</span>
</span></span><span style=display:flex><span>          imagePullPolicy: IfNotPresent
</span></span><span style=display:flex><span>          ports:
</span></span><span style=display:flex><span>            - name: http
</span></span><span style=display:flex><span>              containerPort: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>              pro
</span></span><span style=display:flex><span>          livenessProbe:
</span></span><span style=display:flex><span>            httpGet:
</span></span><span style=display:flex><span>              path: /
</span></span><span style=display:flex><span>              port: http
</span></span><span style=display:flex><span>          readinessProbe:
</span></span><span style=display:flex><span>            httpGet:
</span></span><span style=display:flex><span>              path: /
</span></span><span style=display:flex><span>              port: http
</span></span><span style=display:flex><span>          resources:
</span></span><span style=display:flex><span>            <span style=color:#f92672>{}</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#75715e># Source: mvcapp/templates/tests/test-connection.yaml</span>
</span></span><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Pod
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: <span style=color:#e6db74>&#34;RELEASE-NAME-mvcapp-test-connection&#34;</span>
</span></span><span style=display:flex><span>  labels:
</span></span><span style=display:flex><span>    helm.sh/chart: mvcapp-0.1.0
</span></span><span style=display:flex><span>    app.kubernetes.io/name: mvcapp
</span></span><span style=display:flex><span>    app.kubernetes.io/instance: RELEASE-NAME
</span></span><span style=display:flex><span>    app.kubernetes.io/version: <span style=color:#e6db74>&#34;0.6&#34;</span>
</span></span><span style=display:flex><span>    app.kubernetes.io/managed-by: Helm
</span></span><span style=display:flex><span>  annotations:
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;helm.sh/hook&#34;</span>: test
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  containers:
</span></span><span style=display:flex><span>    - name: wget
</span></span><span style=display:flex><span>      image: busybox
</span></span><span style=display:flex><span>      command: <span style=color:#f92672>[</span><span style=color:#e6db74>&#39;wget&#39;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>      args: <span style=color:#f92672>[</span><span style=color:#e6db74>&#39;RELEASE-NAME-mvcapp:80&#39;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  restartPolicy: Never
</span></span></code></pre></div><h5 id=helm-install--chart-활용-kubernetes-service-install><code>helm install</code> : chart 활용 kubernetes service install<a hidden class=anchor aria-hidden=true href=#helm-install--chart-활용-kubernetes-service-install>#</a></h5><ul><li><a href=https://helm.sh/docs/helm/helm_install/>https://helm.sh/docs/helm/helm_install/</a>{:target="_blank"}</li><li>install : <code>helm install [NAME] [CHART] [flags]</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># 설치하지는 않고 테스트 </span>
</span></span><span style=display:flex><span>$ helm install mvcapp-svc mvcapp --dry-run
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 로컬 Chart 를 통한 설치 </span>
</span></span><span style=display:flex><span>$ helm install mvcapp-svc mvcapp
</span></span><span style=display:flex><span>NAME: mvcapp-svc
</span></span><span style=display:flex><span>LAST DEPLOYED: Thu Nov  <span style=color:#ae81ff>4</span> 13:29:38 <span style=color:#ae81ff>2021</span>
</span></span><span style=display:flex><span>NAMESPACE: default
</span></span><span style=display:flex><span>STATUS: deployed
</span></span><span style=display:flex><span>REVISION: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>NOTES:
</span></span><span style=display:flex><span>1. Get the application URL by running these commands:
</span></span><span style=display:flex><span>  export NODE_PORT<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>kubectl get --namespace default -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{.spec.ports[0].nodePort}&#34;</span> services mvcapp-svc<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>  export NODE_IP<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>kubectl get nodes --namespace default -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{.items[0].status.addresses[0].address}&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>  echo http://$NODE_IP:$NODE_PORT
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ kubectl get svc
</span></span><span style=display:flex><span>NAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span style=color:#f92672>(</span>S<span style=color:#f92672>)</span>        AGE
</span></span><span style=display:flex><span>kubernetes   ClusterIP   10.43.0.1       &lt;none&gt;        443/TCP        78d
</span></span><span style=display:flex><span>mvcapp-svc   NodePort    10.43.202.254   &lt;none&gt;        80:31503/TCP   29s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ kubectl get pod
</span></span><span style=display:flex><span>NAME                          READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>mvcapp-svc-78ff4d97f9-hd9rf   1/1     Running   <span style=color:#ae81ff>0</span>          37s
</span></span><span style=display:flex><span>mvcapp-svc-78ff4d97f9-x4984   1/1     Running   <span style=color:#ae81ff>0</span>          37s
</span></span></code></pre></div><blockquote><p>KS3 <code>export KUBECONFIG=/etc/rancher/k3s/k3s.yaml</code> 세팅</p></blockquote><h5 id=helm-upgrade-helm-uninstall><code>helm upgrade</code>, <code>helm uninstall</code><a hidden class=anchor aria-hidden=true href=#helm-upgrade-helm-uninstall>#</a></h5><ul><li>upgrade : <code>helm upgrade [NAME] [CHART] [flags]</code></li><li>uninstall : <code>helm uninstall [NAME]</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ helm upgrade mvcapp-svc mvcapp
</span></span><span style=display:flex><span>Release <span style=color:#e6db74>&#34;mvcapp-svc&#34;</span> has been upgraded. Happy Helming!
</span></span><span style=display:flex><span>NAME: mvcapp-svc
</span></span><span style=display:flex><span>LAST DEPLOYED: Thu Nov  <span style=color:#ae81ff>4</span> 13:44:54 <span style=color:#ae81ff>2021</span>
</span></span><span style=display:flex><span>NAMESPACE: default
</span></span><span style=display:flex><span>STATUS: deployed
</span></span><span style=display:flex><span>REVISION: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># helm list</span>
</span></span><span style=display:flex><span>$ helm list
</span></span><span style=display:flex><span>NAME            NAMESPACE       REVISION        UPDATED                                 STATUS          CHART          APP VERSION
</span></span><span style=display:flex><span>mvcapp-svc      default         <span style=color:#ae81ff>5</span>               2021-11-04 13:44:54.170028077 +0900 KST deployed        mvcapp-0.1.0   0.6
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># helm history</span>
</span></span><span style=display:flex><span>$ helm history mvcapp-svc
</span></span><span style=display:flex><span>REVISION        UPDATED                         STATUS          CHART           APP VERSION     DESCRIPTION
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>               Thu Nov  <span style=color:#ae81ff>4</span> 13:42:12 <span style=color:#ae81ff>2021</span>        superseded      mvcapp-0.1.0    0.6             Install complete
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>               Thu Nov  <span style=color:#ae81ff>4</span> 13:42:58 <span style=color:#ae81ff>2021</span>        superseded      mvcapp-0.1.0    0.5             Upgrade complete
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span>               Thu Nov  <span style=color:#ae81ff>4</span> 13:43:40 <span style=color:#ae81ff>2021</span>        superseded      mvcapp-0.1.0    0.6             Rollback to <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span>               Thu Nov  <span style=color:#ae81ff>4</span> 13:44:32 <span style=color:#ae81ff>2021</span>        superseded      mvcapp-0.1.0    0.5             Upgrade complete
</span></span><span style=display:flex><span><span style=color:#ae81ff>5</span>               Thu Nov  <span style=color:#ae81ff>4</span> 13:44:54 <span style=color:#ae81ff>2021</span>        deployed        mvcapp-0.1.0    0.6             Upgrade complete
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># helm uninstall</span>
</span></span><span style=display:flex><span>$ helm uninstall mvcapp-svc
</span></span><span style=display:flex><span>release <span style=color:#e6db74>&#34;mvcapp-svc&#34;</span> uninstalled
</span></span></code></pre></div><hr><h4 id=chart-package-repository>Chart package, repository<a hidden class=anchor aria-hidden=true href=#chart-package-repository>#</a></h4><h5 id=helm-package><code>helm package</code><a hidden class=anchor aria-hidden=true href=#helm-package>#</a></h5><ul><li><a href=https://helm.sh/docs/helm/helm_package/>https://helm.sh/docs/helm/helm_package/</a>{:target="_blank"}</li><li>chart 디렉토리를 압축하여 패키지화</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ helm package mvcapp
</span></span><span style=display:flex><span>Successfully packaged chart and saved it to: /home/cdecl/temp/helm/mvcapp-0.1.0.tgz
</span></span></code></pre></div><h5 id=local-repository-directory>Local repository directory<a hidden class=anchor aria-hidden=true href=#local-repository-directory>#</a></h5><ul><li><a href=https://helm.sh/docs/helm/helm_repo_index/>https://helm.sh/docs/helm/helm_repo_index/</a>{:target="_blank"}</li><li><code>helm repo index</code> : 패키지된 차트의 Index 파일 생성</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># repository local directory</span>
</span></span><span style=display:flex><span>$ mkdir chart-repo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># index 파일 생성 </span>
</span></span><span style=display:flex><span>$ helm repo index chart-repo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ cat chart-repo/index.yaml
</span></span><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>entries: <span style=color:#f92672>{}</span>
</span></span><span style=display:flex><span>generated: <span style=color:#e6db74>&#34;2021-11-04T14:00:37.388050909+09:00&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># chart package 파일 넣기</span>
</span></span><span style=display:flex><span>$ mv mvcapp-0.1.0.tgz chart-repo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># index 파일 갱신</span>
</span></span><span style=display:flex><span>$ helm repo index chart-repo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ cat chart-repo/index.yaml
</span></span><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>entries:
</span></span><span style=display:flex><span>  mvcapp:
</span></span><span style=display:flex><span>  - apiVersion: v2
</span></span><span style=display:flex><span>    appVersion: <span style=color:#e6db74>&#34;0.6&#34;</span>
</span></span><span style=display:flex><span>    created: <span style=color:#e6db74>&#34;2021-11-04T14:02:46.688756427+09:00&#34;</span>
</span></span><span style=display:flex><span>    description: A Helm chart <span style=color:#66d9ef>for</span> Kubernetes
</span></span><span style=display:flex><span>    digest: ff28f1c2434531c801bf68106bd5b314e4ff90adac5619e6856d9765052afb83
</span></span><span style=display:flex><span>    name: mvcapp
</span></span><span style=display:flex><span>    type: application
</span></span><span style=display:flex><span>    urls:
</span></span><span style=display:flex><span>    - mvcapp-0.1.0.tgz
</span></span><span style=display:flex><span>    version: 0.1.0
</span></span><span style=display:flex><span>generated: <span style=color:#e6db74>&#34;2021-11-04T14:02:46.688277626+09:00&#34;</span>
</span></span></code></pre></div><hr><h4 id=github-chart-repository-활용>Github chart repository 활용<a hidden class=anchor aria-hidden=true href=#github-chart-repository-활용>#</a></h4><ul><li>github repository 생성 및 local repository directory <code>push</code></li><li>github repository page 세팅</li></ul><p><img loading=lazy src=/images/2021-11-04-14-30-32.png></p><h5 id=repository-등록-및-설치>Repository 등록 및 설치<a hidden class=anchor aria-hidden=true href=#repository-등록-및-설치>#</a></h5><ul><li>github page url 로 등록</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># add</span>
</span></span><span style=display:flex><span>$ helm repo add github https://cdecl.github.io/chart-repo/
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;github&#34;</span> has been added to your repositories
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># list </span>
</span></span><span style=display:flex><span>$ helm repo list
</span></span><span style=display:flex><span>NAME    URL
</span></span><span style=display:flex><span>stable  https://charts.helm.sh/stable
</span></span><span style=display:flex><span>github  https://cdecl.github.io/chart-repo/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># search</span>
</span></span><span style=display:flex><span>$ helm search repo mvcapp
</span></span><span style=display:flex><span>NAME            CHART VERSION   APP VERSION     DESCRIPTION
</span></span><span style=display:flex><span>github/mvcapp   0.1.0           0.6             A Helm chart <span style=color:#66d9ef>for</span> Kubernetes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># install from repository</span>
</span></span><span style=display:flex><span>$ helm install mvcapp-svc github/mvcapp
</span></span><span style=display:flex><span>NAME: mvcapp-svc
</span></span><span style=display:flex><span>LAST DEPLOYED: Fri Nov  <span style=color:#ae81ff>5</span> 15:46:24 <span style=color:#ae81ff>2021</span>
</span></span><span style=display:flex><span>NAMESPACE: default
</span></span><span style=display:flex><span>STATUS: deployed
</span></span><span style=display:flex><span>REVISION: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>NOTES:
</span></span><span style=display:flex><span>1. Get the application URL by running these commands:
</span></span><span style=display:flex><span>  export NODE_PORT<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>kubectl get --namespace default -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{.spec.ports[0].nodePort}&#34;</span> services mvcapp-svc<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>  export NODE_IP<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>kubectl get nodes --namespace default -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{.items[0].status.addresses[0].address}&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>  echo http://$NODE_IP:$NODE_PORT
</span></span></code></pre></div><hr><h4 id=configmap-적용>ConfigMap 적용<a hidden class=anchor aria-hidden=true href=#configmap-적용>#</a></h4><ul><li><code>templates/</code> 경로에 ConfigMap yaml 파일 생성<ul><li><code>templates/configmap.yaml</code></li></ul></li><li>내부에 <code>.Files.Get "PATH"</code> 로 정의된 PATH 파일을 패키지 디렉토리에 위치</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ cat mvcapp/templates/configmap.yaml
</span></span><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: ConfigMap
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: <span style=color:#f92672>{{</span> .Release.Name <span style=color:#f92672>}}</span>-configmap
</span></span><span style=display:flex><span>data:
</span></span><span style=display:flex><span>  config.json: |-
</span></span><span style=display:flex><span><span style=color:#f92672>{{</span> .Files.Get <span style=color:#e6db74>&#34;config.json&#34;</span> | indent 4<span style=color:#f92672>}}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ cat mvcapp/config.json
</span></span><span style=display:flex><span><span style=color:#f92672>{</span> <span style=color:#e6db74>&#34;url&#34;</span>: <span style=color:#e6db74>&#34;https://cdecl.github.io/&#34;</span> <span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ helm template mvcapp
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#75715e># ... 생략 </span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#75715e># Source: mvcapp/templates/configmap.yaml</span>
</span></span><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: ConfigMap
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: RELEASE-NAME-configmap
</span></span><span style=display:flex><span>data:
</span></span><span style=display:flex><span>  config.json: |-
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span> <span style=color:#e6db74>&#34;url&#34;</span>: <span style=color:#e6db74>&#34;https://cdecl.github.io/&#34;</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#75715e># ... 생략 </span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://cdecl.github.io/tags/helm/>Helm</a></li><li><a href=https://cdecl.github.io/tags/kubernetes/>Kubernetes</a></li><li><a href=https://cdecl.github.io/tags/k8s/>K8s</a></li><li><a href=https://cdecl.github.io/tags/docker/>Docker</a></li><li><a href=https://cdecl.github.io/tags/k3s/>K3s</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://cdecl.github.io/>cdeclog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>