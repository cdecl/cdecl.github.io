<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Kubernetes Job 실행 | cdeclog</title><meta name=keywords content="kubernetes,k8s,job,jq"><meta name=description content='Kubernetes Job 을 활용한 동시작업
Kubernetes Job

https://kubernetes.io/ko/docs/concepts/workloads/controllers/job/{:target="_blank"}


Pod 를 생성하고, Pod를 통해 성공적으로 종료할떄까지의 일련의 작업실행

Job : 단일 Job 테스트
alpine pod 실행 및 ip 명령어로 IP 확인

command : 명령어 (배열)
restartPolicy : Always, OnFailure, Never (default Always)

배치 작업이므로 재시작 하면 안됨 : Never


backoffLimit : 실패시 재시작 횟수 (defalut: 6)

# time.yml
apiVersion: batch/v1
kind: Job
metadata:
 name: ip
spec:
  template:
    metadata:
      name: ip
    spec:
      containers:
      - name: ip
        image: alpine
        command: ["ip", "a"]
      restartPolicy: Never
  backoffLimit: 0
$ kubectl apply -f ip.yml
job.batch/ip created

$ kubectl get pod
NAME       READY   STATUS      RESTARTS   AGE
ip-5x8qm   0/1     Completed   0          14s
로그 확인
$ kubectl logs ip-5x8qm
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
3: eth0@if58: <BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN> mtu 1450 qdisc noqueue state UP
    link/ether 9a:f9:d3:9f:32:eb brd ff:ff:ff:ff:ff:ff
    inet 10.42.0.37/24 brd 10.42.0.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::98f9:d3ff:fe9f:32eb/64 scope link
       valid_lft forever preferred_lft forever

Job : Parallel 동시작업

wrk 를 활용 http 퍼포먼스 테스트 : https://github.com/wg/wrk{:target="_blank"}
Image : cdecl/asb{:target="_blank"}

Parallel 실행 1

parallelism : 동시 실행 Pod 개수 (default: 1)
completions : Pod 완료로 판단하는 개수 (default: parallelism )

apiVersion: batch/v1
kind: Job
metadata:
 name: wrk
spec:
  completions: 4
  parallelism: 4
  template:
    metadata:
      name: wrk
    spec:
      containers:
      - name: wrk
        image: cdecl/asb
        command: ["wrk", "-d5", "http://httpbin.org/get"]
      restartPolicy: Never
  backoffLimit: 0
실행, 로그 확인
$ kubectl apply -f wrk.yml
'><meta name=author content="Byung Kyu KIM"><link rel=canonical href=https://cdecl.github.io/devops/kubernetes-job-simple/><link crossorigin=anonymous href=/assets/css/stylesheet.f939c4ffefb264e6fe85e04352266f79db6bb1303c8e16ae9b6064c1247b5e32.css integrity="sha256-+TnE/++yZOb+heBDUiZvedtrsTA8jhaum2BkwSR7XjI=" rel="preload stylesheet" as=style><link rel=icon href=https://cdecl.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://cdecl.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://cdecl.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://cdecl.github.io/apple-touch-icon.png><link rel=mask-icon href=https://cdecl.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://cdecl.github.io/devops/kubernetes-job-simple/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-VQQHHYPN7K"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VQQHHYPN7K")}</script><meta property="og:url" content="https://cdecl.github.io/devops/kubernetes-job-simple/"><meta property="og:site_name" content="cdeclog"><meta property="og:title" content="Kubernetes Job 실행"><meta property="og:description" content='Kubernetes Job 을 활용한 동시작업
Kubernetes Job https://kubernetes.io/ko/docs/concepts/workloads/controllers/job/{:target="_blank"} Pod 를 생성하고, Pod를 통해 성공적으로 종료할떄까지의 일련의 작업실행
Job : 단일 Job 테스트 alpine pod 실행 및 ip 명령어로 IP 확인
command : 명령어 (배열) restartPolicy : Always, OnFailure, Never (default Always) 배치 작업이므로 재시작 하면 안됨 : Never backoffLimit : 실패시 재시작 횟수 (defalut: 6) # time.yml apiVersion: batch/v1 kind: Job metadata: name: ip spec: template: metadata: name: ip spec: containers: - name: ip image: alpine command: ["ip", "a"] restartPolicy: Never backoffLimit: 0 $ kubectl apply -f ip.yml job.batch/ip created $ kubectl get pod NAME READY STATUS RESTARTS AGE ip-5x8qm 0/1 Completed 0 14s 로그 확인 $ kubectl logs ip-5x8qm 1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 3: eth0@if58: <BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN> mtu 1450 qdisc noqueue state UP link/ether 9a:f9:d3:9f:32:eb brd ff:ff:ff:ff:ff:ff inet 10.42.0.37/24 brd 10.42.0.255 scope global eth0 valid_lft forever preferred_lft forever inet6 fe80::98f9:d3ff:fe9f:32eb/64 scope link valid_lft forever preferred_lft forever Job : Parallel 동시작업 wrk 를 활용 http 퍼포먼스 테스트 : https://github.com/wg/wrk{:target="_blank"} Image : cdecl/asb{:target="_blank"} Parallel 실행 1 parallelism : 동시 실행 Pod 개수 (default: 1) completions : Pod 완료로 판단하는 개수 (default: parallelism ) apiVersion: batch/v1 kind: Job metadata: name: wrk spec: completions: 4 parallelism: 4 template: metadata: name: wrk spec: containers: - name: wrk image: cdecl/asb command: ["wrk", "-d5", "http://httpbin.org/get"] restartPolicy: Never backoffLimit: 0 실행, 로그 확인 $ kubectl apply -f wrk.yml '><meta property="og:locale" content="ko-kr"><meta property="og:type" content="article"><meta property="article:section" content="devops"><meta property="article:published_time" content="2021-09-16T00:00:00+09:00"><meta property="article:modified_time" content="2021-09-16T00:00:00+09:00"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="K8s"><meta property="article:tag" content="Job"><meta property="article:tag" content="Jq"><meta name=twitter:card content="summary"><meta name=twitter:title content="Kubernetes Job 실행"><meta name=twitter:description content='Kubernetes Job 을 활용한 동시작업
Kubernetes Job

https://kubernetes.io/ko/docs/concepts/workloads/controllers/job/{:target="_blank"}


Pod 를 생성하고, Pod를 통해 성공적으로 종료할떄까지의 일련의 작업실행

Job : 단일 Job 테스트
alpine pod 실행 및 ip 명령어로 IP 확인

command : 명령어 (배열)
restartPolicy : Always, OnFailure, Never (default Always)

배치 작업이므로 재시작 하면 안됨 : Never


backoffLimit : 실패시 재시작 횟수 (defalut: 6)

# time.yml
apiVersion: batch/v1
kind: Job
metadata:
 name: ip
spec:
  template:
    metadata:
      name: ip
    spec:
      containers:
      - name: ip
        image: alpine
        command: ["ip", "a"]
      restartPolicy: Never
  backoffLimit: 0
$ kubectl apply -f ip.yml
job.batch/ip created

$ kubectl get pod
NAME       READY   STATUS      RESTARTS   AGE
ip-5x8qm   0/1     Completed   0          14s
로그 확인
$ kubectl logs ip-5x8qm
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
3: eth0@if58: <BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN> mtu 1450 qdisc noqueue state UP
    link/ether 9a:f9:d3:9f:32:eb brd ff:ff:ff:ff:ff:ff
    inet 10.42.0.37/24 brd 10.42.0.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::98f9:d3ff:fe9f:32eb/64 scope link
       valid_lft forever preferred_lft forever

Job : Parallel 동시작업

wrk 를 활용 http 퍼포먼스 테스트 : https://github.com/wg/wrk{:target="_blank"}
Image : cdecl/asb{:target="_blank"}

Parallel 실행 1

parallelism : 동시 실행 Pod 개수 (default: 1)
completions : Pod 완료로 판단하는 개수 (default: parallelism )

apiVersion: batch/v1
kind: Job
metadata:
 name: wrk
spec:
  completions: 4
  parallelism: 4
  template:
    metadata:
      name: wrk
    spec:
      containers:
      - name: wrk
        image: cdecl/asb
        command: ["wrk", "-d5", "http://httpbin.org/get"]
      restartPolicy: Never
  backoffLimit: 0
실행, 로그 확인
$ kubectl apply -f wrk.yml
'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Devops","item":"https://cdecl.github.io/devops/"},{"@type":"ListItem","position":2,"name":"Kubernetes Job 실행","item":"https://cdecl.github.io/devops/kubernetes-job-simple/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Kubernetes Job 실행","name":"Kubernetes Job 실행","description":"Kubernetes Job 을 활용한 동시작업\nKubernetes Job https://kubernetes.io/ko/docs/concepts/workloads/controllers/job/{:target=\u0026quot;_blank\u0026quot;} Pod 를 생성하고, Pod를 통해 성공적으로 종료할떄까지의 일련의 작업실행\nJob : 단일 Job 테스트 alpine pod 실행 및 ip 명령어로 IP 확인\ncommand : 명령어 (배열) restartPolicy : Always, OnFailure, Never (default Always) 배치 작업이므로 재시작 하면 안됨 : Never backoffLimit : 실패시 재시작 횟수 (defalut: 6) # time.yml apiVersion: batch/v1 kind: Job metadata: name: ip spec: template: metadata: name: ip spec: containers: - name: ip image: alpine command: [\u0026#34;ip\u0026#34;, \u0026#34;a\u0026#34;] restartPolicy: Never backoffLimit: 0 $ kubectl apply -f ip.yml job.batch/ip created $ kubectl get pod NAME READY STATUS RESTARTS AGE ip-5x8qm 0/1 Completed 0 14s 로그 확인 $ kubectl logs ip-5x8qm 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 3: eth0@if58: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN\u0026gt; mtu 1450 qdisc noqueue state UP link/ether 9a:f9:d3:9f:32:eb brd ff:ff:ff:ff:ff:ff inet 10.42.0.37/24 brd 10.42.0.255 scope global eth0 valid_lft forever preferred_lft forever inet6 fe80::98f9:d3ff:fe9f:32eb/64 scope link valid_lft forever preferred_lft forever Job : Parallel 동시작업 wrk 를 활용 http 퍼포먼스 테스트 : https://github.com/wg/wrk{:target=\u0026quot;_blank\u0026quot;} Image : cdecl/asb{:target=\u0026quot;_blank\u0026quot;} Parallel 실행 1 parallelism : 동시 실행 Pod 개수 (default: 1) completions : Pod 완료로 판단하는 개수 (default: parallelism ) apiVersion: batch/v1 kind: Job metadata: name: wrk spec: completions: 4 parallelism: 4 template: metadata: name: wrk spec: containers: - name: wrk image: cdecl/asb command: [\u0026#34;wrk\u0026#34;, \u0026#34;-d5\u0026#34;, \u0026#34;http://httpbin.org/get\u0026#34;] restartPolicy: Never backoffLimit: 0 실행, 로그 확인 $ kubectl apply -f wrk.yml ","keywords":["kubernetes","k8s","job","jq"],"articleBody":"Kubernetes Job 을 활용한 동시작업\nKubernetes Job https://kubernetes.io/ko/docs/concepts/workloads/controllers/job/{:target=\"_blank\"} Pod 를 생성하고, Pod를 통해 성공적으로 종료할떄까지의 일련의 작업실행\nJob : 단일 Job 테스트 alpine pod 실행 및 ip 명령어로 IP 확인\ncommand : 명령어 (배열) restartPolicy : Always, OnFailure, Never (default Always) 배치 작업이므로 재시작 하면 안됨 : Never backoffLimit : 실패시 재시작 횟수 (defalut: 6) # time.yml apiVersion: batch/v1 kind: Job metadata: name: ip spec: template: metadata: name: ip spec: containers: - name: ip image: alpine command: [\"ip\", \"a\"] restartPolicy: Never backoffLimit: 0 $ kubectl apply -f ip.yml job.batch/ip created $ kubectl get pod NAME READY STATUS RESTARTS AGE ip-5x8qm 0/1 Completed 0 14s 로그 확인 $ kubectl logs ip-5x8qm 1: lo: mtu 65536 qdisc noqueue state UNKNOWN qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 3: eth0@if58: mtu 1450 qdisc noqueue state UP link/ether 9a:f9:d3:9f:32:eb brd ff:ff:ff:ff:ff:ff inet 10.42.0.37/24 brd 10.42.0.255 scope global eth0 valid_lft forever preferred_lft forever inet6 fe80::98f9:d3ff:fe9f:32eb/64 scope link valid_lft forever preferred_lft forever Job : Parallel 동시작업 wrk 를 활용 http 퍼포먼스 테스트 : https://github.com/wg/wrk{:target=\"_blank\"} Image : cdecl/asb{:target=\"_blank\"} Parallel 실행 1 parallelism : 동시 실행 Pod 개수 (default: 1) completions : Pod 완료로 판단하는 개수 (default: parallelism ) apiVersion: batch/v1 kind: Job metadata: name: wrk spec: completions: 4 parallelism: 4 template: metadata: name: wrk spec: containers: - name: wrk image: cdecl/asb command: [\"wrk\", \"-d5\", \"http://httpbin.org/get\"] restartPolicy: Never backoffLimit: 0 실행, 로그 확인 $ kubectl apply -f wrk.yml $ kubectl logs wrk-6fkm4 Running 5s test @ http://httpbin.org/get 2 threads and 10 connections Thread Stats Avg Stdev Max +/- Stdev Latency 34.45ms 63.03ms 408.58ms 92.36% Req/Sec 108.80 29.09 191.00 78.89% 1003 requests in 5.01s, 557.33KB read Requests/sec: 200.39 Transfer/sec: 111.35KB Parallel 실행 2 completions \u003e parallelism : parallelism 개수만큼 동시 실행되고, completions 개수만큼 Pod 생성 apiVersion: batch/v1 kind: Job metadata: name: wrk spec: completions: 4 parallelism: 2 ... Job 의 전체 Pod 로그 확인 kubectl 을 통해서 json output을 다룰수 있으나, jq 만큼 유연하지는 않음 # Pod 이름 확인 $ kubectl get pod --selector=job-name=wrk -o=json | jq -r '.items[].metadata.name' wrk-g4kxr wrk-44vlk wrk-g7jtv wrk-lx9rf # 각 Pod 의 로그확인 $ kubectl get pod --selector=job-name=wrk -o=json | jq -r '.items[].metadata.name' | xargs -i kubectl logs {} Running 5s test @ http://httpbin.org/get 2 threads and 10 connections Thread Stats Avg Stdev Max +/- Stdev Latency 0.00us 0.00us 0.00us -nan% Req/Sec 0.00 0.00 0.00 -nan% 0 requests in 5.01s, 0.00B read Requests/sec: 0.00 Transfer/sec: 0.00B Running 5s test @ http://httpbin.org/get 2 threads and 10 connections Thread Stats Avg Stdev Max +/- Stdev Latency 26.63ms 81.87ms 644.70ms 91.58% Req/Sec 272.61 155.98 540.00 60.71% 826 requests in 5.01s, 519.76KB read Socket errors: connect 0, read 0, write 0, timeout 10 Requests/sec: 164.99 Transfer/sec: 103.82KB Running 5s test @ http://httpbin.org/get 2 threads and 10 connections Thread Stats Avg Stdev Max +/- Stdev Latency 19.15ms 52.63ms 314.47ms 92.81% Req/Sec 249.73 88.39 500.00 69.47% 2407 requests in 5.01s, 1.57MB read Requests/sec: 480.89 Transfer/sec: 322.16KB Running 5s test @ http://httpbin.org/get 2 threads and 10 connections Thread Stats Avg Stdev Max +/- Stdev Latency 11.73ms 37.52ms 304.20ms 96.02% Req/Sec 215.97 105.45 535.00 67.71% 2074 requests in 5.10s, 1.36MB read Requests/sec: 406.69 Transfer/sec: 272.45KB ","wordCount":"531","inLanguage":"en","datePublished":"2021-09-16T00:00:00+09:00","dateModified":"2021-09-16T00:00:00+09:00","author":{"@type":"Person","name":"Byung Kyu KIM"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://cdecl.github.io/devops/kubernetes-job-simple/"},"publisher":{"@type":"Organization","name":"cdeclog","logo":{"@type":"ImageObject","url":"https://cdecl.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://cdecl.github.io/ accesskey=h title="cdeclog (Alt + H)">cdeclog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://cdecl.github.io/dev/ title=Dev><span>Dev</span></a></li><li><a href=https://cdecl.github.io/devops/ title=DevOps><span>DevOps</span></a></li><li><a href=https://cdecl.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://cdecl.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://cdecl.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://cdecl.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://cdecl.github.io/devops/>Devops</a></div><h1 class="post-title entry-hint-parent">Kubernetes Job 실행</h1><div class=post-meta><span title='2021-09-16 00:00:00 +0900 KST'>September 16, 2021</span>&nbsp;·&nbsp;<span>Byung Kyu KIM</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#kubernetes-job aria-label="Kubernetes Job">Kubernetes Job</a><ul><li><a href=#job--%eb%8b%a8%ec%9d%bc-job-%ed%85%8c%ec%8a%a4%ed%8a%b8 aria-label="Job : 단일 Job 테스트">Job : 단일 Job 테스트</a><ul><li><a href=#%eb%a1%9c%ea%b7%b8-%ed%99%95%ec%9d%b8 aria-label="로그 확인">로그 확인</a></li></ul></li><li><a href=#job--parallel-%eb%8f%99%ec%8b%9c%ec%9e%91%ec%97%85 aria-label="Job : Parallel 동시작업">Job : Parallel 동시작업</a><ul><li><a href=#parallel-%ec%8b%a4%ed%96%89-1 aria-label="Parallel 실행 1">Parallel 실행 1</a></li><li><a href=#%ec%8b%a4%ed%96%89-%eb%a1%9c%ea%b7%b8-%ed%99%95%ec%9d%b8 aria-label="실행, 로그 확인">실행, 로그 확인</a></li><li><a href=#parallel-%ec%8b%a4%ed%96%89-2 aria-label="Parallel 실행 2">Parallel 실행 2</a></li></ul></li><li><a href=#job-%ec%9d%98-%ec%a0%84%ec%b2%b4-pod-%eb%a1%9c%ea%b7%b8-%ed%99%95%ec%9d%b8 aria-label="Job 의 전체 Pod 로그 확인">Job 의 전체 Pod 로그 확인</a></li></ul></li></ul></div></details></div><div class=post-content><p>Kubernetes Job 을 활용한 동시작업</p><h2 id=kubernetes-job>Kubernetes Job<a hidden class=anchor aria-hidden=true href=#kubernetes-job>#</a></h2><ul><li><a href=https://kubernetes.io/ko/docs/concepts/workloads/controllers/job/>https://kubernetes.io/ko/docs/concepts/workloads/controllers/job/</a>{:target="_blank"}</li></ul><blockquote><p>Pod 를 생성하고, Pod를 통해 성공적으로 종료할떄까지의 일련의 작업실행</p></blockquote><h3 id=job--단일-job-테스트>Job : 단일 Job 테스트<a hidden class=anchor aria-hidden=true href=#job--단일-job-테스트>#</a></h3><p><code>alpine</code> pod 실행 및 <code>ip</code> 명령어로 IP 확인</p><ul><li><code>command</code> : 명령어 (배열)</li><li><code>restartPolicy</code> : <code>Always</code>, <code>OnFailure</code>, <code>Never</code> (default <code>Always</code>)<ul><li>배치 작업이므로 재시작 하면 안됨 : <code>Never</code></li></ul></li><li><code>backoffLimit</code> : 실패시 재시작 횟수 (defalut: 6)</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#6272a4># time.yml</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: batch/v1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: Job
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span> <span style=color:#ff79c6>name</span>: ip
</span></span><span style=display:flex><span><span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>name</span>: ip
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: ip
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>image</span>: alpine
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>command</span>: [<span style=color:#f1fa8c>&#34;ip&#34;</span>, <span style=color:#f1fa8c>&#34;a&#34;</span>]
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>restartPolicy</span>: Never
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>backoffLimit</span>: <span style=color:#bd93f9>0</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ kubectl apply -f ip.yml
</span></span><span style=display:flex><span>job.batch/ip created
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ kubectl get pod
</span></span><span style=display:flex><span>NAME       READY   STATUS      RESTARTS   AGE
</span></span><span style=display:flex><span>ip-5x8qm   0/1     Completed   <span style=color:#bd93f9>0</span>          14s
</span></span></code></pre></div><h4 id=로그-확인>로그 확인<a hidden class=anchor aria-hidden=true href=#로그-확인>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ kubectl logs ip-5x8qm
</span></span><span style=display:flex><span>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span style=color:#bd93f9>65536</span> qdisc noqueue state UNKNOWN qlen <span style=color:#bd93f9>1000</span>
</span></span><span style=display:flex><span>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span style=display:flex><span>    inet 127.0.0.1/8 scope host lo
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>    inet6 ::1/128 scope host
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>3: eth0@if58: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu <span style=color:#bd93f9>1450</span> qdisc noqueue state UP
</span></span><span style=display:flex><span>    link/ether 9a:f9:d3:9f:32:eb brd ff:ff:ff:ff:ff:ff
</span></span><span style=display:flex><span>    inet 10.42.0.37/24 brd 10.42.0.255 scope global eth0
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>    inet6 fe80::98f9:d3ff:fe9f:32eb/64 scope link
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span></code></pre></div><hr><h3 id=job--parallel-동시작업>Job : Parallel 동시작업<a hidden class=anchor aria-hidden=true href=#job--parallel-동시작업>#</a></h3><ul><li>wrk 를 활용 http 퍼포먼스 테스트 : <a href=https://github.com/wg/wrk>https://github.com/wg/wrk</a>{:target="_blank"}</li><li>Image : <a href=https://hub.docker.com/r/cdecl/asb/>cdecl/asb</a>{:target="_blank"}</li></ul><h4 id=parallel-실행-1>Parallel 실행 1<a hidden class=anchor aria-hidden=true href=#parallel-실행-1>#</a></h4><ul><li><code>parallelism</code> : 동시 실행 Pod 개수 (default: 1)</li><li><code>completions</code> : Pod 완료로 판단하는 개수 (default: <code>parallelism</code> )</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: batch/v1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: Job
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span> <span style=color:#ff79c6>name</span>: wrk
</span></span><span style=display:flex><span><span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>completions</span>: <span style=color:#bd93f9>4</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>parallelism</span>: <span style=color:#bd93f9>4</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>name</span>: wrk
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: wrk
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>image</span>: cdecl/asb
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>command</span>: [<span style=color:#f1fa8c>&#34;wrk&#34;</span>, <span style=color:#f1fa8c>&#34;-d5&#34;</span>, <span style=color:#f1fa8c>&#34;http://httpbin.org/get&#34;</span>]
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>restartPolicy</span>: Never
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>backoffLimit</span>: <span style=color:#bd93f9>0</span>
</span></span></code></pre></div><h4 id=실행-로그-확인>실행, 로그 확인<a hidden class=anchor aria-hidden=true href=#실행-로그-확인>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ kubectl apply -f wrk.yml
</span></span></code></pre></div><p><img loading=lazy src=/images/job-4-4.gif></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ kubectl logs wrk-6fkm4
</span></span><span style=display:flex><span>Running 5s <span style=color:#8be9fd;font-style:italic>test</span> @ http://httpbin.org/get
</span></span><span style=display:flex><span>  <span style=color:#bd93f9>2</span> threads and <span style=color:#bd93f9>10</span> connections
</span></span><span style=display:flex><span>  Thread Stats   Avg      Stdev     Max   +/- Stdev
</span></span><span style=display:flex><span>    Latency    34.45ms   63.03ms 408.58ms   92.36%
</span></span><span style=display:flex><span>    Req/Sec   108.80     29.09   191.00     78.89%
</span></span><span style=display:flex><span>  <span style=color:#bd93f9>1003</span> requests in 5.01s, 557.33KB <span style=color:#8be9fd;font-style:italic>read</span>
</span></span><span style=display:flex><span>Requests/sec:    200.39
</span></span><span style=display:flex><span>Transfer/sec:    111.35KB
</span></span></code></pre></div><h4 id=parallel-실행-2>Parallel 실행 2<a hidden class=anchor aria-hidden=true href=#parallel-실행-2>#</a></h4><ul><li><code>completions</code> > <code>parallelism</code> : <code>parallelism</code> 개수만큼 동시 실행되고, <code>completions</code> 개수만큼 Pod 생성</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: batch/v1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: Job
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span> <span style=color:#ff79c6>name</span>: wrk
</span></span><span style=display:flex><span><span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>completions</span>: <span style=color:#bd93f9>4</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>parallelism</span>: <span style=color:#bd93f9>2</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p><img loading=lazy src=/images/job-4-2.gif></p><hr><h3 id=job-의-전체-pod-로그-확인>Job 의 전체 Pod 로그 확인<a hidden class=anchor aria-hidden=true href=#job-의-전체-pod-로그-확인>#</a></h3><ul><li>kubectl 을 통해서 json output을 다룰수 있으나, <code>jq</code> 만큼 유연하지는 않음</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#6272a4># Pod 이름 확인</span>
</span></span><span style=display:flex><span>$ kubectl get pod --selector<span style=color:#ff79c6>=</span>job-name<span style=color:#ff79c6>=</span>wrk -o<span style=color:#ff79c6>=</span>json | jq -r <span style=color:#f1fa8c>&#39;.items[].metadata.name&#39;</span>
</span></span><span style=display:flex><span>wrk-g4kxr
</span></span><span style=display:flex><span>wrk-44vlk
</span></span><span style=display:flex><span>wrk-g7jtv
</span></span><span style=display:flex><span>wrk-lx9rf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 각 Pod 의 로그확인</span>
</span></span><span style=display:flex><span>$ kubectl get pod --selector<span style=color:#ff79c6>=</span>job-name<span style=color:#ff79c6>=</span>wrk -o<span style=color:#ff79c6>=</span>json | jq -r <span style=color:#f1fa8c>&#39;.items[].metadata.name&#39;</span> | xargs -i kubectl logs <span style=color:#ff79c6>{}</span>
</span></span><span style=display:flex><span>Running 5s <span style=color:#8be9fd;font-style:italic>test</span> @ http://httpbin.org/get
</span></span><span style=display:flex><span>  <span style=color:#bd93f9>2</span> threads and <span style=color:#bd93f9>10</span> connections
</span></span><span style=display:flex><span>  Thread Stats   Avg      Stdev     Max   +/- Stdev
</span></span><span style=display:flex><span>    Latency     0.00us    0.00us   0.00us    -nan%
</span></span><span style=display:flex><span>    Req/Sec     0.00      0.00     0.00      -nan%
</span></span><span style=display:flex><span>  <span style=color:#bd93f9>0</span> requests in 5.01s, 0.00B <span style=color:#8be9fd;font-style:italic>read</span>
</span></span><span style=display:flex><span>Requests/sec:      0.00
</span></span><span style=display:flex><span>Transfer/sec:       0.00B
</span></span><span style=display:flex><span>Running 5s <span style=color:#8be9fd;font-style:italic>test</span> @ http://httpbin.org/get
</span></span><span style=display:flex><span>  <span style=color:#bd93f9>2</span> threads and <span style=color:#bd93f9>10</span> connections
</span></span><span style=display:flex><span>  Thread Stats   Avg      Stdev     Max   +/- Stdev
</span></span><span style=display:flex><span>    Latency    26.63ms   81.87ms 644.70ms   91.58%
</span></span><span style=display:flex><span>    Req/Sec   272.61    155.98   540.00     60.71%
</span></span><span style=display:flex><span>  <span style=color:#bd93f9>826</span> requests in 5.01s, 519.76KB <span style=color:#8be9fd;font-style:italic>read</span>
</span></span><span style=display:flex><span>  Socket errors: connect 0, <span style=color:#8be9fd;font-style:italic>read</span> 0, write 0, timeout <span style=color:#bd93f9>10</span>
</span></span><span style=display:flex><span>Requests/sec:    164.99
</span></span><span style=display:flex><span>Transfer/sec:    103.82KB
</span></span><span style=display:flex><span>Running 5s <span style=color:#8be9fd;font-style:italic>test</span> @ http://httpbin.org/get
</span></span><span style=display:flex><span>  <span style=color:#bd93f9>2</span> threads and <span style=color:#bd93f9>10</span> connections
</span></span><span style=display:flex><span>  Thread Stats   Avg      Stdev     Max   +/- Stdev
</span></span><span style=display:flex><span>    Latency    19.15ms   52.63ms 314.47ms   92.81%
</span></span><span style=display:flex><span>    Req/Sec   249.73     88.39   500.00     69.47%
</span></span><span style=display:flex><span>  <span style=color:#bd93f9>2407</span> requests in 5.01s, 1.57MB <span style=color:#8be9fd;font-style:italic>read</span>
</span></span><span style=display:flex><span>Requests/sec:    480.89
</span></span><span style=display:flex><span>Transfer/sec:    322.16KB
</span></span><span style=display:flex><span>Running 5s <span style=color:#8be9fd;font-style:italic>test</span> @ http://httpbin.org/get
</span></span><span style=display:flex><span>  <span style=color:#bd93f9>2</span> threads and <span style=color:#bd93f9>10</span> connections
</span></span><span style=display:flex><span>  Thread Stats   Avg      Stdev     Max   +/- Stdev
</span></span><span style=display:flex><span>    Latency    11.73ms   37.52ms 304.20ms   96.02%
</span></span><span style=display:flex><span>    Req/Sec   215.97    105.45   535.00     67.71%
</span></span><span style=display:flex><span>  <span style=color:#bd93f9>2074</span> requests in 5.10s, 1.36MB <span style=color:#8be9fd;font-style:italic>read</span>
</span></span><span style=display:flex><span>Requests/sec:    406.69
</span></span><span style=display:flex><span>Transfer/sec:    272.45KB
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://cdecl.github.io/tags/kubernetes/>Kubernetes</a></li><li><a href=https://cdecl.github.io/tags/k8s/>K8s</a></li><li><a href=https://cdecl.github.io/tags/job/>Job</a></li><li><a href=https://cdecl.github.io/tags/jq/>Jq</a></li></ul></footer><script src=https://giscus.app/client.js data-repo=cdecl/cdecl.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkzNDk1ODUyNjg=" data-category=General data-category-id=DIC_kwDOFNY_dM4C1XMk data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=transparent_dark data-lang=ko crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2026 <a href=https://cdecl.github.io/>cdeclog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>